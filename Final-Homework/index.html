<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Monta:300,300italic,400,400italic,700,700italic%7CLobster+two:300,300italic,400,400italic,700,700italic%7CRoboto+Slab:300,300italic,400,400italic,700,700italic%7CPT+Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.2/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.superpung.xyz","root":"/","images":"/images","scheme":"Mist","version":"8.2.1","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":true,"color":"#222","save":"manual"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}};
  </script>
<meta name="description" content="攻击+拆弹+分析">
<meta property="og:type" content="article">
<meta property="og:title" content="Final Homework: 黎明前的黑暗">
<meta property="og:url" content="https://www.superpung.xyz/Final-Homework/">
<meta property="og:site_name" content="ExiTalk">
<meta property="og:description" content="攻击+拆弹+分析">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://super-bucket1.oss-cn-beijing.aliyuncs.com/ExiTalk.png">
<meta property="og:image" content="https://super-bucket1.oss-cn-beijing.aliyuncs.com/zkw.jpeg">
<meta property="article:published_time" content="2020-05-31T05:22:00.000Z">
<meta property="article:modified_time" content="2021-02-11T04:22:05.509Z">
<meta property="article:author" content="SUPER">
<meta property="article:tag" content="Computer Systems">
<meta property="article:tag" content="Experiments">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://super-bucket1.oss-cn-beijing.aliyuncs.com/ExiTalk.png">


<link rel="canonical" href="https://www.superpung.xyz/Final-Homework/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>
<title>Final Homework: 黎明前的黑暗 | ExiTalk</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-168209848-1"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-168209848-1');
      }
    </script>

  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?f2bcd2857d66dc90e115d790b974341f";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">ExiTalk</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Follow your heart</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
        <li class="menu-item menu-item-love"><a href="/love/" rel="section"><i class="fa fa-heart fa-fw"></i>love</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BB%BB%E5%8A%A1%E4%B8%80%E2%80%94%E2%80%94%E6%94%BB%E5%87%BB"><span class="nav-text">任务一——攻击</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BB%BB%E5%8A%A1%E4%BA%8C%E2%80%94%E2%80%94%E6%8B%86%E5%BC%B9"><span class="nav-text">任务二——拆弹</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Phase-0-string"><span class="nav-text">Phase 0: string</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Phase-1-string-array"><span class="nav-text">Phase 1: string array</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Phase-2-link-list-amp-recursion"><span class="nav-text">Phase 2: link list&amp;recursion</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#phase-2"><span class="nav-text">phase_2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#recursion"><span class="nav-text">recursion</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BB%BB%E5%8A%A1%E4%B8%89%E2%80%94%E2%80%94%E7%A8%8B%E5%BA%8F%E5%B1%80%E9%83%A8%E6%80%A7%E7%89%B9%E6%80%A7%E5%88%86%E6%9E%90"><span class="nav-text">任务三——程序局部性特性分析</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Phase-3-switch"><span class="nav-text">Phase 3: switch</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sum-loop"><span class="nav-text">sum: loop</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#sum-0"><span class="nav-text">sum_0</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sum-1"><span class="nav-text">sum_1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sum-2"><span class="nav-text">sum_2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sum"><span class="nav-text">sum</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BB%BB%E5%8A%A1%E5%9B%9B%E2%80%94%E2%80%94%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E5%88%86%E6%9E%90"><span class="nav-text">任务四——虚拟内存分析</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BB%93%E6%9D%9F%E8%AF%AD"><span class="nav-text">结束语</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="SUPER"
      src="/images/avatar.jpeg">
  <p class="site-author-name" itemprop="name">SUPER</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">38</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/SuperPung" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;SuperPung" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:superpung.lee@gmail.com" title="E-Mail → mailto:superpung.lee@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://t.me/super_lee" title="Telegram → https:&#x2F;&#x2F;t.me&#x2F;super_lee" rel="noopener" target="_blank"><i class="telegram fa-fw"></i>Telegram</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/super_pung" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;super_pung" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.facebook.com/syeopung.lee.3" title="FB Page → https:&#x2F;&#x2F;www.facebook.com&#x2F;syeopung.lee.3" rel="noopener" target="_blank"><i class="fab fa-facebook fa-fw"></i>FB Page</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://instagram.com/superpung.lee" title="Instagram → https:&#x2F;&#x2F;instagram.com&#x2F;superpung.lee" rel="noopener" target="_blank"><i class="fab fa-instagram fa-fw"></i>Instagram</a>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://tingtalk.me/" title="https:&#x2F;&#x2F;tingtalk.me&#x2F;" rel="noopener" target="_blank">TingTalk</a>
        </li>
    </ul>
  </div>

        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.superpung.xyz/Final-Homework/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="SUPER">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ExiTalk">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Final Homework: 黎明前的黑暗
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
  
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-05-31 13:22:00" itemprop="dateCreated datePublished" datetime="2020-05-31T13:22:00+08:00">2020-05-31</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-02-11 12:22:05" itemprop="dateModified" datetime="2021-02-11T12:22:05+08:00">2021-02-11</time>
      </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine: </span>
  
    <a title="valine" href="/Final-Homework/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/Final-Homework/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="Symbols count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Symbols count in article: </span>
      <span>25k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>23 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>攻击+拆弹+分析</p>
<a id="more"></a>

<p><img src="https://super-bucket1.oss-cn-beijing.aliyuncs.com/ExiTalk.png"></p>
<p><strong>声明：请独立思考并完成实验。本文只是提供一些思路，禁止作为实验报告使用。</strong></p>
<hr>
<p>本实验包含：<strong>攻击</strong>、<strong>拆弹</strong>、<strong>程序局部性特性分析</strong>和<strong>虚拟内存使用分析</strong>四部分。</p>
<p>建议提前阅读：</p>
<ul>
<li><a href="https://www.superpung.xyz/Attack-Lab/">Attack Lab</a></li>
<li><a href="https://www.superpung.xyz/Bomb-Lab/">Bomb Lab</a></li>
</ul>
<p>并准备好实验环境，不要出现下面这种情况。</p>
<p><img src="https://super-bucket1.oss-cn-beijing.aliyuncs.com/zkw.jpeg" alt="zkw"></p>
<hr>
<p>开始实验前，请记住：</p>
<ul>
<li><p><strong>磨刀不误砍柴工</strong></p>
<p>认真阅读资料和指导书，做好知识储备</p>
<p>准备好系统环境</p>
</li>
<li><p><strong>自省</strong></p>
<p>遇到错误首先反思自身，而不是怀疑他人</p>
</li>
<li><p><strong>认真</strong></p>
<p>越是细节的地方越容易出问题</p>
</li>
<li><p><strong>黎明前总是最黑暗的</strong></p>
<p>需要信心和坚持</p>
</li>
</ul>
<p>本文所有操作均基于以下环境：</p>
<ul>
<li>OS: Ubuntu 18.04.4 LTS (Linux ubuntu 5.3.0-46-generic x86_64)</li>
<li>Debugger: GNU gdb (Ubuntu 8.1-0ubuntu3.2) 8.1.0.20180409-git</li>
<li>Compiler: gcc version 7.5.0</li>
</ul>
<p><em>注：需要接入互联网。</em></p>
<p>实验材料：</p>
<ul>
<li><code>exam</code>：实验目标，需要进行破解的程序</li>
<li><code>hex2raw</code>：将格式化的十六进制文本转换成ascii码（使用方法见<a href="https://www.superpung.xyz/Attack-Lab/">Attack Lab</a>）</li>
</ul>
<p>首先使用<code>objdump</code>反汇编<code>exam</code>：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">linux&gt;</span><span class="bash"> objdump -d exam &gt; exam.s</span></span><br></pre></td></tr></table></figure>
<p>实验开始。</p>
<hr>
<h1 id="任务一——攻击"><a href="#任务一——攻击" class="headerlink" title="任务一——攻击"></a>任务一——攻击</h1><p>攻击针对的是<code>exam</code>程序中的<code>doSomething</code>函数，因为它存在缓冲区溢出漏洞，相信做过Attack Lab的都知道。</p>
<p>任务一是开启后续实验的大门，所以至关重要。</p>
<p>指导中给出了<code>main</code>函数的C代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  ......</span><br><span class="line">  doSomething();</span><br><span class="line">  sad_ending();</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以发现，如果让<code>doSomething</code>函数正常返回，则会直接调用<code>sad_ending</code>函数，意味着整个实验的失败：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You failed! (T_T)</span><br></pre></td></tr></table></figure>
<p>所以我们不能让<code>doSomething</code>函数正常返回，再看指导中给出的<code>doSomething</code>函数的C代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">char</span> <span class="title">doSomething</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">0x20</span>];</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Input sth. please.&quot;</span>);</span><br><span class="line">  gets(buf);</span><br><span class="line">  <span class="keyword">return</span> buf[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现<code>char buf[0x20];</code>分配0x20大小的空间，有缓冲区溢出的漏洞。等等，直接给出了缓冲区的大小？</p>
<p>在<code>exam.s</code>中找到<code>doSomething</code>函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0000000000401830 &lt;doSomething&gt;:</span><br><span class="line">  401830:	48 83 ec 28          	sub    $0x28,%rsp</span><br></pre></td></tr></table></figure>
<p>发现401830实际分配的空间是0x28大小，果然事情没有那么简单。</p>
<hr>
<p>根据指导的要求，需要将程序的控制流导入至<code>entrance</code>函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">entrance</span><span class="params">(<span class="keyword">int</span> cookie)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (cookie != COOKIE) &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Opps! Invalid cookie&quot;</span>);</span><br><span class="line">    sad_ending();</span><br><span class="line">  &#125;  </span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>而且需要传递参数<code>cookie</code>，且必须等于某个常数<code>COOKIE</code>。</p>
<p>找到<code>entrance</code>函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">00000000004018b2 &lt;entrance&gt;:</span><br><span class="line">  4018b2:	55                   	push   %rbp</span><br><span class="line">  4018b3:	53                   	push   %rbx</span><br><span class="line">  4018b4:	48 83 ec 08          	sub    $0x8,%rsp</span><br><span class="line">  4018b8:	89 fd                	mov    %edi,%ebp</span><br><span class="line">  4018ba:	48 8d 3d 7f 09 00 00 	lea    0x97f(%rip),%rdi        # 402240 &lt;_IO_stdin_used+0x240&gt;</span><br><span class="line">  4018c1:	e8 7a f7 ff ff       	callq  401040 &lt;puts@plt&gt;</span><br><span class="line">  4018c6:	81 fd df ac f9 f5    	cmp    $0xf5f9acdf,%ebp</span><br><span class="line">  4018cc:	75 4f                	jne    40191d &lt;entrance+0x6b&gt;</span><br><span class="line">  ...</span><br><span class="line">  40191d:	48 8d 3d 77 08 00 00 	lea    0x877(%rip),%rdi        # 40219b &lt;_IO_stdin_used+0x19b&gt;</span><br><span class="line">  401924:	e8 17 f7 ff ff       	callq  401040 &lt;puts@plt&gt;</span><br><span class="line">  401929:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  40192e:	e8 b1 fe ff ff       	callq  4017e4 &lt;sad_ending&gt;</span><br></pre></td></tr></table></figure>
<p>发现<code>entrance</code>函数的地址是<code>0x4018b2</code>。</p>
<p>4010b8将传入的参数给了<code>%ebp</code>，4018c6将<code>%ebp</code>和<code>0xf5f9acdf</code>比较，若不相等则跳到40191d，继续执行则直接调用<code>sad_ending</code>函数使实验失败。</p>
<p>可以看出，<code>COOKIE</code>值就是<code>0xf5f9acdf</code>。<em>（为什么会有人把它当作地址？）</em></p>
<p><em>这波操作和Attack Lab的<code>Level 2</code>极其相似，所以不过多解释，可以再复习一遍<a href="https://www.superpung.xyz/Attack-Lab/">Attack Lab</a>。</em></p>
<hr>
<p>编写汇编文件<code>entrance.s</code>，重定向至<code>entrance</code> 函数，并传入参数<code>COOKIE</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mov     $0xf5f9acdf,%rdi    # cookie</span><br><span class="line">push    $0x4018b2           # address of entrance</span><br><span class="line">ret</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>汇编：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -c entrance.s</span><br></pre></td></tr></table></figure>
<p>反汇编：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">objdump -d entrance.o</span><br></pre></td></tr></table></figure>
<p>得到输出如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">entrance.o：     文件格式 elf64-x86-64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disassembly of section .text:</span><br><span class="line"></span><br><span class="line">0000000000000000 &lt;.text&gt;:</span><br><span class="line">   0:	48 bf df ac f9 f5 00 	movabs $0xf5f9acdf,%rdi</span><br><span class="line">   7:	00 00 00 </span><br><span class="line">   a:	68 b2 18 40 00       	pushq  $0x4018b2</span><br><span class="line">   f:	c3                   	retq </span><br></pre></td></tr></table></figure>
<p>得到字节码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">48 bf df ac f9 f5 00        &#x2F;* movabs $0xf5f9acdf,%rdi *&#x2F;</span><br><span class="line">00 00 00</span><br><span class="line">68 b2 18 40 00              &#x2F;* pushq  $0x4018b2 *&#x2F;</span><br><span class="line">c3                          &#x2F;* retq *&#x2F;</span><br></pre></td></tr></table></figure>
<hr>
<p>接下来，寻找缓冲区<code>%rsp</code>的起始地址，利用<code>gdb</code>：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdb exam</span><br></pre></td></tr></table></figure>
<p>打断点：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) b doSomething</span><br></pre></td></tr></table></figure>
<p>运行：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) r</span><br></pre></td></tr></table></figure>
<p>单步跟踪：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) si</span><br></pre></td></tr></table></figure>
<p>此时执行到<code>401830:    sub    $0x28,%rsp</code>处，打印<code>%rsp</code>的值（地址）：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) p/x $rsp</span><br></pre></td></tr></table></figure>
<p>得到输出如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">1 = 0x55585fd0</span></span><br></pre></td></tr></table></figure>
<p>即<code>%rsp</code>的地址是<code>0x55585fd0</code>，此即缓冲区的起始地址。</p>
<hr>
<p>编辑用于攻击的字符串文件<code>data.txt</code>（<strong>注意注释周围的空格、机器为小端法</strong>）：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">48 bf df ac f9 f5 00        /* movabs $0xf5f9acdf,%rdi */</span><br><span class="line">00 00 00</span><br><span class="line">68 b2 18 40 00              /* pushq  $0x4018b2 */</span><br><span class="line">c3                          /* retq */</span><br><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">d0 5f 58 55 00 00 00 00     /* address of %rsp in doSomething */</span><br></pre></td></tr></table></figure>
<p>利用<code>hex2raw</code>输入到<code>exam</code><em>（为什么有人还在加<code>-q</code>？）</em>：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./hex2raw &lt; data.txt | ./exam</span><br></pre></td></tr></table></figure>
<p>得到输出如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input sth. please.</span><br><span class="line"></span><br><span class="line">Ohh! You have found the entrance.</span><br></pre></td></tr></table></figure>
<p>完成。</p>
<hr>
<p>如果你觉得攻击实验很有趣，不妨做一下更有趣的Attack Lab。</p>
<h1 id="任务二——拆弹"><a href="#任务二——拆弹" class="headerlink" title="任务二——拆弹"></a>任务二——拆弹</h1><p>和Bomb Lab极其相似，细节不再赘述，可以再复习一遍<a href="https://www.superpung.xyz/Bomb-Lab/">Bomb Lab</a>。</p>
<blockquote>
<p>关于寄存器的常识：</p>
<ul>
<li>每个寄存器都有它特有的功能；</li>
<li><code>%rsp</code>：栈顶指针；</li>
<li><code>%rdi</code>：函数的第一个参数；</li>
<li><code>%rsi</code>：函数的第二个参数；</li>
<li><code>%rdx</code>：函数的第三个参数；</li>
<li><code>%rcx</code>：函数的第四个参数；</li>
<li><code>%rax</code>：函数的返回值。</li>
</ul>
</blockquote>
<h2 id="Phase-0-string"><a href="#Phase-0-string" class="headerlink" title="Phase 0: string"></a>Phase 0: <em>string</em></h2><p><code>phase_0</code>对应的汇编语句如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">000000000040139f &lt;phase_0&gt;:</span><br><span class="line">  40139f:	53                   	push   %rbx</span><br><span class="line">  4013a0:	48 81 ec 00 02 00 00 	sub    $0x200,%rsp</span><br><span class="line">  4013a7:	48 8b 0d 12 2d 00 00 	mov    0x2d12(%rip),%rcx        # 4040c0 &lt;stdout@@GLIBC_2.2.5&gt;</span><br><span class="line">  4013ae:	ba 17 00 00 00       	mov    $0x17,%edx</span><br><span class="line">  4013b3:	be 01 00 00 00       	mov    $0x1,%esi</span><br><span class="line">  4013b8:	48 8d 3d 7b 0c 00 00 	lea    0xc7b(%rip),%rdi        # 40203a &lt;_IO_stdin_used+0x3a&gt;</span><br><span class="line">  4013bf:	e8 3c fd ff ff       	callq  401100 &lt;fwrite@plt&gt;</span><br><span class="line">  4013c4:	48 89 e3             	mov    %rsp,%rbx</span><br><span class="line">  4013c7:	be 00 02 00 00       	mov    $0x200,%esi</span><br><span class="line">  4013cc:	48 89 df             	mov    %rbx,%rdi</span><br><span class="line">  4013cf:	e8 d5 03 00 00       	callq  4017a9 &lt;read_line&gt;</span><br><span class="line">  4013d4:	ba 30 00 00 00       	mov    $0x30,%edx</span><br><span class="line">  4013d9:	48 89 de             	mov    %rbx,%rsi</span><br><span class="line">  4013dc:	48 8d 3d 75 0c 00 00 	lea    0xc75(%rip),%rdi        # 402058 &lt;_IO_stdin_used+0x58&gt;</span><br><span class="line">  4013e3:	e8 93 07 00 00       	callq  401b7b &lt;_strncmp&gt;</span><br><span class="line">  4013e8:	85 c0                	test   %eax,%eax</span><br><span class="line">  4013ea:	75 09                	jne    4013f5 &lt;phase_0+0x56&gt;</span><br><span class="line">  4013ec:	48 81 c4 00 02 00 00 	add    $0x200,%rsp</span><br><span class="line">  4013f3:	5b                   	pop    %rbx</span><br><span class="line">  4013f4:	c3                   	retq   </span><br><span class="line">  4013f5:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  4013fa:	e8 e5 03 00 00       	callq  4017e4 &lt;sad_ending&gt;</span><br><span class="line">  4013ff:	eb eb                	jmp    4013ec &lt;phase_0+0x4d&gt;</span><br></pre></td></tr></table></figure>
<hr>
<p>我不再像Bomb Lab中进行分段分析。直接找到会导致<code>sad_ending</code>的条件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">4013e3:	e8 93 07 00 00       	callq  401b7b &lt;_strncmp&gt;</span><br><span class="line">4013e8:	85 c0                	test   %eax,%eax</span><br><span class="line">4013ea:	75 09                	jne    4013f5 &lt;phase_0+0x56&gt;</span><br><span class="line">...  </span><br><span class="line">4013f5:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">4013fa:	e8 e5 03 00 00       	callq  4017e4 &lt;sad_ending&gt;</span><br></pre></td></tr></table></figure>
<p>4013e3调用了<code>_strncmp</code>函数，指导中给出了说明：</p>
<blockquote>
<p><code>_strncmp(char *, char *, int)</code>：对两个字符串进行比较</p>
</blockquote>
<p>然后4013e8和4013ea判断返回值<code>%eax</code>是否为零，不为零则跳到4013f5，继续执行导致<code>sad_ending</code>。</p>
<p>得出结论：<code>_strncmp</code>函数的返回值必须为零，即传入的两个字符串必须相等。</p>
<hr>
<p>下面就找一下传入的参数分别是什么，即<code>%rdi</code>、<code>%rsi</code>和<code>%rdx</code>的值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">4013d4:	ba 30 00 00 00       	mov    $0x30,%edx</span><br><span class="line">4013d9:	48 89 de             	mov    %rbx,%rsi</span><br><span class="line">4013dc:	48 8d 3d 75 0c 00 00 	lea    0xc75(%rip),%rdi        # 402058 &lt;_IO_stdin_used+0x58&gt;</span><br></pre></td></tr></table></figure>
<p>可以看出：</p>
<ul>
<li><code>%rdi</code>存放的是地址<code>0x402058</code>；</li>
<li><code>%rsi</code>存放的是<code>%rbx</code>的值；</li>
<li><code>%rdx</code>的值为0x30。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">4013cc:	48 89 df             	mov    %rbx,%rdi</span><br><span class="line">4013cf:	e8 d5 03 00 00       	callq  4017a9 &lt;read_line&gt;</span><br></pre></td></tr></table></figure>
<p>发现4013cc将<code>%rbx</code>传给<code>read_line</code>读取一行字符串，即<code>%rbx</code>存放的是我们输入的字符串的地址，即为<code>%rsi</code>的值。</p>
<hr>
<p>利用<code>gdb</code>查看地址<code>0x402058</code>处的值：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gdb exam</span><br><span class="line">(gdb) x/s 0x402058</span><br></pre></td></tr></table></figure>
<p>得到输出如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x402058:	&quot;But we loved with a love that was more than love&quot;</span><br></pre></td></tr></table></figure>
<p>这句“But we loved with a love that was more than love”出自<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%AE%89%E5%A8%9C%E8%B4%9D%E5%B0%94%C2%B7%E4%B8%BD">安娜贝尔·丽</a>，意为“可我们的爱超越一切，无人能及”。</p>
<p>全诗放在文章结尾，供欣赏。</p>
<hr>
<p>现在已经很清楚了，传给<code>_strncmp</code>的三个参数分别为上面的诗句、我们输入的字符串和0x30。可以发现，诗句的长度就是48个字符，也就是0x30个字符。</p>
<p>综上，<code>phase_0</code>的密码就是：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">But we loved with a love that was more than love</span><br></pre></td></tr></table></figure>
<hr>
<p>但是注意本次实验与Bomb Lab的不同之处，要求所有的输入均通过<code>data.txt</code>并利用<code>hex2raw</code>，所以需要将我们得出的所有信息均转换成十六进制字符，<strong>包括否定跳过的<code>n</code>、换行符</strong>。</p>
<p>编写用于转换成十六进制的程序<code>raw2hex</code>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> size = <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">char</span>* raw_str = (<span class="keyword">char</span>*)<span class="built_in">malloc</span>(size);</span><br><span class="line">    gets(raw_str);</span><br><span class="line">    <span class="keyword">int</span> len = <span class="built_in">strlen</span>(raw_str);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%x &quot;</span>, raw_str[i]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;0a\n&quot;</span>);</span><br><span class="line">    <span class="built_in">free</span>(raw_str);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将字符串转换成ascii码后填入<code>data.txt</code>，别忘了前面加上否定跳过的字符。</p>
<h2 id="Phase-1-string-array"><a href="#Phase-1-string-array" class="headerlink" title="Phase 1: string array"></a>Phase 1: <em>string array</em></h2><p><code>phase_1</code>对应的汇编语句如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">0000000000401731 &lt;phase_1&gt;:</span><br><span class="line">  401731:	53                   	push   %rbx</span><br><span class="line">  401732:	48 83 ec 50          	sub    $0x50,%rsp</span><br><span class="line">  401736:	48 8b 0d 83 29 00 00 	mov    0x2983(%rip),%rcx        # 4040c0 &lt;stdout@@GLIBC_2.2.5&gt;</span><br><span class="line">  40173d:	ba 17 00 00 00       	mov    $0x17,%edx</span><br><span class="line">  401742:	be 01 00 00 00       	mov    $0x1,%esi</span><br><span class="line">  401747:	48 8d 3d 6f 09 00 00 	lea    0x96f(%rip),%rdi        # 4020bd &lt;_IO_stdin_used+0xbd&gt;</span><br><span class="line">  40174e:	e8 ad f9 ff ff       	callq  401100 &lt;fwrite@plt&gt;</span><br><span class="line">  401753:	48 89 e3             	mov    %rsp,%rbx</span><br><span class="line">  401756:	be 50 00 00 00       	mov    $0x50,%esi</span><br><span class="line">  40175b:	48 89 df             	mov    %rbx,%rdi</span><br><span class="line">  40175e:	e8 46 00 00 00       	callq  4017a9 &lt;read_line&gt;</span><br><span class="line">  401763:	48 89 df             	mov    %rbx,%rdi</span><br><span class="line">  401766:	e8 5f 04 00 00       	callq  401bca &lt;_strlen&gt;</span><br><span class="line">  40176b:	83 f8 04             	cmp    $0x4,%eax</span><br><span class="line">  40176e:	7e 21                	jle    401791 &lt;phase_1+0x60&gt;</span><br><span class="line">  401770:	80 3c 24 39          	cmpb   $0x39,(%rsp)</span><br><span class="line">  401774:	75 27                	jne    40179d &lt;phase_1+0x6c&gt;</span><br><span class="line">  401776:	80 7c 24 01 51       	cmpb   $0x51,0x1(%rsp)</span><br><span class="line">  40177b:	75 20                	jne    40179d &lt;phase_1+0x6c&gt;</span><br><span class="line">  40177d:	80 7c 24 02 2a       	cmpb   $0x2a,0x2(%rsp)</span><br><span class="line">  401782:	75 19                	jne    40179d &lt;phase_1+0x6c&gt;</span><br><span class="line">  401784:	80 7c 24 03 61       	cmpb   $0x61,0x3(%rsp)</span><br><span class="line">  401789:	75 12                	jne    40179d &lt;phase_1+0x6c&gt;</span><br><span class="line">  40178b:	48 83 c4 50          	add    $0x50,%rsp</span><br><span class="line">  40178f:	5b                   	pop    %rbx</span><br><span class="line">  401790:	c3                   	retq   </span><br><span class="line">  401791:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  401796:	e8 49 00 00 00       	callq  4017e4 &lt;sad_ending&gt;</span><br><span class="line">  40179b:	eb d3                	jmp    401770 &lt;phase_1+0x3f&gt;</span><br><span class="line">  40179d:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  4017a2:	e8 3d 00 00 00       	callq  4017e4 &lt;sad_ending&gt;</span><br><span class="line">  4017a7:	eb e2                	jmp    40178b &lt;phase_1+0x5a&gt;</span><br></pre></td></tr></table></figure>
<hr>
<p>找到会调用<code>sad_ending</code>的语句：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">401763:	48 89 df             	mov    %rbx,%rdi</span><br><span class="line">401766:	e8 5f 04 00 00       	callq  401bca &lt;_strlen&gt;</span><br><span class="line">40176b:	83 f8 04             	cmp    $0x4,%eax</span><br><span class="line">40176e:	7e 21                	jle    401791 &lt;phase_1+0x60&gt;</span><br><span class="line">401770:	80 3c 24 39          	cmpb   $0x39,(%rsp)</span><br><span class="line">401774:	75 27                	jne    40179d &lt;phase_1+0x6c&gt;</span><br><span class="line">401776:	80 7c 24 01 51       	cmpb   $0x51,0x1(%rsp)</span><br><span class="line">40177b:	75 20                	jne    40179d &lt;phase_1+0x6c&gt;</span><br><span class="line">40177d:	80 7c 24 02 2a       	cmpb   $0x2a,0x2(%rsp)</span><br><span class="line">401782:	75 19                	jne    40179d &lt;phase_1+0x6c&gt;</span><br><span class="line">401784:	80 7c 24 03 61       	cmpb   $0x61,0x3(%rsp)</span><br><span class="line">401789:	75 12                	jne    40179d &lt;phase_1+0x6c&gt;</span><br><span class="line">...</span><br><span class="line">401791:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">401796:	e8 49 00 00 00       	callq  4017e4 &lt;sad_ending&gt;</span><br><span class="line">...</span><br><span class="line">40179d:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">4017a2:	e8 3d 00 00 00       	callq  4017e4 &lt;sad_ending&gt;</span><br></pre></td></tr></table></figure>
<p>401763和401766把<code>%rbx</code>传参并调用<code>_strlen</code>：</p>
<blockquote>
<p><code>_strlen(char *)</code>：计算字符串的长度</p>
</blockquote>
<p>然后40176b和40176e判断其返回值是否不超过4，若不超过4则跳到401791，继续执行导致<code>sad_ending</code>。可知<code>%rbx</code>处的字符串长度至少为5。</p>
<p>401770～401789分别判断了<code>%rsp</code>处的前4个值是否依次为<code>0x39</code>、<code>0x51</code>、<code>0x2a</code>和<code>0x61</code>，有一个不相等则跳到40179d，继续执行导致<code>sad_ending</code>。可知<code>%rsp</code>处的前4个值必须依次为<code>0x39</code>、<code>0x51</code>、<code>0x2a</code>和<code>0x61</code>。</p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">401753:	48 89 e3             	mov    %rsp,%rbx</span><br><span class="line">...</span><br><span class="line">40175b:	48 89 df             	mov    %rbx,%rdi</span><br><span class="line">40175e:	e8 46 00 00 00       	callq  4017a9 &lt;read_line&gt;</span><br></pre></td></tr></table></figure>
<p>401753将<code>%rsp</code>传给了<code>%rbx</code>，40175b和40175e又将<code>%rbx</code>传给了<code>%rdi</code>作为参数调用<code>read_line</code>读取一行输入。</p>
<p>可知<code>%rsp</code>和<code>%rbx</code>均指向了我们输入的字符串。</p>
<p>注意<code>0x0a</code>也会记入读入字符串的长度，且理论上在后面添加任意字符均可（长度大于4即可）。</p>
<p>但如果在<code>0x61</code>之后添加<code>0x00</code>，当<code>_strlen</code>判断时会提前终止，返回字符串长度为4，导致<code>sad_ending</code>。</p>
<hr>
<p>综上分析，<code>phase_1</code>的密码就是：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">39 51 2a 61</span><br></pre></td></tr></table></figure>
<h2 id="Phase-2-link-list-amp-recursion"><a href="#Phase-2-link-list-amp-recursion" class="headerlink" title="Phase 2: link list&amp;recursion"></a>Phase 2: <em>link list&amp;recursion</em></h2><h3 id="phase-2"><a href="#phase-2" class="headerlink" title="phase_2"></a><code>phase_2</code></h3><p><code>phase_2</code>对应的汇编语句如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">0000000000401ae0 &lt;phase_2&gt;:</span><br><span class="line">  401ae0:	41 55                	push   %r13</span><br><span class="line">  401ae2:	41 54                	push   %r12</span><br><span class="line">  401ae4:	55                   	push   %rbp</span><br><span class="line">  401ae5:	53                   	push   %rbx</span><br><span class="line">  401ae6:	48 83 ec 58          	sub    $0x58,%rsp</span><br><span class="line">  401aea:	48 8b 0d cf 25 00 00 	mov    0x25cf(%rip),%rcx        # 4040c0 &lt;stdout@@GLIBC_2.2.5&gt;</span><br><span class="line">  401af1:	ba 17 00 00 00       	mov    $0x17,%edx</span><br><span class="line">  401af6:	be 01 00 00 00       	mov    $0x1,%esi</span><br><span class="line">  401afb:	48 8d 3d d2 07 00 00 	lea    0x7d2(%rip),%rdi        # 4022d4 &lt;_IO_stdin_used+0x2d4&gt;</span><br><span class="line">  401b02:	e8 f9 f5 ff ff       	callq  401100 &lt;fwrite@plt&gt;</span><br><span class="line">  401b07:	48 89 e7             	mov    %rsp,%rdi</span><br><span class="line">  401b0a:	be 50 00 00 00       	mov    $0x50,%esi</span><br><span class="line">  401b0f:	e8 95 fc ff ff       	callq  4017a9 &lt;read_line&gt;</span><br><span class="line">  401b14:	bf 10 00 00 00       	mov    $0x10,%edi</span><br><span class="line">  401b19:	e8 a2 f5 ff ff       	callq  4010c0 &lt;malloc@plt&gt;</span><br><span class="line">  401b1e:	48 89 c3             	mov    %rax,%rbx</span><br><span class="line">  401b21:	48 8d 2d c4 07 00 00 	lea    0x7c4(%rip),%rbp        # 4022ec &lt;_IO_stdin_used+0x2ec&gt;</span><br><span class="line">  401b28:	4c 8d 65 0a          	lea    0xa(%rbp),%r12</span><br><span class="line">  401b2c:	49 89 c5             	mov    %rax,%r13</span><br><span class="line">  401b2f:	bf 10 00 00 00       	mov    $0x10,%edi</span><br><span class="line">  401b34:	e8 87 f5 ff ff       	callq  4010c0 &lt;malloc@plt&gt;</span><br><span class="line">  401b39:	49 89 45 08          	mov    %rax,0x8(%r13)</span><br><span class="line">  401b3d:	0f b6 55 00          	movzbl 0x0(%rbp),%edx</span><br><span class="line">  401b41:	88 10                	mov    %dl,(%rax)</span><br><span class="line">  401b43:	48 c7 40 08 00 00 00 	movq   $0x0,0x8(%rax)</span><br><span class="line">  401b4a:	00 </span><br><span class="line">  401b4b:	48 83 c5 01          	add    $0x1,%rbp</span><br><span class="line">  401b4f:	4c 39 e5             	cmp    %r12,%rbp</span><br><span class="line">  401b52:	75 d8                	jne    401b2c &lt;phase_2+0x4c&gt;</span><br><span class="line">  401b54:	48 89 e6             	mov    %rsp,%rsi</span><br><span class="line">  401b57:	48 8b 7b 08          	mov    0x8(%rbx),%rdi</span><br><span class="line">  401b5b:	e8 39 ff ff ff       	callq  401a99 &lt;recursion&gt;</span><br><span class="line">  401b60:	85 c0                	test   %eax,%eax</span><br><span class="line">  401b62:	75 0b                	jne    401b6f &lt;phase_2+0x8f&gt;</span><br><span class="line">  401b64:	48 83 c4 58          	add    $0x58,%rsp</span><br><span class="line">  401b68:	5b                   	pop    %rbx</span><br><span class="line">  401b69:	5d                   	pop    %rbp</span><br><span class="line">  401b6a:	41 5c                	pop    %r12</span><br><span class="line">  401b6c:	41 5d                	pop    %r13</span><br><span class="line">  401b6e:	c3                   	retq   </span><br><span class="line">  401b6f:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  401b74:	e8 6b fc ff ff       	callq  4017e4 &lt;sad_ending&gt;</span><br><span class="line">  401b79:	eb e9                	jmp    401b64 &lt;phase_2+0x84&gt;</span><br></pre></td></tr></table></figure>
<hr>
<p><code>phase_2</code>的结构较为复杂，它和<code>phase_3</code>一起，作为整个实验的核心，下面分段分析：</p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">401ae0:	41 55                	push   %r13</span><br><span class="line">401ae2:	41 54                	push   %r12</span><br><span class="line">401ae4:	55                   	push   %rbp</span><br><span class="line">401ae5:	53                   	push   %rbx</span><br><span class="line">401ae6:	48 83 ec 58          	sub    $0x58,%rsp</span><br><span class="line">401aea:	48 8b 0d cf 25 00 00 	mov    0x25cf(%rip),%rcx        # 4040c0 &lt;stdout@@GLIBC_2.2.5&gt;</span><br><span class="line">401af1:	ba 17 00 00 00       	mov    $0x17,%edx</span><br><span class="line">401af6:	be 01 00 00 00       	mov    $0x1,%esi</span><br><span class="line">401afb:	48 8d 3d d2 07 00 00 	lea    0x7d2(%rip),%rdi        # 4022d4 &lt;_IO_stdin_used+0x2d4&gt;</span><br><span class="line">401b02:	e8 f9 f5 ff ff       	callq  401100 &lt;fwrite@plt&gt;</span><br></pre></td></tr></table></figure>
<p>401ae0～401ae5将<code>%r13</code>、<code>%r12</code>、<code>%rbp</code>和<code>%rbx</code>依次压入栈，401ae6将栈顶指针移动<code>0x58</code>。</p>
<p>401aea把地址0x4040c0给<code>%rcx</code>。</p>
<p>401af1～401b02调用<code>fwrite</code>函数，参数分别是地址0x4022d4、0x1和0x17，是用于提示的字符串。</p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">401b07:	48 89 e7             	mov    %rsp,%rdi</span><br><span class="line">401b0a:	be 50 00 00 00       	mov    $0x50,%esi</span><br><span class="line">401b0f:	e8 95 fc ff ff       	callq  4017a9 &lt;read_line&gt;</span><br></pre></td></tr></table></figure>
<p>401b07～401b0f调用<code>read_line</code>函数，参数分别是<code>%rsp</code>和0x50，即把我们输入的字符串存放到<code>%rsp</code>处，且最大长度是0x50。</p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">401b14:	bf 10 00 00 00       	mov    $0x10,%edi</span><br><span class="line">401b19:	e8 a2 f5 ff ff       	callq  4010c0 &lt;malloc@plt&gt;</span><br><span class="line">401b1e:	48 89 c3             	mov    %rax,%rbx</span><br><span class="line">401b21:	48 8d 2d c4 07 00 00 	lea    0x7c4(%rip),%rbp        # 4022ec &lt;_IO_stdin_used+0x2ec&gt;</span><br><span class="line">401b28:	4c 8d 65 0a          	lea    0xa(%rbp),%r12</span><br><span class="line">401b2c:	49 89 c5             	mov    %rax,%r13</span><br><span class="line">401b2f:	bf 10 00 00 00       	mov    $0x10,%edi</span><br><span class="line">401b34:	e8 87 f5 ff ff       	callq  4010c0 &lt;malloc@plt&gt;</span><br><span class="line">401b39:	49 89 45 08          	mov    %rax,0x8(%r13)</span><br><span class="line">401b3d:	0f b6 55 00          	movzbl 0x0(%rbp),%edx</span><br><span class="line">401b41:	88 10                	mov    %dl,(%rax)</span><br><span class="line">401b43:	48 c7 40 08 00 00 00 	movq   $0x0,0x8(%rax)</span><br><span class="line">401b4a:	00 </span><br><span class="line">401b4b:	48 83 c5 01          	add    $0x1,%rbp</span><br><span class="line">401b4f:	4c 39 e5             	cmp    %r12,%rbp</span><br><span class="line">401b52:	75 d8                	jne    401b2c &lt;phase_2+0x4c&gt;</span><br></pre></td></tr></table></figure>
<p>401b14～401b1e调用<code>malloc</code>函数分配内存，参数是0x10，返回值给了<code>%rbx</code>，即分配了0x10大小的空间，其地址存放在<code>%rbx</code>处。</p>
<p>下面为<code>for</code>循环，转换成C代码，并适当改写：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>* <span class="built_in">list</span> = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>]; <span class="comment">// %rax</span></span><br><span class="line"><span class="keyword">int</span>* head = <span class="built_in">list</span>; <span class="comment">// %rbx</span></span><br><span class="line"><span class="keyword">char</span>* str = <span class="number">0x4022ec</span>; <span class="comment">// %rbp</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i != <span class="number">10</span>; i++) &#123; <span class="comment">// %rbp != %r12</span></span><br><span class="line">	<span class="keyword">int</span>* temp = <span class="built_in">list</span>; <span class="comment">// %rax-&gt;%r13</span></span><br><span class="line">  temp[<span class="number">1</span>] = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>]; <span class="comment">// %r13+8</span></span><br><span class="line">  <span class="built_in">list</span> = temp; <span class="comment">// return of malloc</span></span><br><span class="line">  <span class="built_in">list</span>[<span class="number">0</span>] = str[i]; <span class="comment">// %rbp-&gt;%edx-&gt;(%rax)</span></span><br><span class="line">  <span class="built_in">list</span>[<span class="number">1</span>] = <span class="literal">NULL</span>; <span class="comment">// 0-&gt;(%rax+8)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以发现此处创建了一个带头链表，头指针存放在<code>%rbx</code>中，<code>list[0]</code>为数据域、<code>list[1]</code>为指针域。并将<code>0x4022ec</code>处的字符串的每个字符存放到链表中，可以看出一共有10个字符。</p>
<p>利用<code>gdb</code>查看<code>0x4022ec</code>处的字符串的ascii码：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gdb exam</span><br><span class="line">(gdb) x/10x 0x4022ec</span><br></pre></td></tr></table></figure>
<p>得到输出如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0x4022ec:	0x4c	0x6f	0x28	0x79	0x68	0x77	0x43	0x2c</span><br><span class="line">0x4022f4:	0x24	0x47</span><br></pre></td></tr></table></figure>
<p>即10个字符的ascii码为：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x4c	0x6f	0x28	0x79	0x68	0x77	0x43	0x2c  0x24	0x47</span><br></pre></td></tr></table></figure>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">401b54:	48 89 e6             	mov    %rsp,%rsi</span><br><span class="line">401b57:	48 8b 7b 08          	mov    0x8(%rbx),%rdi</span><br><span class="line">401b5b:	e8 39 ff ff ff       	callq  401a99 &lt;recursion&gt;</span><br><span class="line">401b60:	85 c0                	test   %eax,%eax</span><br><span class="line">401b62:	75 0b                	jne    401b6f &lt;phase_2+0x8f&gt;</span><br><span class="line">401b64:	48 83 c4 58          	add    $0x58,%rsp</span><br><span class="line">401b68:	5b                   	pop    %rbx</span><br><span class="line">401b69:	5d                   	pop    %rbp</span><br><span class="line">401b6a:	41 5c                	pop    %r12</span><br><span class="line">401b6c:	41 5d                	pop    %r13</span><br><span class="line">401b6e:	c3                   	retq   </span><br><span class="line">401b6f:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">401b74:	e8 6b fc ff ff       	callq  4017e4 &lt;sad_ending&gt;</span><br><span class="line">401b79:	eb e9                	jmp    401b64 &lt;phase_2+0x84&gt;</span><br></pre></td></tr></table></figure>
<p>401b54～401b5b调用<code>recursion</code>函数，将<code>%rsp</code>传给<code>%rsi</code>，即将我们输入的字符串作为第二个参数；将<code>%rbx+8</code>传给<code>%rdi</code>，即将链表起始地址作为第一个参数。</p>
<p>401b60和401b62检查<code>recursion</code>函数的返回值是否为零，若不为零则跳到401b6f，继续执行导致<code>sad_ending</code>。可知<code>recursion</code>函数的返回值必须为零。</p>
<p>无论是否<code>sad_ending</code>，最后执行401b64～401b6e，弹栈返回。</p>
<h3 id="recursion"><a href="#recursion" class="headerlink" title="recursion"></a><code>recursion</code></h3><p><code>recursion</code>函数对应的汇编语句如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">0000000000401a99 &lt;recursion&gt;:</span><br><span class="line">  401a99:	48 85 ff             	test   %rdi,%rdi</span><br><span class="line">  401a9c:	74 2a                	je     401ac8 &lt;recursion+0x2f&gt;</span><br><span class="line">  401a9e:	0f b6 06             	movzbl (%rsi),%eax</span><br><span class="line">  401aa1:	3c 0a                	cmp    $0xa,%al</span><br><span class="line">  401aa3:	74 2f                	je     401ad4 &lt;recursion+0x3b&gt;</span><br><span class="line">  401aa5:	0f be 17             	movsbl (%rdi),%edx</span><br><span class="line">  401aa8:	83 c2 01             	add    $0x1,%edx</span><br><span class="line">  401aab:	0f be c0             	movsbl %al,%eax</span><br><span class="line">  401aae:	39 c2                	cmp    %eax,%edx</span><br><span class="line">  401ab0:	75 28                	jne    401ada &lt;recursion+0x41&gt;</span><br><span class="line">  401ab2:	48 83 ec 08          	sub    $0x8,%rsp</span><br><span class="line">  401ab6:	48 83 c6 01          	add    $0x1,%rsi</span><br><span class="line">  401aba:	48 8b 7f 08          	mov    0x8(%rdi),%rdi</span><br><span class="line">  401abe:	e8 d6 ff ff ff       	callq  401a99 &lt;recursion&gt;</span><br><span class="line">  401ac3:	48 83 c4 08          	add    $0x8,%rsp</span><br><span class="line">  401ac7:	c3                   	retq   </span><br><span class="line">  401ac8:	80 3e 0a             	cmpb   $0xa,(%rsi)</span><br><span class="line">  401acb:	0f 95 c0             	setne  %al</span><br><span class="line">  401ace:	0f b6 c0             	movzbl %al,%eax</span><br><span class="line">  401ad1:	f7 d8                	neg    %eax</span><br><span class="line">  401ad3:	c3                   	retq   </span><br><span class="line">  401ad4:	b8 ff ff ff ff       	mov    $0xffffffff,%eax</span><br><span class="line">  401ad9:	c3                   	retq   </span><br><span class="line">  401ada:	b8 ff ff ff ff       	mov    $0xffffffff,%eax</span><br><span class="line">  401adf:	c3                   	retq</span><br></pre></td></tr></table></figure>
<hr>
<p>从名字可以看出，它是一个递归函数，实际上也是如此。</p>
<p>转换成C代码，并适当改写：</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> index = <span class="number">0</span>; <span class="comment">// index of input string</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">recursion</span><span class="params">(<span class="keyword">int</span>* <span class="built_in">list</span>, <span class="keyword">int</span> index)</span> </span>&#123; <span class="comment">// %rdi(link list), %rsi(index of input string)</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">list</span> == <span class="literal">NULL</span>) &#123; <span class="comment">// %rdi == 0</span></span><br><span class="line">    <span class="keyword">if</span> (input[index] == <span class="number">0x0a</span>) <span class="comment">// (%rsi) == 0xa</span></span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">char</span> a = input[index]; <span class="comment">// (%rsi)-&gt;%eax</span></span><br><span class="line">  <span class="keyword">if</span> (a == <span class="number">0x0a</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  <span class="keyword">char</span> b = <span class="built_in">list</span>-&gt;data; <span class="comment">// (%rdi)-&gt;%edx</span></span><br><span class="line">  b++; <span class="comment">//%edx++</span></span><br><span class="line">  <span class="keyword">if</span> (a != b)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  </span><br><span class="line">  index++; <span class="comment">// %rsi++</span></span><br><span class="line">  <span class="built_in">list</span> = <span class="built_in">list</span>-&gt;next; <span class="comment">// %rdi+=8</span></span><br><span class="line">  recursion(<span class="built_in">list</span>, index);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看出，递归函数的功能是将链表中存放的字符串的每个字符增1后与我们输入的字符串的每个字符进行比较，全部相等则返回0，否则返回1。</p>
<hr>
<p>综上分析，我们只需输入已知字符串加1后的结果即可。</p>
<p>所以，<code>phase_2</code>的密码就是：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4d 70 29 7a 69 78 44 2d 25 48 0a</span><br></pre></td></tr></table></figure>
<hr>
<p>如果你觉得拆弹实验很有趣，不妨做一下更有趣的Bomb Lab。</p>
<h1 id="任务三——程序局部性特性分析"><a href="#任务三——程序局部性特性分析" class="headerlink" title="任务三——程序局部性特性分析"></a>任务三——程序局部性特性分析</h1><p>什么是程序的局部性？</p>
<blockquote>
<p>程序倾向于引用邻近于<strong>其他最近引用过的数据项</strong>的数据项，或者最近引用过的数据项本身，这种倾向性被称为<strong>局部性原理（principle of locality）</strong>。</p>
</blockquote>
<p>局部性有何种形式？</p>
<blockquote>
<p>局部性分为<strong>时间局部性（temporal locality）</strong>和<strong>空间局部性（spatial locality）</strong>：</p>
<ul>
<li>在一个具有良好时间局部性的程序中，被引用过一次的内存位置很可能在不远的将来再被多次引用；</li>
<li>在一个具有良好空间局部性的程序中，如果一个内存位置被引用了一次，那么程序很可能在不远的将来引用附近的一个内存位置。</li>
</ul>
</blockquote>
<p>局部性有什么作用？</p>
<blockquote>
<p>有良好局部性的程序比局部性差的程序运行得更快。</p>
</blockquote>
<p>如何量化评价程序的局部性？</p>
<blockquote>
<ul>
<li><strong>重复引用</strong>相同变量的程序有良好的时间局部性。</li>
<li>对于具有步长为<code>k</code>的引用模式的程序，<strong>步长越小</strong>，空间局部性越好。具有步长为1的引用模式的程序有很好的空间局部性。在内存中以大步长跳来跳去的程序空间局部性会很差。</li>
<li>对于取指令来说，<strong>循环</strong>有好的时间和空间局部性。循环体越小，循环迭代次数越多，局部性越好。</li>
</ul>
</blockquote>
<hr>
<h2 id="Phase-3-switch"><a href="#Phase-3-switch" class="headerlink" title="Phase 3: switch"></a>Phase 3: <em>switch</em></h2><p><code>phase_3</code>对应的汇编语句如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">0000000000401325 &lt;phase_3&gt;:</span><br><span class="line">  401325:	48 83 ec 18          	sub    $0x18,%rsp</span><br><span class="line">  401329:	48 8b 0d 90 2d 00 00 	mov    0x2d90(%rip),%rcx        # 4040c0 &lt;stdout@@GLIBC_2.2.5&gt;</span><br><span class="line">  401330:	ba 31 00 00 00       	mov    $0x31,%edx</span><br><span class="line">  401335:	be 01 00 00 00       	mov    $0x1,%esi</span><br><span class="line">  40133a:	48 8d 3d c7 0c 00 00 	lea    0xcc7(%rip),%rdi        # 402008 &lt;_IO_stdin_used+0x8&gt;</span><br><span class="line">  401341:	e8 ba fd ff ff       	callq  401100 &lt;fwrite@plt&gt;</span><br><span class="line">  401346:	48 8d 7c 24 0b       	lea    0xb(%rsp),%rdi</span><br><span class="line">  40134b:	be 05 00 00 00       	mov    $0x5,%esi</span><br><span class="line">  401350:	e8 54 04 00 00       	callq  4017a9 &lt;read_line&gt;</span><br><span class="line">  401355:	0f b6 44 24 0b       	movzbl 0xb(%rsp),%eax</span><br><span class="line">  40135a:	3c 30                	cmp    $0x30,%al</span><br><span class="line">  40135c:	74 17                	je     401375 &lt;phase_3+0x50&gt;</span><br><span class="line">  40135e:	3c 31                	cmp    $0x31,%al</span><br><span class="line">  401360:	74 21                	je     401383 &lt;phase_3+0x5e&gt;</span><br><span class="line">  401362:	3c 32                	cmp    $0x32,%al</span><br><span class="line">  401364:	74 2b                	je     401391 &lt;phase_3+0x6c&gt;</span><br><span class="line">  401366:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  40136b:	e8 74 04 00 00       	callq  4017e4 &lt;sad_ending&gt;</span><br><span class="line">  401370:	48 83 c4 18          	add    $0x18,%rsp</span><br><span class="line">  401374:	c3                   	retq   </span><br><span class="line">  401375:	48 8d 3d 84 2d 00 00 	lea    0x2d84(%rip),%rdi        # 404100 &lt;array&gt;</span><br><span class="line">  40137c:	e8 fb fe ff ff       	callq  40127c &lt;sum_0&gt;</span><br><span class="line">  401381:	eb ed                	jmp    401370 &lt;phase_3+0x4b&gt;</span><br><span class="line">  401383:	48 8d 3d 76 2d 00 00 	lea    0x2d76(%rip),%rdi        # 404100 &lt;array&gt;</span><br><span class="line">  40138a:	e8 45 ff ff ff       	callq  4012d4 &lt;sum_1&gt;</span><br><span class="line">  40138f:	eb df                	jmp    401370 &lt;phase_3+0x4b&gt;</span><br><span class="line">  401391:	48 8d 3d 68 2d 00 00 	lea    0x2d68(%rip),%rdi        # 404100 &lt;array&gt;</span><br><span class="line">  401398:	e8 89 fe ff ff       	callq  401226 &lt;sum_2&gt;</span><br><span class="line">  40139d:	eb d1                	jmp    401370 &lt;phase_3+0x4b&gt;</span><br></pre></td></tr></table></figure>
<hr>
<p>可以看出其核心是：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> (x) &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="number">0x30</span>: &#123;sum_0(<span class="built_in">array</span>);<span class="keyword">break</span>;&#125; <span class="comment">// array from 0x401000</span></span><br><span class="line">  <span class="keyword">case</span> <span class="number">0x31</span>: &#123;sum_1(<span class="built_in">array</span>);<span class="keyword">break</span>;&#125; <span class="comment">// array from 0x401000</span></span><br><span class="line">  <span class="keyword">case</span> <span class="number">0x32</span>: &#123;sum_2(<span class="built_in">array</span>);<span class="keyword">break</span>;&#125; <span class="comment">// array from 0x401000</span></span><br><span class="line">  <span class="keyword">default</span>: sad_ending();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们需要分析三个<code>sum</code>函数，选择局部性最好的一个，并输入对应的符号（<code>0x30</code>、<code>0x31</code>或<code>0x32</code>）。</p>
<h2 id="sum-loop"><a href="#sum-loop" class="headerlink" title="sum: loop"></a>sum: <em>loop</em></h2><p>三个<code>sum</code>函数的参数都是一个数组，但使用不同的算法实现了相同的功能。</p>
<p>根据名字推测其功能是对数组求和。</p>
<p><code>phase_3</code>中<code>sum</code>的结构较为复杂，它和<code>phase_2</code>一起，作为整个实验的核心。</p>
<h3 id="sum-0"><a href="#sum-0" class="headerlink" title="sum_0"></a><code>sum_0</code></h3><p><code>sum_0</code>对应的汇编语句如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">000000000040127c &lt;sum_0&gt;:</span><br><span class="line">  40127c:	48 8d b7 00 02 20 00 	lea    0x200200(%rdi),%rsi</span><br><span class="line">  401283:	bf 00 00 00 00       	mov    $0x0,%edi</span><br><span class="line">  401288:	ba 00 00 00 00       	mov    $0x0,%edx</span><br><span class="line">  40128d:	eb 38                	jmp    4012c7 &lt;sum_0+0x4b&gt;</span><br><span class="line">  40128f:	48 81 c1 00 80 00 00 	add    $0x8000,%rcx</span><br><span class="line">  401296:	48 39 f1             	cmp    %rsi,%rcx</span><br><span class="line">  401299:	74 15                	je     4012b0 &lt;sum_0+0x34&gt;</span><br><span class="line">  40129b:	48 8d 81 00 fe ff ff 	lea    -0x200(%rcx),%rax</span><br><span class="line">  4012a2:	48 03 10             	add    (%rax),%rdx</span><br><span class="line">  4012a5:	48 83 c0 08          	add    $0x8,%rax</span><br><span class="line">  4012a9:	48 39 c8             	cmp    %rcx,%rax</span><br><span class="line">  4012ac:	75 f4                	jne    4012a2 &lt;sum_0+0x26&gt;</span><br><span class="line">  4012ae:	eb df                	jmp    40128f &lt;sum_0+0x13&gt;</span><br><span class="line">  4012b0:	48 81 c6 00 02 00 00 	add    $0x200,%rsi</span><br><span class="line">  4012b7:	48 81 c7 00 02 00 00 	add    $0x200,%rdi</span><br><span class="line">  4012be:	48 81 ff 00 80 00 00 	cmp    $0x8000,%rdi</span><br><span class="line">  4012c5:	74 09                	je     4012d0 &lt;sum_0+0x54&gt;</span><br><span class="line">  4012c7:	48 8d 8e 00 00 e0 ff 	lea    -0x200000(%rsi),%rcx</span><br><span class="line">  4012ce:	eb cb                	jmp    40129b &lt;sum_0+0x1f&gt;</span><br><span class="line">  4012d0:	48 89 d0             	mov    %rdx,%rax</span><br><span class="line">  4012d3:	c3                   	retq </span><br></pre></td></tr></table></figure>
<hr>
<p>转换成C代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sum_0</span><span class="params">(<span class="keyword">int</span>* <span class="built_in">array</span>)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> sum = <span class="number">0</span>; <span class="comment">// %edx</span></span><br><span class="line">  <span class="keyword">int</span>* end = <span class="built_in">array</span> + <span class="number">262208</span>; <span class="comment">// 0x200200(%rdi)-&gt;%rsi</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i != <span class="number">32768</span>; end += <span class="number">64</span>, i += <span class="number">512</span>) <span class="comment">// 0x0-&gt;%edi</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span>* mid = end - <span class="number">262144</span>; mid != end; mid += <span class="number">4096</span>) <span class="comment">// -0x200000(%rsi)-&gt;%rcx</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span>* begin = mid - <span class="number">64</span>; begin != mid; begin++) <span class="comment">// -0x200(%rcx)-&gt;%rax</span></span><br><span class="line">        sum += *begin;</span><br><span class="line">  <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="sum-1"><a href="#sum-1" class="headerlink" title="sum_1"></a><code>sum_1</code></h3><p><code>sum_1</code>对应的汇编语句如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">00000000004012d4 &lt;sum_1&gt;:</span><br><span class="line">  4012d4:	48 8d b7 00 80 20 00 	lea    0x208000(%rdi),%rsi</span><br><span class="line">  4012db:	ba 00 00 00 00       	mov    $0x0,%edx</span><br><span class="line">  4012e0:	bf 00 00 00 00       	mov    $0x0,%edi</span><br><span class="line">  4012e5:	eb 31                	jmp    401318 &lt;sum_1+0x44&gt;</span><br><span class="line">  4012e7:	48 81 c1 00 02 00 00 	add    $0x200,%rcx</span><br><span class="line">  4012ee:	48 39 f1             	cmp    %rsi,%rcx</span><br><span class="line">  4012f1:	74 17                	je     40130a &lt;sum_1+0x36&gt;</span><br><span class="line">  4012f3:	48 8d 81 00 00 e0 ff 	lea    -0x200000(%rcx),%rax</span><br><span class="line">  4012fa:	48 03 10             	add    (%rax),%rdx</span><br><span class="line">  4012fd:	48 05 00 80 00 00    	add    $0x8000,%rax</span><br><span class="line">  401303:	48 39 c8             	cmp    %rcx,%rax</span><br><span class="line">  401306:	75 f2                	jne    4012fa &lt;sum_1+0x26&gt;</span><br><span class="line">  401308:	eb dd                	jmp    4012e7 &lt;sum_1+0x13&gt;</span><br><span class="line">  40130a:	48 83 c7 01          	add    $0x1,%rdi</span><br><span class="line">  40130e:	48 83 c6 08          	add    $0x8,%rsi</span><br><span class="line">  401312:	48 83 ff 40          	cmp    $0x40,%rdi</span><br><span class="line">  401316:	74 09                	je     401321 &lt;sum_1+0x4d&gt;</span><br><span class="line">  401318:	48 8d 8e 00 80 ff ff 	lea    -0x8000(%rsi),%rcx</span><br><span class="line">  40131f:	eb d2                	jmp    4012f3 &lt;sum_1+0x1f&gt;</span><br><span class="line">  401321:	48 89 d0             	mov    %rdx,%rax</span><br><span class="line">  401324:	c3                   	retq</span><br></pre></td></tr></table></figure>
<p>转换成C代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sum_1</span><span class="params">(<span class="keyword">int</span>* <span class="built_in">array</span>)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> sum = <span class="number">0</span>; <span class="comment">// %edx</span></span><br><span class="line">  <span class="keyword">int</span>* end = <span class="built_in">array</span> + <span class="number">266240</span>; <span class="comment">// 0x208000(%rdi)-&gt;%rsi</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i != <span class="number">64</span>; end++, i++) <span class="comment">// 0x0-&gt;%edi</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span>* mid = end - <span class="number">4096</span>; mid != end; mid += <span class="number">64</span>) <span class="comment">// -0x8000(%rsi)-&gt;%rcx</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span>* begin = mid - <span class="number">262144</span>; begin != mid; begin += <span class="number">4096</span>) <span class="comment">// -0x200000(%rcx)-&gt;%rax</span></span><br><span class="line">        sum += *begin;</span><br><span class="line">  <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="sum-2"><a href="#sum-2" class="headerlink" title="sum_2"></a><code>sum_2</code></h3><p><code>sum_2</code>对应的汇编语句如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">0000000000401226 &lt;sum_2&gt;:</span><br><span class="line">  401226:	48 8d b7 00 82 00 00 	lea    0x8200(%rdi),%rsi</span><br><span class="line">  40122d:	4c 8d 87 00 00 20 00 	lea    0x200000(%rdi),%r8</span><br><span class="line">  401234:	ba 00 00 00 00       	mov    $0x0,%edx</span><br><span class="line">  401239:	eb 34                	jmp    40126f &lt;sum_2+0x49&gt;</span><br><span class="line">  40123b:	48 81 c1 00 02 00 00 	add    $0x200,%rcx</span><br><span class="line">  401242:	48 39 f1             	cmp    %rsi,%rcx</span><br><span class="line">  401245:	74 15                	je     40125c &lt;sum_2+0x36&gt;</span><br><span class="line">  401247:	48 8d 81 00 fe ff ff 	lea    -0x200(%rcx),%rax</span><br><span class="line">  40124e:	48 03 10             	add    (%rax),%rdx</span><br><span class="line">  401251:	48 83 c0 08          	add    $0x8,%rax</span><br><span class="line">  401255:	48 39 c8             	cmp    %rcx,%rax</span><br><span class="line">  401258:	75 f4                	jne    40124e &lt;sum_2+0x28&gt;</span><br><span class="line">  40125a:	eb df                	jmp    40123b &lt;sum_2+0x15&gt;</span><br><span class="line">  40125c:	48 81 c6 00 80 00 00 	add    $0x8000,%rsi</span><br><span class="line">  401263:	48 81 c7 00 80 00 00 	add    $0x8000,%rdi</span><br><span class="line">  40126a:	4c 39 c7             	cmp    %r8,%rdi</span><br><span class="line">  40126d:	74 09                	je     401278 &lt;sum_2+0x52&gt;</span><br><span class="line">  40126f:	48 8d 8f 00 02 00 00 	lea    0x200(%rdi),%rcx</span><br><span class="line">  401276:	eb cf                	jmp    401247 &lt;sum_2+0x21&gt;</span><br><span class="line">  401278:	48 89 d0             	mov    %rdx,%rax</span><br><span class="line">  40127b:	c3                   	retq</span><br></pre></td></tr></table></figure>
<p>转换成C代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sum_2</span><span class="params">(<span class="keyword">int</span>* <span class="built_in">array</span>)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> sum = <span class="number">0</span>; <span class="comment">// %edx</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span>* end = <span class="built_in">array</span> + <span class="number">4160</span>, flag = <span class="built_in">array</span> + <span class="number">262144</span>; <span class="built_in">array</span> != flag; end += <span class="number">4096</span>, <span class="built_in">array</span> += <span class="number">4096</span>)<span class="comment">// 0x8200(%rdi)-&gt;%rsi, 0x200000(%rdi)-&gt;r8</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span>* mid = <span class="built_in">array</span> + <span class="number">64</span>; mid != end; mid += <span class="number">64</span>) <span class="comment">// 0x200(%rdi)-&gt;%rcx</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span>* begin = mid - <span class="number">64</span>; begin != mid; begin++) <span class="comment">// -0x200(%rcx)-&gt;%rax</span></span><br><span class="line">        sum += *begin;</span><br><span class="line">  <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="sum"><a href="#sum" class="headerlink" title="sum"></a><code>sum</code></h3><p>综合三个<code>sum</code>函数可以看出，它们的共同功能是利用三层循环对一个大小为266240的<code>int</code>型数组分块求和（不要认为数组大小是266304）：</p>
<ul>
<li><p><code>sum_0</code>把数组用<code>mid</code>分成0～63、64～262207和262208～266240三块，最内层循环将<code>mid</code>左侧64个元素按1步长求和；中层循环使<code>mid</code>按4096步长移动；外层循环使<code>end</code>按64步长移动(266304-262208)/(32768/512)=64次。</p>
<p>对于<code>mid</code>的每次移动，<code>begin</code>都会将其左侧64个元素求和，且<strong>已求和区间间隔为4096</strong>。</p>
<p>对于<code>end</code>的每次移动，<code>mid</code>也随之向后偏移64个元素，且此64个元素由<code>begin</code>全部求和。<code>end</code>移动64次后，偏移了64x64=4096个元素，到达262208+4096=266304处；<code>mid</code>也一共偏移了64x64=4096个元素，恰好将第一次的间隔补满。且最后<code>mid</code>与<code>end</code>相差64，正好到达数组末尾处（266304-64=266240）。</p>
</li>
<li><p><code>sum_1</code>把数组用<code>mid</code>分成0～262143和262144～266240两块，最内层循环将<code>mid</code>左侧262144个元素按4096步长求和；中层循环使<code>mid</code>按64步长移动；外层循环使<code>end</code>从266240按1步长移动64/1=64次。（<strong>注意<code>%rdi</code>表示的类型变为整数，不再是地址！<em>感谢 @SH4NG 的指正！</em></strong>）</p>
<p>对于<code>mid</code>的每次移动，<code>begin</code>都会将其左侧262144个元素隔4096求和，而<code>mid</code>也向右按64步长移动4096/64=64次，即<strong>已求和区间间隔为4096/64=64</strong>。</p>
<p>对于<code>end</code>的每次移动，<code>mid</code>也随之向后偏移1个元素，<code>end</code>移动64次后，偏移了64x1=64个元素，到达266240+64=266304处；<code>mid</code>也一共偏移了64x1=64个元素，恰好将第一次的间隔补满。且最后<code>mid</code>与<code>end</code>相差64，正好到达数组末尾处（266304-64=266240）。</p>
</li>
<li><p><code>sum_2</code>把数组用<code>mid</code>分成0～63、64～4159和4160～266240三块，最内层循环将<code>mid</code>左侧64个元素按1步长求和；中层循环使<code>mid</code>按64步长移动；外层循环使<code>end</code>从4160按4096步长移动262144/4096=64次。</p>
<p>对于<code>mid</code>的每次移动，<code>begin</code>都会将其左侧64个元素求和，而<code>mid</code>步长同样为64。注意<code>array</code>并未清零，而是以步长为4096提供给<code>mid</code>追赶<code>end</code>，即每次<code>end</code>移动时，<code>mid</code>都会领先<code>array</code>4096。由于<code>mid</code>步长为64，则中层循环将<code>end-64</code>左侧4096个元素按1步长求和。</p>
<p>对于<code>end</code>每次移动4096个元素，<code>mid</code>都会滞后64个元素（开始时<code>array</code>滞后4160-4096=64）将左侧4096个元素全部求和。<code>array</code>移动到262144时，此时<code>mid</code>恰好移动到数组末尾（262144+4096=266240）。</p>
</li>
</ul>
<p>综合三种分块方式和步长索引，可以发现：</p>
<ul>
<li><p>三个函数均为三层循环，时间局部性相差较小；</p>
</li>
<li><p><code>sum_0</code>中<code>begin</code>的步长较小但<code>mid</code>步长较大，导致<code>begin</code>在数组中不断跳跃4096个元素访问，空间局部性较差；</p>
</li>
<li><p><code>sum_1</code>中<code>begin</code>的步长较大，导致比<code>sum_0</code>更频繁地跳跃式访问，空间局部性最差；</p>
</li>
<li><p><code>sum_2</code>中<code>begin</code>和<code>mid</code>的步长均较小，且<code>begin</code>的范围等于<code>mid</code>的步长，从而可以实现<code>begin</code>的连续寻址访问，空间局部性最好。</p>
</li>
</ul>
<hr>
<p>综合以上分析，<code>sum_2</code>具有最好的局部性特性，因此<code>phase_3</code>的密码就是：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">32</span><br></pre></td></tr></table></figure>
<h1 id="任务四——虚拟内存分析"><a href="#任务四——虚拟内存分析" class="headerlink" title="任务四——虚拟内存分析"></a>任务四——虚拟内存分析</h1><blockquote>
<p>使用<code>objdump</code>和<code>readelf</code>等工具分析该elf文件中<code>.text</code>，<code>.data</code>，<code>.bss</code>和<code>.rodata</code>这四个section，并计算：</p>
<ul>
<li>各section实际使用内存空间大小</li>
<li>各section在内存中的起始地址（虚拟地址）</li>
<li>各section需要的虚拟页数量（pagesize=4KB）</li>
</ul>
</blockquote>
<hr>
<p>什么是ELF文件？</p>
<blockquote>
<p>ELF（Executable and Linkable Format）文件，是一种用于二进制文件、可执行文件、目标代码、共享库和核心转储格式文件。</p>
<p>ELF文件由4部分组成，分别是：</p>
<ul>
<li>ELF头（ELF header）</li>
<li>程序头表（Program header table）</li>
<li>节（Section）</li>
<li>节头表（Section header table）</li>
</ul>
</blockquote>
<p>这四个section是什么？</p>
<blockquote>
<ul>
<li><p><code>.text</code>：已编译程序的机器代码。</p>
</li>
<li><p><code>.data</code>：已初始化的全局和静态C变量。</p>
<p>局部C变量在运行时被保存在栈中，既不出现在<code>.data</code>节中，也不出现在<code>.bss</code>节中。</p>
</li>
<li><p><code>.bss</code>：未初始化的全局和静态C变量，以及所有被初始化为0的全局或静态变量。</p>
<p>在目标文件中这个节不占据实际的空间，它仅仅是一个占位符。</p>
<p>目标文件格式区分已初始化和未初始化变量是为了空间效率：在目标文件中，未初始化变量不需要占据任何实际的磁盘空间。运行时，在内存中分配这些变量，初始值为0。</p>
</li>
<li><p><code>.rodata</code>：只读数据。</p>
<p>比如<code>printf</code>语句中的格式串和开关语句的跳转表。</p>
</li>
</ul>
</blockquote>
<p>什么是虚拟内存？</p>
<blockquote>
<p><strong>虚拟内存（VM）</strong>是一种对主存的抽象，可以更加有效地管理内存并且减少出错。</p>
<p>虚拟内存是硬件异常、硬件地址翻译、主存、磁盘文件和内核软件的完美交互，它为每个进程提供了一个大的、一致的和私有的地址空间。</p>
</blockquote>
<p>虚拟内存有什么作用？</p>
<blockquote>
<p>虚拟内存通过一个很清晰的机制，提供了三个重要的能力：</p>
<ul>
<li>它将主存看成是一个存储在磁盘上的地址空间的高速缓存，在主存中只保存活动区域，并根据需要在磁盘和主存之间来回传送数据，通过这种方式，它高效地使用了主存；</li>
<li>它为每个进程提供了一致的地址空间，从而简化了内存管理；</li>
<li>它保护了每个进程的地址空间不被其他进程破坏。</li>
</ul>
</blockquote>
<p>什么是虚拟地址？</p>
<blockquote>
<p>虚拟内存被组织为一个由存放在磁盘上的N个连续的字节大小的单元组成的数组，每字节都有一个唯一的虚拟地址，作为到数组的索引。</p>
<p>虚拟地址（Virtual Address，VA）是CPU访问主存的重要途径，这个虚拟地址在被送到内存之前先转换成适当的物理地址。</p>
</blockquote>
<p>什么是虚拟页？</p>
<blockquote>
<p><strong>虚拟页（Virtual Page，VP）</strong>就是VM系统将虚拟内存分割成的大小固定的块，作为磁盘（较低层）和主存（较高层）之间的传输单元。</p>
</blockquote>
<hr>
<p><a target="_blank" rel="noopener" href="https://man.linuxde.net/objdump"><code>objdump</code>还有什么用法？</a></p>
<p><a target="_blank" rel="noopener" href="https://man.linuxde.net/readelf">什么是<code>readelf</code>命令？</a></p>
<hr>
<p>利用<code>readelf</code>查看各section的信息：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">readelf -S -W exam</span><br></pre></td></tr></table></figure>
<p>在输出中找到四个section：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">There are 29 section headers, starting at offset 0x3eb0:</span><br><span class="line"></span><br><span class="line">节头：</span><br><span class="line">  [Nr] Name              Type            Address          Off    Size   ES Flg Lk Inf Al</span><br><span class="line">...</span><br><span class="line">  [13] .text             PROGBITS        0000000000401140 001140 000b35 00  AX  0   0 16</span><br><span class="line">...</span><br><span class="line">  [15] .rodata           PROGBITS        0000000000402000 002000 0002f7 00   A  0   0  8</span><br><span class="line">...</span><br><span class="line">  [23] .data             PROGBITS        00000000004040a0 0030a0 000010 00  WA  0   0  8</span><br><span class="line">  [24] .bss              NOBITS          00000000004040c0 0030b0 200050 00  WA  0   0 32</span><br><span class="line">...</span><br><span class="line">Key to Flags:</span><br><span class="line">  W (write), A (alloc), X (execute), M (merge), S (strings), I (info),</span><br><span class="line">  L (link order), O (extra OS processing required), G (group), T (TLS),</span><br><span class="line">  C (compressed), x (unknown), o (OS specific), E (exclude),</span><br><span class="line">  l (large), p (processor specific)</span><br></pre></td></tr></table></figure>
<p>可以发现：</p>
<table>
<thead>
<tr>
<th>section</th>
<th>大小</th>
<th>起始地址</th>
</tr>
</thead>
<tbody><tr>
<td><code>.text</code></td>
<td>0x000b35</td>
<td>0x401140</td>
</tr>
<tr>
<td><code>.data</code></td>
<td>0x000010</td>
<td>0x4040a0</td>
</tr>
<tr>
<td><code>.bss</code></td>
<td>0x200050</td>
<td>0x4040c0</td>
</tr>
<tr>
<td><code>.rodata</code></td>
<td>0x0002f7</td>
<td>0x402000</td>
</tr>
</tbody></table>
<p>根据“虚拟页是对虚拟内存的划分”，且虚拟页大小为4KB=0x1000字节，结合各section的大小和起始地址可以得出：</p>
<ul>
<li><p><code>.text</code>在0x401000～0x402000之间，故需要的虚拟页数量为1；</p>
</li>
<li><p><code>.data</code>：在0x404000～0x405000之间，故需要的虚拟页数量为1；</p>
</li>
<li><p><code>.bss</code>：在0x404000～0x605000之间，故需要的虚拟页数量为513<em>（此处用十六进制计算，感谢 @祖国的花朵 的指正）</em>；</p>
</li>
<li><p><code>.rodata</code>：在0x402000～0x403000之间，故需要的虚拟页数量为1。</p>
</li>
</ul>
<h1 id="结束语"><a href="#结束语" class="headerlink" title="结束语"></a>结束语</h1><p>将每个任务的密码的十六进制形式存放到<code>data.txt</code>中，利用<code>hex2raw</code>并运行：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./hex2raw &lt; data.txt | ./exam</span><br></pre></td></tr></table></figure>
<p>得到输出如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Input sth. please.</span><br><span class="line"></span><br><span class="line">Ohh! You have found the entrance.</span><br><span class="line"></span><br><span class="line">Skip phase 0? (y/n)n</span><br><span class="line">You have entered PHASE 0</span><br><span class="line">Input phase 0 password:But we loved with a love that was more than love</span><br><span class="line">Good! You have passed PHASE 0!</span><br><span class="line"></span><br><span class="line">Skip phase 1? (y/n)n</span><br><span class="line">You have entered PHASE 1</span><br><span class="line">Input phase 1 password:9Q*a</span><br><span class="line">Great! You have passed PHASE 1!!</span><br><span class="line"></span><br><span class="line">Skip phase 2? (y/n)n</span><br><span class="line">You have entered PHASE 2</span><br><span class="line">Input phase 2 password:Mp)zixD-%H</span><br><span class="line">Awesome! You have passed PHASE 2!!!</span><br><span class="line"></span><br><span class="line">Skip phase 3? (y/n)n</span><br><span class="line">You have entered PHASE 3</span><br><span class="line">choose a function whith the best locality to run:2</span><br><span class="line"></span><br><span class="line">[[You have pass all the levels! (*@o@*)]]</span><br></pre></td></tr></table></figure>
<p>此处存在语法错误，若改为<code>passed</code>就完美了。</p>
<p>实验结束。</p>
<hr>
<p><strong>安娜贝尔·丽</strong></p>
<p><strong>第一节</strong></p>
<p>It was many and many a year ago,</p>
<p>In a kingdom by the sea,</p>
<p>That a maiden there lived whom you may know</p>
<p>By the name of ANNABEL LEE;</p>
<p>And this maiden she lived with no other thought</p>
<p>Than to love and be loved by me.</p>
<p><strong>第二节</strong></p>
<p>I was a child and she was a child,</p>
<p>In this kingdom by the sea;</p>
<p>But we loved with a love that was more than love —</p>
<p>I and my Annabel Lee;</p>
<p>With a love that the winged seraphs of heaven</p>
<p>Coveted her and me.</p>
<p><strong>第三节</strong></p>
<p>And this was the reason that, long ago,</p>
<p>In this kingdom by the sea,</p>
<p>A wind blew out of a cloud, chilling</p>
<p>My beautiful Annabel Lee;</p>
<p>So that her highborn kinsman came</p>
<p>And bore her away from me,</p>
<p>To shut her up in a sepulchre</p>
<p>In this kingdom by the sea.</p>
<p><strong>第四节</strong></p>
<p>The angels, not half so happy in heaven,</p>
<p>Went envying her and me —</p>
<p>Yes! — that was the reason (as all men know,</p>
<p>In this kingdom by the sea)</p>
<p>That the wind came out of the cloud by night,</p>
<p>Chilling and killing my Annabel Lee.</p>
<p><strong>第五节</strong></p>
<p>But our love it was stronger by far than the love</p>
<p>Of those who were older than we —</p>
<p>Of many far wiser than we —</p>
<p>And neither the angels in heaven above,</p>
<p>Nor the demons down under the sea,</p>
<p>Can ever dissever my soul from the soul</p>
<p>Of the beautiful Annabel Lee.</p>
<p><strong>第六节</strong></p>
<p>For the moon never beams without bringing me dreams</p>
<p>Of the beautiful Annabel Lee;</p>
<p>And the stars never rise but I feel the bright eyes</p>
<p>Of the beautiful Annabel Lee;</p>
<p>And so, all the night tide, I lie down by the side</p>
<p>Of my darling — my darling — my life and my bride,</p>
<p>In her sepulchre there by the sea,</p>
<p>In her tomb by the sounding sea.</p>
<p>译文：</p>
<p><strong>第一节</strong></p>
<p>很久很久以前，</p>
<p>在一个滨海的国度里，</p>
<p>住着一位少女你或许认得，</p>
<p>她的芳名叫安娜贝尔·李；</p>
<p>这少女活着没有别的愿望，</p>
<p>只为和我两情相许。</p>
<p><strong>第二节</strong></p>
<p>那会儿我还是个孩子，她也未脱稚气，</p>
<p>在这个滨海的国度里；</p>
<p>可我们的爱超越一切，无人能及——</p>
<p>我和我的安娜贝尔·李；</p>
<p>我们爱得那样深，连天上的六翼天使</p>
<p>也把我和她妒嫉——</p>
<p><strong>第三节</strong></p>
<p>这就是那不幸的根源，很久以前</p>
<p>在这个滨海的国度里．</p>
<p>夜里一阵寒风从白云端吹起，冻僵了</p>
<p>我的安娜贝尔·李；</p>
<p>于是她那些高贵的亲戚来到凡间</p>
<p>把她从我的身边夺去，</p>
<p>将她关进一座坟墓</p>
<p>在这个滨海的国度里。</p>
<p><strong>第四节</strong></p>
<p>这些天使们在天上，不及我们一半快活，</p>
<p>于是他们把我和她妒嫉——</p>
<p>对——就是这个缘故（谁不晓得呢，在这个滨海的国度里）</p>
<p>云端刮起了寒风，</p>
<p>冻僵并带走了，我的安娜贝尔·李。</p>
<p><strong>第五节</strong></p>
<p>可我们的爱情远远地胜过</p>
<p>那些年纪长于我们的人——</p>
<p>那些智慧胜于我们的人——</p>
<p>无论是天上的天使，</p>
<p>还是海底的恶魔，</p>
<p>都不能将我们的灵魂分离，</p>
<p>我和我美丽的安娜贝尔·李。</p>
<p><strong>第六节</strong></p>
<p>因为月亮的每一丝清辉都勾起我的回忆</p>
<p>梦里那美丽的安娜贝尔·李</p>
<p>群星的每一次升起都令我觉得秋波在闪动</p>
<p>那是我美丽的安娜贝尔·李</p>
<p>就这样，伴着潮水，我整夜躺在她身旁，</p>
<p>我亲爱的——我亲爱的——我的生命，我的新娘，</p>
<p>在海边那座坟茔里，</p>
<p>在大海边她的墓穴里。</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>Thanks for your reading.</div>
  <button onclick="document.querySelector('.post-reward').classList.toggle('active');">
    Donate
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpay.png" alt="SUPER WeChat Pay">
        <span>WeChat Pay</span>
      </div>
      <div>
        <img src="/images/alipay.png" alt="SUPER Alipay">
        <span>Alipay</span>
      </div>

  </div>
</div>

          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>Post author:  </strong>SUPER
  </li>
  <li class="post-copyright-link">
      <strong>Post link: </strong>
      <a href="https://www.superpung.xyz/Final-Homework/" title="Final Homework: 黎明前的黑暗">https://www.superpung.xyz/Final-Homework/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.
  </li>
</ul>
</div>

          <div class="followme">
  <span>Welcome to my other publishing channels</span>

  <div class="social-list">

      <div class="social-item">
        <a target="_blank" class="social-link" href="https://twitter.com/super_pung">
          <span class="icon">
            <i class="fab fa-twitter"></i>
          </span>

          <span class="label">Twitter</span>
        </a>
      </div>

      <div class="social-item">
        <a target="_blank" class="social-link" href="https://t.me/super_lee">
          <span class="icon">
            <i class="fab fa-telegram"></i>
          </span>

          <span class="label">Telegram</span>
        </a>
      </div>

      <div class="social-item">
        <a target="_blank" class="social-link" href="/images/wechat_channel.png">
          <span class="icon">
            <i class="fab fa-weixin"></i>
          </span>

          <span class="label">WeChat</span>
        </a>
      </div>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/Computer-Systems/" rel="tag"><i class="fa fa-tag"></i> Computer Systems</a>
              <a href="/tags/Experiments/" rel="tag"><i class="fa fa-tag"></i> Experiments</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/Data-Structures-Experiment-16/" rel="prev" title="Data Structures Experiment #16">
                  <i class="fa fa-chevron-left"></i> Data Structures Experiment #16
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/Data-Structures-Experiment-17/" rel="next" title="Data Structures Experiment #17">
                  Data Structures Experiment #17 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; Jan 14, 2020 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heartbeat"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">SUPER</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="Symbols count total">424k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">6:25</span>
  </span>
</div>

<span id="jinrishici-sentence">正在加载今日诗词....</span>
<script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  






  




  


<script>
NexT.utils.loadComments('#valine-comments', () => {
  NexT.utils.getScript('https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js', () => {
    new Valine(Object.assign({"enable":true,"appId":"dTCUKVKvTVtMNlJS8ouhSrSy-gzGzoHsz","appKey":"Xu5gOcha47h22aiE985nuBSN","serverURLs":null,"placeholder":"Please leave a message here","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"lang":null,"visitor":false,"comment_count":true,"recordIP":false,"enableQQ":false,"requiredFields":[]}, {
      el: '#valine-comments',
      path: "/Final-Homework/",
      serverURLs: "https://dtcukvkv.api.lncldglobal.com"
    }));
  }, window.Valine);
});
</script>

</body>
</html>

<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/clicklove.js"></script>
