<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Monta:300,300italic,400,400italic,700,700italic%7CLobster+two:300,300italic,400,400italic,700,700italic%7CRoboto+Slab:300,300italic,400,400italic,700,700italic%7CPT+Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.2/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.superpung.xyz","root":"/","images":"/images","scheme":"Mist","version":"8.2.1","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":true,"color":"#222","save":"manual"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}};
  </script>
<meta name="description" content="听说你不会拆弹？">
<meta property="og:type" content="article">
<meta property="og:title" content="Bomb Lab: Defusing a Binary Bomb">
<meta property="og:url" content="https://www.superpung.xyz/Bomb-Lab/">
<meta property="og:site_name" content="ExiTalk">
<meta property="og:description" content="听说你不会拆弹？">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://super-bucket1.oss-cn-beijing.aliyuncs.com/ExiTalk.png">
<meta property="og:image" content="https://super-bucket1.oss-cn-beijing.aliyuncs.com/ASCII.png">
<meta property="og:image" content="https://super-bucket1.oss-cn-beijing.aliyuncs.com/hex.jpeg">
<meta property="og:image" content="https://super-bucket1.oss-cn-beijing.aliyuncs.com/dec.jpeg">
<meta property="og:image" content="https://super-bucket1.oss-cn-beijing.aliyuncs.com/dec.jpeg">
<meta property="og:image" content="https://super-bucket1.oss-cn-beijing.aliyuncs.com/1988.jpeg">
<meta property="article:published_time" content="2020-05-03T11:47:32.000Z">
<meta property="article:modified_time" content="2021-02-11T03:44:46.118Z">
<meta property="article:author" content="SUPER">
<meta property="article:tag" content="Computer Systems">
<meta property="article:tag" content="Lab Assignments">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://super-bucket1.oss-cn-beijing.aliyuncs.com/ExiTalk.png">


<link rel="canonical" href="https://www.superpung.xyz/Bomb-Lab/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script><script src="https://cdn.jsdelivr.net/gh/SuperPung/super_live2d@latest/autoload.js"></script>

<title>Bomb Lab: Defusing a Binary Bomb | ExiTalk</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-168209848-1"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-168209848-1');
      }
    </script>

  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?f2bcd2857d66dc90e115d790b974341f";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">ExiTalk</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Follow your heart</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
        <li class="menu-item menu-item-love"><a href="/love/" rel="section"><i class="fa fa-heart fa-fw"></i>love</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%87%86%E5%A4%87"><span class="nav-text">准备</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8B%86%E5%BC%B9%E5%BC%80%E5%A7%8B"><span class="nav-text">拆弹开始</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#main"><span class="nav-text">main</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Phase-1-string"><span class="nav-text">Phase 1: string</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Phase2-loop"><span class="nav-text">Phase2: loop</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Phase-3-switch"><span class="nav-text">Phase 3: switch</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Phase-4-recursion"><span class="nav-text">Phase 4: recursion</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Phase-5-pointer"><span class="nav-text">Phase 5: pointer</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Phase-6-link-list"><span class="nav-text">Phase 6: link list</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Secret-phase-binary-search-tree"><span class="nav-text">Secret phase: binary search tree</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Enter"><span class="nav-text">Enter</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Defuse"><span class="nav-text">Defuse</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Functions"><span class="nav-text">Functions</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#explode-bomb"><span class="nav-text">explode_bomb</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#strings-not-equal"><span class="nav-text">strings_not_equal</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#string-length"><span class="nav-text">string_length</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#read-six-numbers"><span class="nav-text">read_six_numbers</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#func4"><span class="nav-text">func4</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#fun7"><span class="nav-text">fun7</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8B%86%E5%BC%B9%E7%BB%93%E6%9D%9F"><span class="nav-text">拆弹结束</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="SUPER"
      src="/images/avatar.jpeg">
  <p class="site-author-name" itemprop="name">SUPER</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">38</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/SuperPung" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;SuperPung" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:superpung.lee@gmail.com" title="E-Mail → mailto:superpung.lee@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://t.me/super_lee" title="Telegram → https:&#x2F;&#x2F;t.me&#x2F;super_lee" rel="noopener" target="_blank"><i class="telegram fa-fw"></i>Telegram</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/super_pung" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;super_pung" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.facebook.com/syeopung.lee.3" title="FB Page → https:&#x2F;&#x2F;www.facebook.com&#x2F;syeopung.lee.3" rel="noopener" target="_blank"><i class="fab fa-facebook fa-fw"></i>FB Page</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://instagram.com/superpung.lee" title="Instagram → https:&#x2F;&#x2F;instagram.com&#x2F;superpung.lee" rel="noopener" target="_blank"><i class="fab fa-instagram fa-fw"></i>Instagram</a>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://tingtalk.me/" title="https:&#x2F;&#x2F;tingtalk.me&#x2F;" rel="noopener" target="_blank">TingTalk</a>
        </li>
    </ul>
  </div>

        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.superpung.xyz/Bomb-Lab/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="SUPER">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ExiTalk">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Bomb Lab: Defusing a Binary Bomb
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
  
    <span class="post-top-icon">
      <i class="fas fa-thumbtack"></i>
    </span>
    <font color=FF0000>&nbsp;TOP</font>
  
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-05-03 19:47:32" itemprop="dateCreated datePublished" datetime="2020-05-03T19:47:32+08:00">2020-05-03</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-02-11 11:44:46" itemprop="dateModified" datetime="2021-02-11T11:44:46+08:00">2021-02-11</time>
      </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine: </span>
  
    <a title="valine" href="/Bomb-Lab/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/Bomb-Lab/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="Symbols count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Symbols count in article: </span>
      <span>56k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>51 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>听说你不会拆弹？</p>
<a id="more"></a>

<p><img src="https://super-bucket1.oss-cn-beijing.aliyuncs.com/ExiTalk.png"></p>
<p><em>我经过漫长的分析和调试最终完成了本实验，完成后撰写本文用时约两天，<strong>若参考或转载请注明出处</strong>。</em></p>
<blockquote>
<p>Dr. Evil’s Insidious Bomb, Version 1.1<br>Copyright 2011, Dr. Evil Incorporated. All rights reserved.</p>
<p>LICENSE:</p>
<p>Dr. Evil Incorporated (the PERPETRATOR) hereby grants you (the VICTIM) explicit permission to use this bomb (the BOMB).  This is a time limited license, which expires on the death of the VICTIM. The PERPETRATOR takes no responsibility for damage, frustration, insanity, bug-eyes, carpal-tunnel syndrome, loss of sleep, or other harm to the VICTIM.  Unless the PERPETRATOR wants to take credit, that is.  The VICTIM may not distribute this bomb source code to any enemies of the PERPETRATOR.  No VICTIM may debug, reverse-engineer, run “strings” on, decompile, decrypt, or use any other technique to gain knowledge of and defuse the BOMB.  BOMB proof clothing may not be worn when handling this program.  The PERPETRATOR will not apologize for the PERPETRATOR’s poor sense of humor.  This license is null and void where the BOMB is prohibited by law.</p>
</blockquote>
<p>大意为</p>
<blockquote>
<p>Dr.Evil的阴险炸弹，版本1.1<br>版权声明：2011，Dr.Evil公司版权所有。</p>
<p>许可声明：</p>
<p>Dr.Evil公司（犯罪者）特此授予您（受害者）使用该炸弹（BOMB）的明确许可。这是一个有时间限制的许可证，在受害者死亡时到期。破坏者对损坏，沮丧，精神错乱，虫眼，腕管综合症，睡眠不足或对受害者造成的其他伤害概不负责，除非犯罪者想要获得荣誉。受害者不得将此炸弹源代码分发给犯罪者的任何敌人。受害者不得调试，逆向工程，在其上运行“字符串”，反编译，解密或使用任何其他技术来了解和拆除BOMB。处理此程序时，可能不能穿防弹衣。犯罪者不会因犯罪者的幽默感而道歉。在法律禁止BOMB的情况下，此许可无效。</p>
</blockquote>
<p>本实验考察了对汇编语言的分析，对程序控制、过程调用的汇编级实现的理解。故做本实验之前，应先掌握CS:APP第三章《程序的机器级表示》部分。即使你未掌握汇编语言相关的知识，阅读本文后你也会有很大收获。</p>
<p>本文所有操作均基于以下环境：</p>
<ul>
<li>OS: Ubuntu 18.04.4 LTS (Linux ubuntu 5.3.0-46-generic x86_64)</li>
<li>Debugger: GNU gdb (Ubuntu 8.1-0ubuntu3.2) 8.1.0.20180409-git</li>
</ul>
<p><em>有关实验的基本介绍参见实验说明。</em></p>
<h1 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h1><p>阅读<code>bomb.c</code>，可以发现：</p>
<ul>
<li><p><code>bomb</code>支持两种输入方式。</p>
<p>为避免重复输入，建议将分析出的password预先存入文本文件<code>passwd.txt</code>中。</p>
</li>
<li><p><code>bomb</code>总共设置了6个<code>phase</code>，每个<code>phase</code>包括：</p>
<ul>
<li><code>read_line()</code>：读取一行作为输入的password；</li>
<li><code>phase_X()</code>：第<code>X</code>个<code>phase</code>调用对应此函数以检验password是否正确；</li>
<li><code>phase_defused()</code>：每个<code>phase</code>在检验密码正确后都会运行此函数。</li>
</ul>
<p>只有password全部正确，拆弹才成功，否则将爆炸：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BOOM!!!</span><br><span class="line">The bomb has blown up.</span><br></pre></td></tr></table></figure>
<p>拆弹的过程，就是通过分析<code>objdump</code>反汇编生成的代码，并利用<code>gdb</code>调试得到每一个<code>phase</code>的password，完成总共6个<code>phase</code>即拆弹成功。</p>
</li>
</ul>
<p>下面是关于<code>objdump</code>和<code>gdb</code>的具体用法：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://man.linuxde.net/objdump"><code>objdump</code>命令</a></li>
<li><a target="_blank" rel="noopener" href="https://man.linuxde.net/gdb"><code>gdb</code>命令</a></li>
</ul>
<blockquote>
<p><code>gdb</code>中使用<code>x</code>命令来打印内存的值，格式为“<code>x/&lt;nfu&gt; &lt;addr&gt;</code>”。含义为以<code>&lt;f&gt;</code>格式打印从<code>&lt;addr&gt;</code>开始的<code>&lt;n&gt;</code>个长度单元为<code>&lt;u&gt;</code>的内存值。参数具体含义如下：</p>
<ul>
<li><p><code>&lt;n&gt;</code>：输出单元的个数。</p>
</li>
<li><p><code>&lt;f&gt;</code>：输出格式。</p>
<p><code>s</code> 输出字符串；</p>
<p><code>x</code> 按十六进制格式显示变量；</p>
<p><code>d</code> 按十进制格式显示变量；</p>
<p><code>u</code> 按十六进制格式显示无符号整型；</p>
<p><code>o</code> 按八进制格式显示变量；</p>
<p><code>t</code> 按二进制格式显示变量；</p>
<p><code>a</code> 按十六进制格式显示变量；</p>
<p><code>c</code> 按字符格式显示变量；</p>
<p><code>f</code> 按浮点数格式显示变量。</p>
</li>
<li><p><code>&lt;u&gt;</code>：标明一个单元的长度。</p>
<p><code>b</code>是1个<code>byte</code>；</p>
<p><code>h</code>是2个<code>byte</code>（halfword）；</p>
<p><code>w</code>是4个<code>byte</code>（word）；</p>
<p><code>g</code>是8个<code>byte</code>（giant word）。</p>
</li>
</ul>
</blockquote>
<h1 id="拆弹开始"><a href="#拆弹开始" class="headerlink" title="拆弹开始"></a>拆弹开始</h1><p>首先利用<code>objdump</code>工具反汇编，并将结果重定向存入<code>bomb.s</code>（或<code>bomb.asm</code>、<code>bomb.txt</code>）文件以便分析。（注意此处操作务必在Linux环境下进行，若在Windows或macOS环境下可能会无法生成注释，并可能无法将数值显示为十六进制）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">objdump -d bomb &gt; bomb.s</span><br></pre></td></tr></table></figure>
<p>生成的汇编文件包括<strong>标号地址</strong>、<strong>标号名字</strong>、<strong>指令地址</strong>、<strong>指令机器码</strong>以及指令机器码反汇编得到的<strong>指令</strong>等部分。</p>
<p>运行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdb bomb</span><br></pre></td></tr></table></figure>
<p>拆弹开始。</p>
<h1 id="main"><a href="#main" class="headerlink" title="main"></a>main</h1><p>首先分析<code>main</code>函数，找到<code>phase_1</code>对应的汇编语句部分：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">400e32:	e8 67 06 00 00       	callq  40149e &lt;read_line&gt;</span><br><span class="line">400e37:	48 89 c7             	mov    %rax,%rdi</span><br><span class="line">400e3a:	e8 a1 00 00 00       	callq  400ee0 &lt;phase_1&gt;</span><br><span class="line">400e3f:	e8 80 07 00 00       	callq  4015c4 &lt;phase_defused&gt;</span><br><span class="line">400e44:	bf a8 23 40 00       	mov    $0x4023a8,%edi</span><br><span class="line">400e49:	e8 c2 fc ff ff       	callq  400b10 &lt;puts@plt&gt;</span><br></pre></td></tr></table></figure>
<p>结合<code>bomb.c</code>可知，程序首先调用<code>read_line</code>函数读取一行字符串（400e32），并将其返回值<code>input</code>从<code>%rax</code>寄存器传入<code>%rdi</code>寄存器（400e37）。（由于<code>read_line</code>函数的作用易知，故本文不再对其进行详细分析）</p>
<p>分析剩余<code>main</code>函数可知，其调用每个<code>phase</code>函数时，<code>input</code>字符串地址都存储于<code>%rdi</code>寄存器中，即**<code>%rdi</code>指向<code>input</code>字符串**。</p>
<p>后续直接分析各<code>phase</code>函数即可。</p>
<h1 id="Phase-1-string"><a href="#Phase-1-string" class="headerlink" title="Phase 1: string"></a>Phase 1: <em>string</em></h1><p><code>phase_1</code>对应的汇编语句如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">0000000000400ee0 &lt;phase_1&gt;:</span><br><span class="line">  400ee0:	48 83 ec 08          	sub    $0x8,%rsp</span><br><span class="line">  400ee4:	be 00 24 40 00       	mov    $0x402400,%esi</span><br><span class="line">  400ee9:	e8 4a 04 00 00       	callq  401338 &lt;strings_not_equal&gt;</span><br><span class="line">  400eee:	85 c0                	test   %eax,%eax</span><br><span class="line">  400ef0:	74 05                	je     400ef7 &lt;phase_1+0x17&gt;</span><br><span class="line">  400ef2:	e8 43 05 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  400ef7:	48 83 c4 08          	add    $0x8,%rsp</span><br><span class="line">  400efb:	c3                   	retq</span><br></pre></td></tr></table></figure>
<hr>
<p>分段分析：</p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">400ee0:	48 83 ec 08          	sub    $0x8,%rsp</span><br></pre></td></tr></table></figure>
<p>400ee0在<code>%rsp</code>中分配8字节空间压栈</p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">400ee4:	be 00 24 40 00       	mov    $0x402400,%esi</span><br></pre></td></tr></table></figure>
<p>400ee4将地址<code>0x402400</code>传入<code>%esi</code>寄存器，直接<code>gdb</code>打断点查看此处内容：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) b explode_bomb</span><br><span class="line">(gdb) x/s 0x402400</span><br></pre></td></tr></table></figure>
<p>得到输出如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Breakpoint 1 at 0x40143a</span><br><span class="line">0x402400:       &quot;Border relations with Canada have never been better.&quot;</span><br></pre></td></tr></table></figure>
<p>可以看到地址<code>0x402400</code>指向的是字符串<code>Border relations with Canada have never been better.</code>，推测<code>phase_1</code>的密码就是此字符串（后续称之为“密码串”，对应<code>input</code>字符串为“输入串”）。</p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">400ee9:	e8 4a 04 00 00       	callq  401338 &lt;strings_not_equal&gt;</span><br></pre></td></tr></table></figure>
<p>400ee9<span id = "p1">调用<code>strings_not_equal</code>函数</span>（<strong>推测</strong>可能是判断两字符串是否相等，<a href="#equal">点此分析<code>strings_not_equal</code>函数</a>）</p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">400eee:	85 c0                	test   %eax,%eax</span><br><span class="line">400ef0:	74 05                	je     400ef7 &lt;phase_1+0x17&gt;</span><br><span class="line">400ef2:	e8 43 05 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">400ef7:	48 83 c4 08          	add    $0x8,%rsp</span><br><span class="line">400efb:	c3                   	retq</span><br></pre></td></tr></table></figure>
<p>400eee和400ef0判断<code>%eax</code>（<code>strings_not_equal</code>函数的返回值）是否为0：</p>
<ul>
<li>若为0（输入串和密码串相等）则跳到400ef7（400ee0+0x17），弹出栈并<strong>返回</strong>；</li>
<li>若不为0（输入串和密码串不等）则运行400ef2执行<code>explode_bomb</code>函数使炸弹爆炸</li>
</ul>
<hr>
<p>至此，得知密码串就是password。即<code>phase_1</code>的password为</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Border relations with Canada have never been better.</span><br></pre></td></tr></table></figure>
<h1 id="Phase2-loop"><a href="#Phase2-loop" class="headerlink" title="Phase2: loop"></a>Phase2: <em>loop</em></h1><p><code>phase_2</code>对应的汇编语句如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">0000000000400efc &lt;phase_2&gt;:</span><br><span class="line">  400efc:	55                   	push   %rbp</span><br><span class="line">  400efd:	53                   	push   %rbx</span><br><span class="line">  400efe:	48 83 ec 28          	sub    $0x28,%rsp</span><br><span class="line">  400f02:	48 89 e6             	mov    %rsp,%rsi</span><br><span class="line">  400f05:	e8 52 05 00 00       	callq  40145c &lt;read_six_numbers&gt;</span><br><span class="line">  400f0a:	83 3c 24 01          	cmpl   $0x1,(%rsp)</span><br><span class="line">  400f0e:	74 20                	je     400f30 &lt;phase_2+0x34&gt;</span><br><span class="line">  400f10:	e8 25 05 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  400f15:	eb 19                	jmp    400f30 &lt;phase_2+0x34&gt;</span><br><span class="line">  400f17:	8b 43 fc             	mov    -0x4(%rbx),%eax</span><br><span class="line">  400f1a:	01 c0                	add    %eax,%eax</span><br><span class="line">  400f1c:	39 03                	cmp    %eax,(%rbx)</span><br><span class="line">  400f1e:	74 05                	je     400f25 &lt;phase_2+0x29&gt;</span><br><span class="line">  400f20:	e8 15 05 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  400f25:	48 83 c3 04          	add    $0x4,%rbx</span><br><span class="line">  400f29:	48 39 eb             	cmp    %rbp,%rbx</span><br><span class="line">  400f2c:	75 e9                	jne    400f17 &lt;phase_2+0x1b&gt;</span><br><span class="line">  400f2e:	eb 0c                	jmp    400f3c &lt;phase_2+0x40&gt;</span><br><span class="line">  400f30:	48 8d 5c 24 04       	lea    0x4(%rsp),%rbx</span><br><span class="line">  400f35:	48 8d 6c 24 18       	lea    0x18(%rsp),%rbp</span><br><span class="line">  400f3a:	eb db                	jmp    400f17 &lt;phase_2+0x1b&gt;</span><br><span class="line">  400f3c:	48 83 c4 28          	add    $0x28,%rsp</span><br><span class="line">  400f40:	5b                   	pop    %rbx</span><br><span class="line">  400f41:	5d                   	pop    %rbp</span><br><span class="line">  400f42:	c3                   	retq</span><br></pre></td></tr></table></figure>
<hr>
<p>分段分析：</p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">400efc:	55                   	push   %rbp</span><br><span class="line">400efd:	53                   	push   %rbx</span><br><span class="line">400efe:	48 83 ec 28          	sub    $0x28,%rsp</span><br><span class="line">400f02:	48 89 e6             	mov    %rsp,%rsi</span><br></pre></td></tr></table></figure>
<p>400efe在<code>%rsp</code>中分配40字节空间压栈，400f02将<code>%rsp</code>地址给<code>%rsi</code></p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">400f05:	e8 52 05 00 00       	callq  40145c &lt;read_six_numbers&gt;</span><br></pre></td></tr></table></figure>
<p>400f05<span id = "p2">调用<code>read_six_numbers</code>函数</span>（<strong>推测</strong>可能是读取6个数字，<a href="#6numbers">点此分析<code>read_six_numbers</code>函数</a>）。</p>
<p>分析完<code>read_six_numbers</code>函数后，可以明确：输入的6个整数依次存放于<code>0(%rsp)</code>、<code>4(%rsp)</code>、<code>8(%rsp)</code>、<code>12(%rsp)</code>、<code>16(%rsp)</code>、<code>20(%rsp)</code>中</p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">400f0a:	83 3c 24 01          	cmpl   $0x1,(%rsp)</span><br><span class="line">400f0e:	74 20                	je     400f30 &lt;phase_2+0x34&gt;</span><br><span class="line">400f10:	e8 25 05 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">400f15:	eb 19                	jmp    400f30 &lt;phase_2+0x34&gt;</span><br><span class="line">400f17:	8b 43 fc             	mov    -0x4(%rbx),%eax</span><br><span class="line">400f1a:	01 c0                	add    %eax,%eax</span><br><span class="line">400f1c:	39 03                	cmp    %eax,(%rbx)</span><br><span class="line">400f1e:	74 05                	je     400f25 &lt;phase_2+0x29&gt;</span><br><span class="line">400f20:	e8 15 05 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">400f25:	48 83 c3 04          	add    $0x4,%rbx</span><br><span class="line">400f29:	48 39 eb             	cmp    %rbp,%rbx</span><br><span class="line">400f2c:	75 e9                	jne    400f17 &lt;phase_2+0x1b&gt;</span><br><span class="line">400f2e:	eb 0c                	jmp    400f3c &lt;phase_2+0x40&gt;</span><br><span class="line">400f30:	48 8d 5c 24 04       	lea    0x4(%rsp),%rbx</span><br><span class="line">400f35:	48 8d 6c 24 18       	lea    0x18(%rsp),%rbp</span><br><span class="line">400f3a:	eb db                	jmp    400f17 &lt;phase_2+0x1b&gt;</span><br><span class="line">400f3c:	48 83 c4 28          	add    $0x28,%rsp</span><br><span class="line">400f40:	5b                   	pop    %rbx</span><br><span class="line">400f41:	5d                   	pop    %rbp</span><br><span class="line">400f42:	c3                   	retq</span><br></pre></td></tr></table></figure>
<p>400f0a和400f0e判断<code>%rsp</code>指向的值（输入的第1个整数）是否为1：</p>
<ul>
<li>若不为1则继续执行400f10使炸弹爆炸；</li>
<li>若为1则跳到400f30（400efc+0x34）把<code>%rsp+4</code>的地址（指向输入的下一个整数）给<code>%rbx</code>，400f35把<code>%rsp+24</code>的地址（指向6个整数结束的位置）给<code>%rbp</code>，再跳回400f17（400efc+0x1b）把<code>%rbx-4</code>的地址（指向当前整数的上一个整数）给<code>%eax</code>，400f1a将<code>%eax</code>的值（上一个整数）乘2，400f1c和400f1e将<code>%eax</code>（上一个整数的2倍）和<code>%rbx</code>指向的值（当前整数）对比：<ul>
<li>若不等则继续执行400f20使炸弹爆炸；</li>
<li>若相等则跳到400f25（400efc+0x29）将<code>%rbx</code>加4（使<code>%rbx</code>指向下一个整数），400f29和400f2c判断<code>%rbx</code>（当前整数位置）是否等于<code>%rbp</code>（6整数结束的位置）：<ul>
<li>若相等则说明6整数判断完毕，继续执行400f2e跳到400f3c弹出栈并返回；</li>
<li>若不等则跳到400f17循环。</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>可以看出此部分的循环等价于：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (passwd[<span class="number">0</span>] != <span class="number">1</span>)<span class="comment">// %rsp</span></span><br><span class="line">	explode_bomb();</span><br><span class="line">p_tail = passwd + <span class="number">6</span>;<span class="comment">// %rsp + 24-&gt;%rbp</span></span><br><span class="line"><span class="keyword">for</span> (p_loc = passwd + <span class="number">1</span>; p_loc != p_tail; p_loc++) &#123;<span class="comment">// %rsp + 4-&gt;%rbx; %rbx != %rbp</span></span><br><span class="line">	temp = *(p_loc - <span class="number">1</span>) * <span class="number">2</span>;<span class="comment">// %eax</span></span><br><span class="line">	<span class="keyword">if</span> (*p_loc != temp)</span><br><span class="line">		explode_bomb();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> temp;</span><br></pre></td></tr></table></figure>
<p>即判断是否满足“<strong>第一个整数为<code>1</code>，后面5个整数依次为前一个的2倍</strong>”；不满足则使炸弹爆炸</p>
<hr>
<p>至此，得到<code>phase_2</code>的password为</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 2 4 8 16 32</span><br></pre></td></tr></table></figure>
<h1 id="Phase-3-switch"><a href="#Phase-3-switch" class="headerlink" title="Phase 3: switch"></a>Phase 3: <em>switch</em></h1><p><code>phase_3</code>对应的汇编语句如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">0000000000400f43 &lt;phase_3&gt;:</span><br><span class="line">  400f43:	48 83 ec 18          	sub    $0x18,%rsp</span><br><span class="line">  400f47:	48 8d 4c 24 0c       	lea    0xc(%rsp),%rcx</span><br><span class="line">  400f4c:	48 8d 54 24 08       	lea    0x8(%rsp),%rdx</span><br><span class="line">  400f51:	be cf 25 40 00       	mov    $0x4025cf,%esi</span><br><span class="line">  400f56:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  400f5b:	e8 90 fc ff ff       	callq  400bf0 &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line">  400f60:	83 f8 01             	cmp    $0x1,%eax</span><br><span class="line">  400f63:	7f 05                	jg     400f6a &lt;phase_3+0x27&gt;</span><br><span class="line">  400f65:	e8 d0 04 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  400f6a:	83 7c 24 08 07       	cmpl   $0x7,0x8(%rsp)</span><br><span class="line">  400f6f:	77 3c                	ja     400fad &lt;phase_3+0x6a&gt;</span><br><span class="line">  400f71:	8b 44 24 08          	mov    0x8(%rsp),%eax</span><br><span class="line">  400f75:	ff 24 c5 70 24 40 00 	jmpq   *0x402470(,%rax,8)</span><br><span class="line">  400f7c:	b8 cf 00 00 00       	mov    $0xcf,%eax</span><br><span class="line">  400f81:	eb 3b                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">  400f83:	b8 c3 02 00 00       	mov    $0x2c3,%eax</span><br><span class="line">  400f88:	eb 34                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">  400f8a:	b8 00 01 00 00       	mov    $0x100,%eax</span><br><span class="line">  400f8f:	eb 2d                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">  400f91:	b8 85 01 00 00       	mov    $0x185,%eax</span><br><span class="line">  400f96:	eb 26                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">  400f98:	b8 ce 00 00 00       	mov    $0xce,%eax</span><br><span class="line">  400f9d:	eb 1f                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">  400f9f:	b8 aa 02 00 00       	mov    $0x2aa,%eax</span><br><span class="line">  400fa4:	eb 18                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">  400fa6:	b8 47 01 00 00       	mov    $0x147,%eax</span><br><span class="line">  400fab:	eb 11                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">  400fad:	e8 88 04 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  400fb2:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  400fb7:	eb 05                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">  400fb9:	b8 37 01 00 00       	mov    $0x137,%eax</span><br><span class="line">  400fbe:	3b 44 24 0c          	cmp    0xc(%rsp),%eax</span><br><span class="line">  400fc2:	74 05                	je     400fc9 &lt;phase_3+0x86&gt;</span><br><span class="line">  400fc4:	e8 71 04 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  400fc9:	48 83 c4 18          	add    $0x18,%rsp</span><br><span class="line">  400fcd:	c3                   	retq</span><br></pre></td></tr></table></figure>
<hr>
<p>分段分析：</p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">400f43:	48 83 ec 18          	sub    $0x18,%rsp</span><br><span class="line">400f47:	48 8d 4c 24 0c       	lea    0xc(%rsp),%rcx</span><br><span class="line">400f4c:	48 8d 54 24 08       	lea    0x8(%rsp),%rdx</span><br></pre></td></tr></table></figure>
<p>400f43在<code>%rsp</code>中分配24字节空间压栈，400f47把<code>%rsp+12</code>的地址给<code>%rcx</code>，400f4c把<code>%rsp+8</code>的地址给<code>%rdx</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">%rdx &#x3D; %rsp + 8</span><br><span class="line">%rcx &#x3D; %rsp + 12</span><br></pre></td></tr></table></figure>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">400f51:	be cf 25 40 00       	mov    $0x4025cf,%esi</span><br><span class="line">400f56:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">400f5b:	e8 90 fc ff ff       	callq  400bf0 &lt;__isoc99_sscanf@plt&gt;</span><br></pre></td></tr></table></figure>
<p>400f51将地址<code>0x4025cf</code>传入<code>%esi</code>寄存器，直接<code>gdb</code>查看此处内容：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/s 0x4025cf</span><br></pre></td></tr></table></figure>
<p>得到输出如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x4025cf:       &quot;%d %d&quot;</span><br></pre></td></tr></table></figure>
<p>根据<code>phase_2</code>的经验，结合后续400f5b再次调用了<code>sscanf</code>函数，可以<strong>推测</strong><code>phase_3</code>的password可能是两个整数，中间以1个空格隔开。而且输入的两个整数存储于上述的两个地址中。</p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">400f60:	83 f8 01             	cmp    $0x1,%eax</span><br><span class="line">400f63:	7f 05                	jg     400f6a &lt;phase_3+0x27&gt;</span><br><span class="line">400f65:	e8 d0 04 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">400f6a:	83 7c 24 08 07       	cmpl   $0x7,0x8(%rsp)</span><br><span class="line">400f6f:	77 3c                	ja     400fad &lt;phase_3+0x6a&gt;</span><br><span class="line">...</span><br><span class="line">400fad:	e8 88 04 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br></pre></td></tr></table></figure>
<p>400f60和400f63判断<code>%eax</code>是否为1：</p>
<ul>
<li>若不为1则继续执行400f65使炸弹爆炸；</li>
<li>若为1则跳到400f6a（400f43+0x27），和400f6f判断<code>%rsp+8</code>指向的值（输入的第1个整数）是否超过7:<ul>
<li>若超过7则跳到400fad（400f43+0x6a）使炸弹爆炸（由<code>ja</code>针对无符号数可以得知<strong>第一个整数在0～7之间</strong>）；</li>
<li>若不超过7则继续执行</li>
</ul>
</li>
</ul>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">400f71:	8b 44 24 08          	mov    0x8(%rsp),%eax</span><br></pre></td></tr></table></figure>
<p>400f71将<code>%rsp+8</code>指向的值（输入的第1个整数）赋给<code>%eax</code></p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">400f75:	ff 24 c5 70 24 40 00 	jmpq   *0x402470(,%rax,8)</span><br></pre></td></tr></table></figure>
<p>400f75根据<code>%rax</code>的值（输入的第一个整数）跳转到相应地址存放的地址，由于第一个整数在0～7之间，<code>gdb</code>以单字节十六进制查看8*8=64个对应地址：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/64xb 0x402470</span><br></pre></td></tr></table></figure>
<p>得到输出如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">0x402470:       0x7c    0x0f    0x40    0x00    0x00    0x00    0x00    0x00</span><br><span class="line">0x402478:       0xb9    0x0f    0x40    0x00    0x00    0x00    0x00    0x00</span><br><span class="line">0x402480:       0x83    0x0f    0x40    0x00    0x00    0x00    0x00    0x00</span><br><span class="line">0x402488:       0x8a    0x0f    0x40    0x00    0x00    0x00    0x00    0x00</span><br><span class="line">0x402490:       0x91    0x0f    0x40    0x00    0x00    0x00    0x00    0x00</span><br><span class="line">0x402498:       0x98    0x0f    0x40    0x00    0x00    0x00    0x00    0x00</span><br><span class="line">0x4024a0:       0x9f    0x0f    0x40    0x00    0x00    0x00    0x00    0x00</span><br><span class="line">0x4024a8:       0xa6    0x0f    0x40    0x00    0x00    0x00    0x00    0x00</span><br></pre></td></tr></table></figure>
<p>由于机器为小端法（little endian），整理后得到输入的第一个整数为0～7时依次对应跳转到的地址依次为：<code>0x400f7c</code>、<code>0x400fb9</code>、<code>0x400f83</code>、<code>0x400f8a</code>、<code>0x400f91</code>、<code>0x400f98</code>、<code>0x400f9f</code>和<code>0x400fa6</code></p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"> 400f7c:	b8 cf 00 00 00       	mov    $0xcf,%eax</span><br><span class="line"> 400f81:	eb 3b                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line"> 400f83:	b8 c3 02 00 00       	mov    $0x2c3,%eax</span><br><span class="line"> 400f88:	eb 34                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line"> 400f8a:	b8 00 01 00 00       	mov    $0x100,%eax</span><br><span class="line"> 400f8f:	eb 2d                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line"> 400f91:	b8 85 01 00 00       	mov    $0x185,%eax</span><br><span class="line"> 400f96:	eb 26                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line"> 400f98:	b8 ce 00 00 00       	mov    $0xce,%eax</span><br><span class="line"> 400f9d:	eb 1f                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line"> 400f9f:	b8 aa 02 00 00       	mov    $0x2aa,%eax</span><br><span class="line"> 400fa4:	eb 18                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line"> 400fa6:	b8 47 01 00 00       	mov    $0x147,%eax</span><br><span class="line"> 400fab:	eb 11                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">...</span><br><span class="line"> 400fb2:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line"> 400fb7:	eb 05                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line"> 400fb9:	b8 37 01 00 00       	mov    $0x137,%eax</span><br><span class="line"> 400fbe:	3b 44 24 0c          	cmp    0xc(%rsp),%eax</span><br><span class="line"> 400fc2:	74 05                	je     400fc9 &lt;phase_3+0x86&gt;</span><br><span class="line"> 400fc4:	e8 71 04 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line"> 400fc9:	48 83 c4 18          	add    $0x18,%rsp</span><br><span class="line"> 400fcd:	c3                   	retq</span><br></pre></td></tr></table></figure>
<p>类似<code>switch</code>语句，结合上述得到的8个地址，此部分等价于：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> (passwd[<span class="number">0</span>]) &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="number">0</span>: result = <span class="number">207</span>; <span class="keyword">break</span>;<span class="comment">// 0x400f7c</span></span><br><span class="line">  <span class="keyword">case</span> <span class="number">1</span>: result = <span class="number">311</span>; <span class="keyword">break</span>;<span class="comment">// 0x400fb9</span></span><br><span class="line">  <span class="keyword">case</span> <span class="number">2</span>: result = <span class="number">707</span>; <span class="keyword">break</span>;<span class="comment">// 0x400f83</span></span><br><span class="line">  <span class="keyword">case</span> <span class="number">3</span>: result = <span class="number">256</span>; <span class="keyword">break</span>;<span class="comment">// 0x400f8a</span></span><br><span class="line">  <span class="keyword">case</span> <span class="number">4</span>: result = <span class="number">389</span>; <span class="keyword">break</span>;<span class="comment">// 0x400f91</span></span><br><span class="line">  <span class="keyword">case</span> <span class="number">5</span>: result = <span class="number">206</span>; <span class="keyword">break</span>;<span class="comment">// 0x400f98</span></span><br><span class="line">  <span class="keyword">case</span> <span class="number">6</span>: result = <span class="number">682</span>; <span class="keyword">break</span>;<span class="comment">// 0x400f9f</span></span><br><span class="line">  <span class="keyword">case</span> <span class="number">7</span>: result = <span class="number">327</span>; <span class="keyword">break</span>;<span class="comment">// 0x400fa6</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>每个<code>case</code>赋值后，都跳到400fbe（400f43+0x7b）和400fc2将<code>%rsp+12</code>指向的值（输入的第2个整数）和<code>%eax</code>的值（<code>result</code>值）对比：</p>
<ul>
<li>若二者相等则跳到400fc9弹出栈并<strong>返回</strong>；</li>
<li>若二者不等则继续执行400fc4使炸弹爆炸</li>
</ul>
<p>综上得知输入的第1个整数可以有8种情况，而输入的第2个整数因第1个整数而异</p>
<hr>
<p>至此，得到<code>phase_3</code>的password为</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 207</span><br></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 311</span><br></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2 707</span><br></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3 256</span><br></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4 389</span><br></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">5 206</span><br></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">6 682</span><br></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">7 327</span><br></pre></td></tr></table></figure>
<h1 id="Phase-4-recursion"><a href="#Phase-4-recursion" class="headerlink" title="Phase 4: recursion"></a>Phase 4: <em>recursion</em></h1><p><code>phase_4</code>对应的汇编语句如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">000000000040100c &lt;phase_4&gt;:</span><br><span class="line">  40100c:	48 83 ec 18          	sub    $0x18,%rsp</span><br><span class="line">  401010:	48 8d 4c 24 0c       	lea    0xc(%rsp),%rcx</span><br><span class="line">  401015:	48 8d 54 24 08       	lea    0x8(%rsp),%rdx</span><br><span class="line">  40101a:	be cf 25 40 00       	mov    $0x4025cf,%esi</span><br><span class="line">  40101f:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  401024:	e8 c7 fb ff ff       	callq  400bf0 &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line">  401029:	83 f8 02             	cmp    $0x2,%eax</span><br><span class="line">  40102c:	75 07                	jne    401035 &lt;phase_4+0x29&gt;</span><br><span class="line">  40102e:	83 7c 24 08 0e       	cmpl   $0xe,0x8(%rsp)</span><br><span class="line">  401033:	76 05                	jbe    40103a &lt;phase_4+0x2e&gt;</span><br><span class="line">  401035:	e8 00 04 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  40103a:	ba 0e 00 00 00       	mov    $0xe,%edx</span><br><span class="line">  40103f:	be 00 00 00 00       	mov    $0x0,%esi</span><br><span class="line">  401044:	8b 7c 24 08          	mov    0x8(%rsp),%edi</span><br><span class="line">  401048:	e8 81 ff ff ff       	callq  400fce &lt;func4&gt;</span><br><span class="line">  40104d:	85 c0                	test   %eax,%eax</span><br><span class="line">  40104f:	75 07                	jne    401058 &lt;phase_4+0x4c&gt;</span><br><span class="line">  401051:	83 7c 24 0c 00       	cmpl   $0x0,0xc(%rsp)</span><br><span class="line">  401056:	74 05                	je     40105d &lt;phase_4+0x51&gt;</span><br><span class="line">  401058:	e8 dd 03 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  40105d:	48 83 c4 18          	add    $0x18,%rsp</span><br><span class="line">  401061:	c3                   	retq</span><br></pre></td></tr></table></figure>
<hr>
<p>分段分析：</p>
<hr>
<p>40100c～401024与<code>phase_3</code>的400f43～400f5b相同，即<code>phase_4</code>的password同样可能是两个整数，中间以1个空格隔开，而且输入的两个整数分别存储于<code>%rsp+8</code>和<code>%rsp+12</code>两个地址中</p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">401029:	83 f8 02             	cmp    $0x2,%eax</span><br><span class="line">40102c:	75 07                	jne    401035 &lt;phase_4+0x29&gt;</span><br><span class="line">...</span><br><span class="line">401035:	e8 00 04 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br></pre></td></tr></table></figure>
<p>401029和40102c判断<code>%eax</code>（<code>sscanf</code>函数的返回值）是否为2，即判断输入的是否为2个整数：</p>
<ul>
<li>不为2则跳到401035（40100c+0x29）使炸弹爆炸；</li>
<li>为2则继续执行</li>
</ul>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">40102e:	83 7c 24 08 0e       	cmpl   $0xe,0x8(%rsp)</span><br><span class="line">401033:	76 05                	jbe    40103a &lt;phase_4+0x2e&gt;</span><br><span class="line">401035:	e8 00 04 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">40103a:	ba 0e 00 00 00       	mov    $0xe,%edx</span><br></pre></td></tr></table></figure>
<p>40102e和401033判断<code>%rsp+8</code>指向的值（输入的第1个整数）是否不超过14:</p>
<ul>
<li>若超过14则继续执行401035使炸弹爆炸（由此得知<strong>输入的第1个整数范围是0～14</strong>）；</li>
<li>若不超过14则跳到40103a（40100c+0x2e）把<code>%edx</code>赋为14</li>
</ul>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">40103f:	be 00 00 00 00       	mov    $0x0,%esi</span><br><span class="line">401044:	8b 7c 24 08          	mov    0x8(%rsp),%edi</span><br><span class="line">401048:	e8 81 ff ff ff       	callq  400fce &lt;func4&gt;</span><br></pre></td></tr></table></figure>
<p>40103f把<code>%esi</code>赋为0，401044将<code>%rsp+8</code>指向的值（输入的第1个整数）给<code>%edi</code>，401048<span id = "p4">调用了<code>func4</code>函数</span>（无法推测func4函数的功能，<a href="#func4">点此分析<code>func4</code>函数</a>）</p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">40104d:	85 c0                	test   %eax,%eax</span><br><span class="line">40104f:	75 07                	jne    401058 &lt;phase_4+0x4c&gt;</span><br><span class="line">401051:	83 7c 24 0c 00       	cmpl   $0x0,0xc(%rsp)</span><br><span class="line">401056:	74 05                	je     40105d &lt;phase_4+0x51&gt;</span><br><span class="line">401058:	e8 dd 03 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">40105d:	48 83 c4 18          	add    $0x18,%rsp</span><br><span class="line">401061:	c3                   	retq </span><br></pre></td></tr></table></figure>
<p>40104d和40104f判断<code>%eax</code>的值（<code>func4</code>函数的返回值）是否为0:</p>
<ul>
<li>若不为0则跳到401058（40100c+0x4c）使炸弹爆炸（由此得知**<code>func4</code>函数的返回值必须为0**）；</li>
<li>若为0则继续执行401051和401056判断<code>%rsp+12</code>指向的值（输入的第2个整数）是否为0:<ul>
<li>若为0则跳到40105d（40100c+0x51）弹出栈并<strong>返回</strong>；</li>
<li>若不为0则继续执行401058使炸弹爆炸（由此得知<strong>输入的第2个整数必须为0</strong>）</li>
</ul>
</li>
</ul>
<hr>
<p>分析完毕，已经得知<code>phase_4</code>的password由两个整数构成，而第2个整数必为0，第一个整数是使<code>func4</code>函数返回值为0且在0～14之间的数。</p>
<p>编写C程序求第一个整数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">func4</span><span class="params">(<span class="keyword">int</span>, <span class="keyword">int</span>, <span class="keyword">int</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> min = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> max = <span class="number">14</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">15</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!func4(i, min, max))</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>得到输出如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">0</span><br><span class="line">1</span><br><span class="line">3</span><br><span class="line">7</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>即第1个整数可以是<code>0</code>、<code>1</code>、<code>3</code>或<code>7</code>。</p>
<p>至此，得到<code>phase_4</code>的password为</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 0</span><br></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 0</span><br></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3 0</span><br></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">7 0</span><br></pre></td></tr></table></figure>
<h1 id="Phase-5-pointer"><a href="#Phase-5-pointer" class="headerlink" title="Phase 5: pointer"></a>Phase 5: <em>pointer</em></h1><p><code>phase_5</code>对应的汇编语句如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">0000000000401062 &lt;phase_5&gt;:</span><br><span class="line">  401062:	53                   	push   %rbx</span><br><span class="line">  401063:	48 83 ec 20          	sub    $0x20,%rsp</span><br><span class="line">  401067:	48 89 fb             	mov    %rdi,%rbx</span><br><span class="line">  40106a:	64 48 8b 04 25 28 00 	mov    %fs:0x28,%rax</span><br><span class="line">  401071:	00 00 </span><br><span class="line">  401073:	48 89 44 24 18       	mov    %rax,0x18(%rsp)</span><br><span class="line">  401078:	31 c0                	xor    %eax,%eax</span><br><span class="line">  40107a:	e8 9c 02 00 00       	callq  40131b &lt;string_length&gt;</span><br><span class="line">  40107f:	83 f8 06             	cmp    $0x6,%eax</span><br><span class="line">  401082:	74 4e                	je     4010d2 &lt;phase_5+0x70&gt;</span><br><span class="line">  401084:	e8 b1 03 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  401089:	eb 47                	jmp    4010d2 &lt;phase_5+0x70&gt;</span><br><span class="line">  40108b:	0f b6 0c 03          	movzbl (%rbx,%rax,1),%ecx</span><br><span class="line">  40108f:	88 0c 24             	mov    %cl,(%rsp)</span><br><span class="line">  401092:	48 8b 14 24          	mov    (%rsp),%rdx</span><br><span class="line">  401096:	83 e2 0f             	and    $0xf,%edx</span><br><span class="line">  401099:	0f b6 92 b0 24 40 00 	movzbl 0x4024b0(%rdx),%edx</span><br><span class="line">  4010a0:	88 54 04 10          	mov    %dl,0x10(%rsp,%rax,1)</span><br><span class="line">  4010a4:	48 83 c0 01          	add    $0x1,%rax</span><br><span class="line">  4010a8:	48 83 f8 06          	cmp    $0x6,%rax</span><br><span class="line">  4010ac:	75 dd                	jne    40108b &lt;phase_5+0x29&gt;</span><br><span class="line">  4010ae:	c6 44 24 16 00       	movb   $0x0,0x16(%rsp)</span><br><span class="line">  4010b3:	be 5e 24 40 00       	mov    $0x40245e,%esi</span><br><span class="line">  4010b8:	48 8d 7c 24 10       	lea    0x10(%rsp),%rdi</span><br><span class="line">  4010bd:	e8 76 02 00 00       	callq  401338 &lt;strings_not_equal&gt;</span><br><span class="line">  4010c2:	85 c0                	test   %eax,%eax</span><br><span class="line">  4010c4:	74 13                	je     4010d9 &lt;phase_5+0x77&gt;</span><br><span class="line">  4010c6:	e8 6f 03 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  4010cb:	0f 1f 44 00 00       	nopl   0x0(%rax,%rax,1)</span><br><span class="line">  4010d0:	eb 07                	jmp    4010d9 &lt;phase_5+0x77&gt;</span><br><span class="line">  4010d2:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  4010d7:	eb b2                	jmp    40108b &lt;phase_5+0x29&gt;</span><br><span class="line">  4010d9:	48 8b 44 24 18       	mov    0x18(%rsp),%rax</span><br><span class="line">  4010de:	64 48 33 04 25 28 00 	xor    %fs:0x28,%rax</span><br><span class="line">  4010e5:	00 00 </span><br><span class="line">  4010e7:	74 05                	je     4010ee &lt;phase_5+0x8c&gt;</span><br><span class="line">  4010e9:	e8 42 fa ff ff       	callq  400b30 &lt;__stack_chk_fail@plt&gt;</span><br><span class="line">  4010ee:	48 83 c4 20          	add    $0x20,%rsp</span><br><span class="line">  4010f2:	5b                   	pop    %rbx</span><br><span class="line">  4010f3:	c3                   	retq   </span><br></pre></td></tr></table></figure>
<hr>
<p>分段分析：</p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">401062:	53                   	push   %rbx</span><br><span class="line">401063:	48 83 ec 20          	sub    $0x20,%rsp</span><br><span class="line">...</span><br><span class="line">40106a:	64 48 8b 04 25 28 00 	mov    %fs:0x28,%rax</span><br><span class="line">401071:	00 00 </span><br><span class="line">401073:	48 89 44 24 18       	mov    %rax,0x18(%rsp)</span><br><span class="line">...</span><br><span class="line">4010d9:	48 8b 44 24 18       	mov    0x18(%rsp),%rax</span><br><span class="line">4010de:	64 48 33 04 25 28 00 	xor    %fs:0x28,%rax</span><br><span class="line">4010e5:	00 00 </span><br><span class="line">4010e7:	74 05                	je     4010ee &lt;phase_5+0x8c&gt;</span><br><span class="line">4010e9:	e8 42 fa ff ff       	callq  400b30 &lt;__stack_chk_fail@plt&gt;</span><br><span class="line">4010ee:	48 83 c4 20          	add    $0x20,%rsp</span><br><span class="line">4010f2:	5b                   	pop    %rbx</span><br><span class="line">4010f3:	c3                   	retq  </span><br></pre></td></tr></table></figure>
<p><span id ="stackCanacy"><code>%fs:40</code>是FS段寄存器上偏移地址<code>0x28</code>上的数据，这是一个<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/10325713/why-does-this-memory-address-fs0x28-fs0x28-have-a-random-value">随机量</a>，起到<a target="_blank" rel="noopener" href="https://unix.stackexchange.com/questions/453749/what-sets-fs0x28-stack-canary">stack canary</a>的作用。此部分利用stack canary确保<code>24(%rsp)</code>的数值（栈底8字节，401063）在函数调用前后不改变，若改变则执行4010e9调用<code>__stack_chk_fail</code>函数跳出，以防栈溢出（stack overflow）。</span></p>
<p>此部分与拆弹联系较弱，可以跳过。</p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">401067:	48 89 fb             	mov    %rdi,%rbx</span><br><span class="line">...</span><br><span class="line">401078:	31 c0                	xor    %eax,%eax</span><br><span class="line">40107a:	e8 9c 02 00 00       	callq  40131b &lt;string_length&gt;</span><br></pre></td></tr></table></figure>
<p>401067将<code>%rdi</code>的地址（指向输入串）赋给<code>%rbx</code>，401078将<code>%eax</code>设为0，40107a调用<code>string_length</code>函数，返回输入串的长度<code>%eax</code></p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">40107f:	83 f8 06             	cmp    $0x6,%eax</span><br><span class="line">401082:	74 4e                	je     4010d2 &lt;phase_5+0x70&gt;</span><br><span class="line">401084:	e8 b1 03 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">...</span><br><span class="line">4010d2:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">4010d7:	eb b2                	jmp    40108b &lt;phase_5+0x29&gt;</span><br></pre></td></tr></table></figure>
<p>40107f和401082判断<code>%eax</code>的值（输入串的长度）是否为6：</p>
<ul>
<li>若不为6则继续执行401084使炸弹爆炸（由此得知<strong>输入串长度必须为6</strong>）；</li>
<li>若为6则跳到4010d2（401062+0x70）将<code>%eax</code>赋为0，4010d7跳到40108b（401062+0x29）</li>
</ul>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">401089:	eb 47                	jmp    4010d2 &lt;phase_5+0x70&gt;</span><br><span class="line">40108b:	0f b6 0c 03          	movzbl (%rbx,%rax,1),%ecx</span><br><span class="line">40108f:	88 0c 24             	mov    %cl,(%rsp)</span><br><span class="line">401092:	48 8b 14 24          	mov    (%rsp),%rdx</span><br><span class="line">401096:	83 e2 0f             	and    $0xf,%edx</span><br><span class="line">401099:	0f b6 92 b0 24 40 00 	movzbl 0x4024b0(%rdx),%edx</span><br><span class="line">4010a0:	88 54 04 10          	mov    %dl,0x10(%rsp,%rax,1)</span><br><span class="line">4010a4:	48 83 c0 01          	add    $0x1,%rax</span><br><span class="line">4010a8:	48 83 f8 06          	cmp    $0x6,%rax</span><br><span class="line">4010ac:	75 dd                	jne    40108b &lt;phase_5+0x29&gt;</span><br></pre></td></tr></table></figure>
<p>此时<code>%eax</code>为0，40108b将<code>%rbx</code>指向的值加上<code>%rax</code>的值（输入串的第<code>%rax+1</code>个字符）赋给<code>%ecx</code>，40108f将<code>%cl</code>（输入串的第<code>%rax+1</code>个字符低8位）赋给<code>%rsp</code>指向的值，401092再把<code>%rsp</code>指向的值（输入串的第<code>%rax+1</code>个字符低8位）赋给<code>%rdx</code>，401096将<code>%edx</code>（输入串的第<code>%rax+1</code>个字符低8位）和<code>0xf</code>按位取与（取低8位的低4位，结果存放于<code>%edx</code>中），401099将<code>0x4024b0</code>作为基地址、<code>%rdx</code>指向的值（取与后的值）作为偏移量，并将偏移后的值赋给<code>%edx</code>，4010a0将<code>%dl</code>（<code>%edx</code>低8位）赋给<code>%rsp+%rax+16</code>指向的值，4010a4<code>%rax</code>作为索引加1，4010a8判断<code>%rax</code>是否为6:</p>
<ul>
<li>不为6则跳到40108b（401062+0x29）循环；</li>
<li>为6则继续执行4010ae</li>
</ul>
<p>可以看出此处的循环等价于：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> i = <span class="number">0</span>;<span class="comment">// %eax</span></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i != <span class="number">6</span>; i++) &#123;<span class="comment">// %rax</span></span><br><span class="line">	ch = passwd[i];<span class="comment">// %rbx-&gt;%ecx</span></span><br><span class="line">  index = ch;<span class="comment">// %cl-&gt;%rsp-&gt;rdx</span></span><br><span class="line">  index &amp;= <span class="number">0xf</span>;<span class="comment">// %edx</span></span><br><span class="line">  ch = func[index];<span class="comment">// 0x4024b0 + index-&gt;%edx</span></span><br><span class="line">  str[i] = ch;<span class="comment">// %dl-&gt;%rsp + 16 + i</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由输入串的6个字符，每个字符的低4位作为偏移量，<code>0x4024b0</code>作为基地址，最终映射生成新的<code>str</code>串</p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">4010ae:	c6 44 24 16 00       	movb   $0x0,0x16(%rsp)</span><br><span class="line">4010b3:	be 5e 24 40 00       	mov    $0x40245e,%esi</span><br><span class="line">4010b8:	48 8d 7c 24 10       	lea    0x10(%rsp),%rdi</span><br><span class="line">4010bd:	e8 76 02 00 00       	callq  401338 &lt;strings_not_equal&gt;</span><br><span class="line">4010c2:	85 c0                	test   %eax,%eax</span><br><span class="line">4010c4:	74 13                	je     4010d9 &lt;phase_5+0x77&gt;</span><br><span class="line">4010c6:	e8 6f 03 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">4010cb:	0f 1f 44 00 00       	nopl   0x0(%rax,%rax,1)</span><br><span class="line">4010d0:	eb 07                	jmp    4010d9 &lt;phase_5+0x77&gt;</span><br><span class="line">4010d2:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">4010d7:	eb b2                	jmp    40108b &lt;phase_5+0x29&gt;</span><br><span class="line">4010d9:	48 8b 44 24 18       	mov    0x18(%rsp),%rax</span><br></pre></td></tr></table></figure>
<p>4010ae将<code>%rsp+22</code>指向的值（<code>str[6]</code>）赋为<code>&#39;\0&#39;</code>，4010b3将地址<code>0x40245e</code>赋给<code>%esi</code>，4010b8将<code>%rsp+16</code>的地址（<code>str</code>）赋给<code>%rdi</code>，4010bd调用<code>strings_not_equal</code>函数（相等返回0，不等返回1），4010c2和4010c4判断返回值<code>%eax</code>是否为0：</p>
<ul>
<li>若不为0则继续执行4010c6使炸弹爆炸（由此得知<strong>返回值须为0</strong>，即<strong>生成的<code>str</code>串须等于<code>0x40245e</code>处的字符串</strong>）；</li>
<li>若为0则跳到4010d9（401062+0x77）继续执行则弹出栈并<strong>返回</strong></li>
</ul>
<p>直接<code>gdb</code>查看<code>0x40245e</code>处的字符串：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/s 0x40245e</span><br></pre></td></tr></table></figure>
<p>得到输出如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x40245e:       &quot;flyers&quot;</span><br></pre></td></tr></table></figure>
<p>即我们新生成的<code>str</code>串须为“<code>flyers</code>”</p>
<hr>
<p><code>gdb</code>查看基地址<code>0x4024b0</code>处的字符串：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/s 0x4024b0</span><br></pre></td></tr></table></figure>
<p>得到输出如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x4024b0 &lt;array.3449&gt;:  &quot;maduiersnfotvbylSo you think you can stop the bomb with ctrl-c, do you?&quot;</span><br></pre></td></tr></table></figure>
<p>即基地址指向的字符串为“<code>maduiersnfotvbyl</code>”，从中找到“<code>flyers</code>”对应的下标为<code>9</code>、<code>15</code>、<code>14</code>、<code>5</code>、<code>6</code>和<code>7</code>，转换为十六进制为<code>0x9</code>、<code>0xf</code>、<code>0xe</code>、<code>0x5</code>、<code>0x6</code>和<code>0x7</code>——这就是输入串6个字符的低4位的值。</p>
<p>借助ASCII表，可以发现<code>phase_5</code>的密码并不唯一。</p>
<p><img src="https://super-bucket1.oss-cn-beijing.aliyuncs.com/ASCII.png" alt="ASCII"></p>
<ul>
<li>低4位为<code>0x9</code>的字符有：<code>)</code>、<code>9</code>、<code>I</code>、<code>Y</code>、<code>i</code>、<code>y</code></li>
<li>低4位为<code>0xf</code>的字符有：<code>/</code>、<code>?</code>、<code>O</code>、<code>_</code>、<code>o</code></li>
<li>低4位为<code>0xe</code>的字符有：<code>.</code>、<code>&gt;</code>、<code>N</code>、<code>^</code>、<code>n</code>、<code>~</code></li>
<li>低4位为<code>0x5</code>的字符有：<code>%</code>、<code>5</code>、<code>E</code>、<code>U</code>、<code>e</code>、<code>u</code></li>
<li>低4位为<code>0x6</code>的字符有：<code>&amp;</code>、<code>6</code>、<code>F</code>、<code>V</code>、<code>f</code>、<code>v</code></li>
<li>低4位为<code>0x7</code>的字符有：<code>&#39;</code>、<code>7</code>、<code>G</code>、<code>W</code>、<code>g</code>、<code>w</code></li>
</ul>
<p>至此，得到<code>phase_5</code>的password为（不唯一）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">9/N567</span><br></pre></td></tr></table></figure>
<h1 id="Phase-6-link-list"><a href="#Phase-6-link-list" class="headerlink" title="Phase 6: link list"></a>Phase 6: <em>link list</em></h1><p><code>phase_6</code>对应的汇编语句如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">00000000004010f4 &lt;phase_6&gt;:</span><br><span class="line">  4010f4:	41 56                	push   %r14</span><br><span class="line">  4010f6:	41 55                	push   %r13</span><br><span class="line">  4010f8:	41 54                	push   %r12</span><br><span class="line">  4010fa:	55                   	push   %rbp</span><br><span class="line">  4010fb:	53                   	push   %rbx</span><br><span class="line">  4010fc:	48 83 ec 50          	sub    $0x50,%rsp</span><br><span class="line">  401100:	49 89 e5             	mov    %rsp,%r13</span><br><span class="line">  401103:	48 89 e6             	mov    %rsp,%rsi</span><br><span class="line">  401106:	e8 51 03 00 00       	callq  40145c &lt;read_six_numbers&gt;</span><br><span class="line">  40110b:	49 89 e6             	mov    %rsp,%r14</span><br><span class="line">  40110e:	41 bc 00 00 00 00    	mov    $0x0,%r12d</span><br><span class="line">  401114:	4c 89 ed             	mov    %r13,%rbp</span><br><span class="line">  401117:	41 8b 45 00          	mov    0x0(%r13),%eax</span><br><span class="line">  40111b:	83 e8 01             	sub    $0x1,%eax</span><br><span class="line">  40111e:	83 f8 05             	cmp    $0x5,%eax</span><br><span class="line">  401121:	76 05                	jbe    401128 &lt;phase_6+0x34&gt;</span><br><span class="line">  401123:	e8 12 03 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  401128:	41 83 c4 01          	add    $0x1,%r12d</span><br><span class="line">  40112c:	41 83 fc 06          	cmp    $0x6,%r12d</span><br><span class="line">  401130:	74 21                	je     401153 &lt;phase_6+0x5f&gt;</span><br><span class="line">  401132:	44 89 e3             	mov    %r12d,%ebx</span><br><span class="line">  401135:	48 63 c3             	movslq %ebx,%rax</span><br><span class="line">  401138:	8b 04 84             	mov    (%rsp,%rax,4),%eax</span><br><span class="line">  40113b:	39 45 00             	cmp    %eax,0x0(%rbp)</span><br><span class="line">  40113e:	75 05                	jne    401145 &lt;phase_6+0x51&gt;</span><br><span class="line">  401140:	e8 f5 02 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  401145:	83 c3 01             	add    $0x1,%ebx</span><br><span class="line">  401148:	83 fb 05             	cmp    $0x5,%ebx</span><br><span class="line">  40114b:	7e e8                	jle    401135 &lt;phase_6+0x41&gt;</span><br><span class="line">  40114d:	49 83 c5 04          	add    $0x4,%r13</span><br><span class="line">  401151:	eb c1                	jmp    401114 &lt;phase_6+0x20&gt;</span><br><span class="line">  401153:	48 8d 74 24 18       	lea    0x18(%rsp),%rsi</span><br><span class="line">  401158:	4c 89 f0             	mov    %r14,%rax</span><br><span class="line">  40115b:	b9 07 00 00 00       	mov    $0x7,%ecx</span><br><span class="line">  401160:	89 ca                	mov    %ecx,%edx</span><br><span class="line">  401162:	2b 10                	sub    (%rax),%edx</span><br><span class="line">  401164:	89 10                	mov    %edx,(%rax)</span><br><span class="line">  401166:	48 83 c0 04          	add    $0x4,%rax</span><br><span class="line">  40116a:	48 39 f0             	cmp    %rsi,%rax</span><br><span class="line">  40116d:	75 f1                	jne    401160 &lt;phase_6+0x6c&gt;</span><br><span class="line">  40116f:	be 00 00 00 00       	mov    $0x0,%esi</span><br><span class="line">  401174:	eb 21                	jmp    401197 &lt;phase_6+0xa3&gt;</span><br><span class="line">  401176:	48 8b 52 08          	mov    0x8(%rdx),%rdx</span><br><span class="line">  40117a:	83 c0 01             	add    $0x1,%eax</span><br><span class="line">  40117d:	39 c8                	cmp    %ecx,%eax</span><br><span class="line">  40117f:	75 f5                	jne    401176 &lt;phase_6+0x82&gt;</span><br><span class="line">  401181:	eb 05                	jmp    401188 &lt;phase_6+0x94&gt;</span><br><span class="line">  401183:	ba d0 32 60 00       	mov    $0x6032d0,%edx</span><br><span class="line">  401188:	48 89 54 74 20       	mov    %rdx,0x20(%rsp,%rsi,2)</span><br><span class="line">  40118d:	48 83 c6 04          	add    $0x4,%rsi</span><br><span class="line">  401191:	48 83 fe 18          	cmp    $0x18,%rsi</span><br><span class="line">  401195:	74 14                	je     4011ab &lt;phase_6+0xb7&gt;</span><br><span class="line">  401197:	8b 0c 34             	mov    (%rsp,%rsi,1),%ecx</span><br><span class="line">  40119a:	83 f9 01             	cmp    $0x1,%ecx</span><br><span class="line">  40119d:	7e e4                	jle    401183 &lt;phase_6+0x8f&gt;</span><br><span class="line">  40119f:	b8 01 00 00 00       	mov    $0x1,%eax</span><br><span class="line">  4011a4:	ba d0 32 60 00       	mov    $0x6032d0,%edx</span><br><span class="line">  4011a9:	eb cb                	jmp    401176 &lt;phase_6+0x82&gt;</span><br><span class="line">  4011ab:	48 8b 5c 24 20       	mov    0x20(%rsp),%rbx</span><br><span class="line">  4011b0:	48 8d 44 24 28       	lea    0x28(%rsp),%rax</span><br><span class="line">  4011b5:	48 8d 74 24 50       	lea    0x50(%rsp),%rsi</span><br><span class="line">  4011ba:	48 89 d9             	mov    %rbx,%rcx</span><br><span class="line">  4011bd:	48 8b 10             	mov    (%rax),%rdx</span><br><span class="line">  4011c0:	48 89 51 08          	mov    %rdx,0x8(%rcx)</span><br><span class="line">  4011c4:	48 83 c0 08          	add    $0x8,%rax</span><br><span class="line">  4011c8:	48 39 f0             	cmp    %rsi,%rax</span><br><span class="line">  4011cb:	74 05                	je     4011d2 &lt;phase_6+0xde&gt;</span><br><span class="line">  4011cd:	48 89 d1             	mov    %rdx,%rcx</span><br><span class="line">  4011d0:	eb eb                	jmp    4011bd &lt;phase_6+0xc9&gt;</span><br><span class="line">  4011d2:	48 c7 42 08 00 00 00 	movq   $0x0,0x8(%rdx)</span><br><span class="line">  4011d9:	00 </span><br><span class="line">  4011da:	bd 05 00 00 00       	mov    $0x5,%ebp</span><br><span class="line">  4011df:	48 8b 43 08          	mov    0x8(%rbx),%rax</span><br><span class="line">  4011e3:	8b 00                	mov    (%rax),%eax</span><br><span class="line">  4011e5:	39 03                	cmp    %eax,(%rbx)</span><br><span class="line">  4011e7:	7d 05                	jge    4011ee &lt;phase_6+0xfa&gt;</span><br><span class="line">  4011e9:	e8 4c 02 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  4011ee:	48 8b 5b 08          	mov    0x8(%rbx),%rbx</span><br><span class="line">  4011f2:	83 ed 01             	sub    $0x1,%ebp</span><br><span class="line">  4011f5:	75 e8                	jne    4011df &lt;phase_6+0xeb&gt;</span><br><span class="line">  4011f7:	48 83 c4 50          	add    $0x50,%rsp</span><br><span class="line">  4011fb:	5b                   	pop    %rbx</span><br><span class="line">  4011fc:	5d                   	pop    %rbp</span><br><span class="line">  4011fd:	41 5c                	pop    %r12</span><br><span class="line">  4011ff:	41 5d                	pop    %r13</span><br><span class="line">  401201:	41 5e                	pop    %r14</span><br><span class="line">  401203:	c3                   	retq   </span><br></pre></td></tr></table></figure>
<hr>
<p>分段分析：</p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">4010f4:	41 56                	push   %r14</span><br><span class="line">4010f6:	41 55                	push   %r13</span><br><span class="line">4010f8:	41 54                	push   %r12</span><br><span class="line">4010fa:	55                   	push   %rbp</span><br><span class="line">4010fb:	53                   	push   %rbx</span><br><span class="line">4010fc:	48 83 ec 50          	sub    $0x50,%rsp</span><br><span class="line">401100:	49 89 e5             	mov    %rsp,%r13</span><br><span class="line">401103:	48 89 e6             	mov    %rsp,%rsi</span><br><span class="line">401106:	e8 51 03 00 00       	callq  40145c &lt;read_six_numbers&gt;</span><br><span class="line">40110b:	49 89 e6             	mov    %rsp,%r14</span><br></pre></td></tr></table></figure>
<p>401100将<code>%rsp</code>赋给<code>%r13</code>，401103将<code>%rsp</code>赋给<code>%rsi</code>，40110b将<code>%rsp</code>赋给<code>%r14</code>，401106调用<code>read_six_numbers</code>函数读取6个数字，输入的6个整数依次存放于<code>0(%rsp)</code>、<code>4(%rsp)</code>、<code>8(%rsp)</code>、<code>12(%rsp)</code>、<code>16(%rsp)</code>、<code>20(%rsp)</code>中</p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">40110e:	41 bc 00 00 00 00    	mov    $0x0,%r12d</span><br><span class="line">401114:	4c 89 ed             	mov    %r13,%rbp</span><br><span class="line">401117:	41 8b 45 00          	mov    0x0(%r13),%eax</span><br><span class="line">40111b:	83 e8 01             	sub    $0x1,%eax</span><br><span class="line">40111e:	83 f8 05             	cmp    $0x5,%eax</span><br><span class="line">401121:	76 05                	jbe    401128 &lt;phase_6+0x34&gt;</span><br><span class="line">401123:	e8 12 03 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">401128:	41 83 c4 01          	add    $0x1,%r12d</span><br><span class="line">40112c:	41 83 fc 06          	cmp    $0x6,%r12d</span><br><span class="line">401130:	74 21                	je     401153 &lt;phase_6+0x5f&gt;</span><br><span class="line">401132:	44 89 e3             	mov    %r12d,%ebx</span><br><span class="line">401135:	48 63 c3             	movslq %ebx,%rax</span><br><span class="line">401138:	8b 04 84             	mov    (%rsp,%rax,4),%eax</span><br><span class="line">40113b:	39 45 00             	cmp    %eax,0x0(%rbp)</span><br><span class="line">40113e:	75 05                	jne    401145 &lt;phase_6+0x51&gt;</span><br><span class="line">401140:	e8 f5 02 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">401145:	83 c3 01             	add    $0x1,%ebx</span><br><span class="line">401148:	83 fb 05             	cmp    $0x5,%ebx</span><br><span class="line">40114b:	7e e8                	jle    401135 &lt;phase_6+0x41&gt;</span><br><span class="line">40114d:	49 83 c5 04          	add    $0x4,%r13</span><br><span class="line">401151:	eb c1                	jmp    401114 &lt;phase_6+0x20&gt;</span><br></pre></td></tr></table></figure>
<p>40110e将<code>%r12d</code>赋为0，401114将<code>%r13</code>赋给<code>%rbp</code>，401117将<code>%r13</code>指向的值赋给<code>%eax</code>，40111b将<code>%eax</code>减1，40111e和401121判断<code>%eax</code>是否不超过5:</p>
<ul>
<li>若<code>%eax</code>超过5，则继续执行401123使炸弹爆炸；</li>
<li>若<code>%eax</code>不超过5，则跳到401128（4010f4+0x34）将<code>%r12d</code>加1，40112c和401130判断<code>%r12d</code>是否为6:<ul>
<li>若为6则跳到401153（4010f4+0x5f）；</li>
<li>若不为6则继续执行401132将<code>%r12d</code>赋给<code>%ebx</code>，401135再将<code>%ebx</code>赋给<code>%rax</code>，401138再将<code>%rsp+%rax+4</code>指向的值（下一个整数）赋给<code>%eax</code>，40113b和40113e判断<code>%eax</code>的值是否等于<code>%rbp</code>指向的值：<ul>
<li>若相等则继续运行401140使炸弹爆炸；</li>
<li>若不等则跳到401145（4010f4+0x51）将<code>%ebx</code>加1，401148和40114b判断<code>%ebx</code>是否不超过5：<ul>
<li>若不超过5则跳到401135（4010f4+0x41）循环；</li>
<li>若超过5则继续执行40114d将<code>%r13</code>加4，401151跳到401114（4010f4+0x20）循环</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>可以看出此处的循环等价于：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">next == <span class="number">0</span>;<span class="comment">// %r12d</span></span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">  num = *p_loc;<span class="comment">// %r13-&gt;%rbp, (%r13)-&gt;%eax</span></span><br><span class="line">  <span class="keyword">if</span> (--num &gt; <span class="number">5</span>)<span class="comment">// %eax</span></span><br><span class="line">    explode_bomb();</span><br><span class="line">  next++;<span class="comment">// %r12d</span></span><br><span class="line">  <span class="keyword">if</span> (next == <span class="number">6</span>)</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">for</span> (i = next; i &lt;= <span class="number">5</span>; i++) &#123;<span class="comment">// %r12d-&gt;%ebx; %ebx &lt;= 5</span></span><br><span class="line">    num_next = input[i];<span class="comment">// %ebx-&gt;%rax, (%rsp + %rax + 4)-&gt;%eax</span></span><br><span class="line">    <span class="keyword">if</span> (num_next == *p_loc)<span class="comment">// %eax == (%rbp)</span></span><br><span class="line">      explode_bomb();</span><br><span class="line">  &#125;</span><br><span class="line">  p_loc++;<span class="comment">// %e13</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看出，这6个无符号整数减1后不能超过5（第4、5行），即在1～6之间；且这6个数互不相同（第9～13行），即这6个整数的可能序列是<strong>1～6的全排列</strong>。</p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">401153:	48 8d 74 24 18       	lea    0x18(%rsp),%rsi</span><br><span class="line">401158:	4c 89 f0             	mov    %r14,%rax</span><br><span class="line">40115b:	b9 07 00 00 00       	mov    $0x7,%ecx</span><br><span class="line">401160:	89 ca                	mov    %ecx,%edx</span><br><span class="line">401162:	2b 10                	sub    (%rax),%edx</span><br><span class="line">401164:	89 10                	mov    %edx,(%rax)</span><br><span class="line">401166:	48 83 c0 04          	add    $0x4,%rax</span><br><span class="line">40116a:	48 39 f0             	cmp    %rsi,%rax</span><br><span class="line">40116d:	75 f1                	jne    401160 &lt;phase_6+0x6c&gt;</span><br></pre></td></tr></table></figure>
<p>上一循环跳出后即执行400153将<code>%rsp+24</code>的地址（6个整数末尾的位置）给<code>%rsi</code>，401158将<code>%r14</code>（6个整数开头的位置）赋给<code>%rax</code>，40115b将<code>%ecx</code>赋为7，401160将<code>%ecx</code>（7）赋给<code>%edx</code>，401162将<code>%edx</code>（7）减去<code>%rax</code>指向的值（第“<code>%rax+1</code>”个整数），401164将<code>%edx</code>（7）赋给<code>%rax</code>指向的值（第“<code>%rax+1</code>”个整数），401166将<code>%rax</code>加4（指向下一个整数），40116a和40116d判断<code>%rsi</code>（6个整数末尾的位置）和<code>%rax</code>（逐渐向后移动的指针）是否相等：</p>
<ul>
<li>若不等则跳到401160（4010f4+0x6c）循环；</li>
<li>若相等则继续执行下一部分；</li>
</ul>
<p>可以看出此处的循环等价于：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">p_end = rsp + <span class="number">6</span>;<span class="comment">// %rsp + 24-&gt;%rsi</span></span><br><span class="line">ecx = <span class="number">7</span>;<span class="comment">// 7-&gt;%ecx</span></span><br><span class="line"><span class="keyword">for</span> (i = p_begin; i != p_end; i++) &#123;<span class="comment">// %r14-&gt;%rax; %rax != %rsi; %rax += 4</span></span><br><span class="line">  num_new = ecx - *i;<span class="comment">// %ecx-&gt;%edx, %edx - (%rax)-&gt;%edx</span></span><br><span class="line">  *i = num_new;<span class="comment">// %edx-&gt;(%rax)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看出，原来输入到栈中的第<code>i</code>个整数被重写为<code>7-i</code>，将重写后的6个整数视为数组<code>nums[6]</code></p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">40116f:	be 00 00 00 00       	mov    $0x0,%esi</span><br><span class="line">401174:	eb 21                	jmp    401197 &lt;phase_6+0xa3&gt;</span><br><span class="line">401176:	48 8b 52 08          	mov    0x8(%rdx),%rdx</span><br><span class="line">40117a:	83 c0 01             	add    $0x1,%eax</span><br><span class="line">40117d:	39 c8                	cmp    %ecx,%eax</span><br><span class="line">40117f:	75 f5                	jne    401176 &lt;phase_6+0x82&gt;</span><br><span class="line">401181:	eb 05                	jmp    401188 &lt;phase_6+0x94&gt;</span><br><span class="line">401183:	ba d0 32 60 00       	mov    $0x6032d0,%edx</span><br><span class="line">401188:	48 89 54 74 20       	mov    %rdx,0x20(%rsp,%rsi,2)</span><br><span class="line">40118d:	48 83 c6 04          	add    $0x4,%rsi</span><br><span class="line">401191:	48 83 fe 18          	cmp    $0x18,%rsi</span><br><span class="line">401195:	74 14                	je     4011ab &lt;phase_6+0xb7&gt;</span><br><span class="line">401197:	8b 0c 34             	mov    (%rsp,%rsi,1),%ecx</span><br><span class="line">40119a:	83 f9 01             	cmp    $0x1,%ecx</span><br><span class="line">40119d:	7e e4                	jle    401183 &lt;phase_6+0x8f&gt;</span><br><span class="line">40119f:	b8 01 00 00 00       	mov    $0x1,%eax</span><br><span class="line">4011a4:	ba d0 32 60 00       	mov    $0x6032d0,%edx</span><br><span class="line">4011a9:	eb cb                	jmp    401176 &lt;phase_6+0x82&gt;</span><br></pre></td></tr></table></figure>
<p>40116f将<code>%esi</code>（外层循环的索引）赋为0，401174跳到401197（4010f4+0xa3）将<code>%rsp</code>指向的值（“数组基地址”）和<code>%rsi</code>指向的值（“偏移量”）相加赋给<code>%ecx</code>（依次取6个整数），40119a和40119d判断<code>%ecx</code>（当前整数）是否不超过1：</p>
<ul>
<li>若不超过1则跳到401183（4010f4+0x8f）将地址<code>0x6032d0</code>赋给<code>%edx</code>（某指针），401188将<code>%rdx</code>（某指针，存放地址<code>0x6032d0</code>）赋给<code>32+%rsp+%rsi*2</code>指向的值，40118d将<code>%rsi</code>加4（外层循环索引向后移动），401191和401195判断<code>%rsi</code>是否等于24（是否走到第6个整数）：<ul>
<li>若等于24则跳到4011ab（4010f4+0xb7）继续执行下一部分；</li>
<li>若不等于24则继续执行401197（外层）循环</li>
</ul>
</li>
<li>若超过1则继续执行40119f将<code>%eax</code>（内层循环的索引）赋为1，4011a4将地址<code>0x6032d0</code>赋给<code>%edx</code>（某指针），4011a9跳到401176（4010f4+0x82）将<code>%rdx+8</code>指向的值（下一个指针的值）赋给<code>%rdx</code>，40117a将<code>%eax</code>（内层循环的索引）加1，40117d和40117f判断<code>%ecx</code>（当前整数）和<code>%eax</code>（内层循环的索引）是否相等：<ul>
<li>若不等则跳到401176（4010f4+0x82）（内层）循环；</li>
<li>若相等则继续执行401181跳到401188（4010f4+0x94）继续外层循环</li>
</ul>
</li>
</ul>
<p>可以看出此处的两层循环等价于：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i != <span class="number">6</span>; i++) &#123;<span class="comment">// %esi</span></span><br><span class="line">  num = nums[i];<span class="comment">// (%rsp + i)-&gt;%ecx</span></span><br><span class="line">  <span class="keyword">if</span> (num &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">    p = <span class="number">0x6032d0</span>;<span class="comment">// 0x6032d0-&gt;%edx</span></span><br><span class="line">    new_nums[i] = p;<span class="comment">// %rdx-&gt;(%rsp + 2i + 32)</span></span><br><span class="line">    <span class="keyword">goto</span> <span class="number">0x401191</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">1</span>; j != num; j++) &#123;<span class="comment">// %eax</span></span><br><span class="line">      p = <span class="number">0x6032d0</span>;<span class="comment">// 0x6032d0-&gt;%edx</span></span><br><span class="line">      p = *(++p);<span class="comment">// (%rdx + 8)-&gt;%rdx</span></span><br><span class="line">      new_nums[i] = p;<span class="comment">// %rdx-&gt;(%rsp + 2i + 32)</span></span><br><span class="line">      <span class="keyword">goto</span> <span class="number">0x401191</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在意义不改变的基础上再次优化：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i != <span class="number">6</span>; i++) &#123;<span class="comment">// %esi</span></span><br><span class="line">  num = nums[i];<span class="comment">// (%rsp + i)-&gt;%ecx</span></span><br><span class="line">  p = <span class="number">0x6032d0</span>;<span class="comment">// 0x6032d0-&gt;%edx</span></span><br><span class="line">  <span class="keyword">if</span> (num &gt; <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">1</span>; j != num; j++)<span class="comment">// %eax</span></span><br><span class="line">      p = *(++p);<span class="comment">// (%rdx + 8)-&gt;%rdx</span></span><br><span class="line">  &#125;</span><br><span class="line">  new_nums[i] = p;<span class="comment">// %rdx-&gt;(%rsp + 8i + 32)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看出，此处再次生成了一个新的<strong>地址</strong>数组<code>new_nums[6]</code>（存放的是链表各个结点的<strong>地址</strong>，新数组起始地址是<code>%rsp+32</code>，依次加8），它是以<code>nums[6]</code>数组（上面重写后的）为索引，将（以<code>0x6032d0</code>为头指针的）<strong>链表</strong>的第<code>nums[i]</code>个数的<strong>地址</strong>赋给<code>new_nums[i]</code>。构造这个地址数组的目的就是排序。</p>
<p>由于输入的6个数是1～6的全排列，<code>7-i</code>后依然是1～6的全排列，所以新生成的数组的6个元素可以通过<code>0x6032d0+i</code>（i=1,2,3,4,5,6）来获得（顺序未知），直接<code>gdb</code>：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/24 0x6032d0</span><br></pre></td></tr></table></figure>
<p>得到输出如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">0x6032d0 &lt;node1&gt;:       332     1       6304480 0</span><br><span class="line">0x6032e0 &lt;node2&gt;:       168     2       6304496 0</span><br><span class="line">0x6032f0 &lt;node3&gt;:       924     3       6304512 0</span><br><span class="line">0x603300 &lt;node4&gt;:       691     4       6304528 0</span><br><span class="line">0x603310 &lt;node5&gt;:       477     5       6304544 0</span><br><span class="line">0x603320 &lt;node6&gt;:       443     6       0       0</span><br></pre></td></tr></table></figure>
<p>左侧为链表6个结点的地址（新数组中的元素），右侧第1列则是6个结点的数据域，第3列是6个结点的指针域（十进制）</p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">4011ab:	48 8b 5c 24 20       	mov    0x20(%rsp),%rbx</span><br><span class="line">4011b0:	48 8d 44 24 28       	lea    0x28(%rsp),%rax</span><br><span class="line">4011b5:	48 8d 74 24 50       	lea    0x50(%rsp),%rsi</span><br><span class="line">4011ba:	48 89 d9             	mov    %rbx,%rcx</span><br><span class="line">4011bd:	48 8b 10             	mov    (%rax),%rdx</span><br><span class="line">4011c0:	48 89 51 08          	mov    %rdx,0x8(%rcx)</span><br><span class="line">4011c4:	48 83 c0 08          	add    $0x8,%rax</span><br><span class="line">4011c8:	48 39 f0             	cmp    %rsi,%rax</span><br><span class="line">4011cb:	74 05                	je     4011d2 &lt;phase_6+0xde&gt;</span><br><span class="line">4011cd:	48 89 d1             	mov    %rdx,%rcx</span><br><span class="line">4011d0:	eb eb                	jmp    4011bd &lt;phase_6+0xc9&gt;</span><br><span class="line">4011d2:	48 c7 42 08 00 00 00 	movq   $0x0,0x8(%rdx)</span><br><span class="line">4011d9:	00 </span><br></pre></td></tr></table></figure>
<p>上一部分的循环跳出之后即执行4011ab将<code>%rsp+32</code>指向的值（<code>new_nums[0]</code>）赋给<code>%rbx</code>，4011b0将<code>%rsp+40</code>的地址（新数组第2个元素的地址）赋给<code>%rax</code>（索引），4011b5将<code>%rsp+80</code>的地址（新数组末尾的地址）赋给<code>%rsi</code>，4011ba将<code>%rbx</code>（新数组第1个元素）赋给<code>%rcx</code>，4011bd将<code>%rax</code>指向的值（新数组第<code>%rax</code>个元素）赋给<code>%rdx</code>，4011c0将<code>%rdx</code>（新数组第<code>%rax</code>个元素）赋给<code>%rcx+8</code>指向的值，4011c4将<code>%rax</code>加8，即移动到下一个元素的地址，4011c8和4011cb比较<code>%rax</code>和<code>%rsi</code>：</p>
<ul>
<li>若不等则继续执行4011cd将<code>%rdx</code>赋给<code>%rcx</code>，4011d0跳到4011bd（4010f4+0xc9）循环；</li>
<li>若相等则跳到4011d2（4010f4+0xde）将<code>%rdx+8</code>指向的值赋为0</li>
</ul>
<p>可以看出此处的循环等价于：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">num_begin = *p_new_nums;<span class="comment">// (%rsp + 32)=new_nums[0]-&gt;%rbx</span></span><br><span class="line">p_next = p_new_nums + <span class="number">1</span>;<span class="comment">// %rsp + 40=&amp;new_nums[1]-&gt;%rax</span></span><br><span class="line">p_end = p_new_nums + <span class="number">6</span>;<span class="comment">// %rsp + 80-&gt;%rsi</span></span><br><span class="line"><span class="keyword">for</span> (num = num_begin; p_next != p_end; num = num_next) &#123;<span class="comment">// %rbx-&gt;%rcx; %rax != %rsi; %rdx-&gt;%rcx</span></span><br><span class="line">  num_next = *p_next;<span class="comment">// (%rax)-&gt;%rdx</span></span><br><span class="line">  *(num + <span class="number">1</span>) = num_next;<span class="comment">// %rdx-&gt;(%rcx + 8)</span></span><br><span class="line">  p_next++;<span class="comment">// %rax += 8</span></span><br><span class="line">&#125;</span><br><span class="line">*(num_next + <span class="number">1</span>) = <span class="number">0</span>;<span class="comment">// 0-&gt;(%rdx + 8)</span></span><br></pre></td></tr></table></figure>
<p>可以看出，此处的循环是为新数组<code>new_nums[6]</code>的各个元素添加了指针域，即第<code>i</code>个元素（i=0,1,2,3,4）的指针域用<code>*(new_nums[i] + 1)</code>表示，指向第<code>i+1</code>个元素<code>new_nums[i+1]</code>，第<code>5</code>个元素（第6个地址）的指针域赋为0。这样做的好处是可以直接用元素的值表示下一个元素的值，便于重复赋值。</p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">4011da:	bd 05 00 00 00       	mov    $0x5,%ebp</span><br><span class="line">4011df:	48 8b 43 08          	mov    0x8(%rbx),%rax</span><br><span class="line">4011e3:	8b 00                	mov    (%rax),%eax</span><br><span class="line">4011e5:	39 03                	cmp    %eax,(%rbx)</span><br><span class="line">4011e7:	7d 05                	jge    4011ee &lt;phase_6+0xfa&gt;</span><br><span class="line">4011e9:	e8 4c 02 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">4011ee:	48 8b 5b 08          	mov    0x8(%rbx),%rbx</span><br><span class="line">4011f2:	83 ed 01             	sub    $0x1,%ebp</span><br><span class="line">4011f5:	75 e8                	jne    4011df &lt;phase_6+0xeb&gt;</span><br><span class="line">4011f7:	48 83 c4 50          	add    $0x50,%rsp</span><br><span class="line">4011fb:	5b                   	pop    %rbx</span><br><span class="line">4011fc:	5d                   	pop    %rbp</span><br><span class="line">4011fd:	41 5c                	pop    %r12</span><br><span class="line">4011ff:	41 5d                	pop    %r13</span><br><span class="line">401201:	41 5e                	pop    %r14</span><br><span class="line">401203:	c3                   	retq  </span><br></pre></td></tr></table></figure>
<p>上一部分加完指针域后继续执行4011da将<code>%ebp</code>（索引）赋为5，4011df将<code>%rbx+8</code>指向的值（开始时<code>%rbx</code>是<code>new_nums[0]</code>，此时<code>%rbx+8</code>即为新数组第<code>0</code>个元素的指针域，指向的值就是下一个元素）赋给<code>%rax</code>（即当前元素的下一个元素），4011e3将<code>%rax</code>指向的值（新数组下一个元素作为地址指向的值）赋给<code>%eax</code>，4011e5和4011e7将<code>%eax</code>和<code>%rbx</code>指向的值（新数组当前元素作为地址指向的值）比较：</p>
<ul>
<li>若<code>%rbx</code>指向的值（当前元素指向值）小于<code>%eax</code>（下一元素指向值），则继续执行4011e9使炸弹爆炸（由此得知<strong>当前元素指向值必须大于等于下一元素指向值</strong>）；</li>
<li>若<code>%rbx</code>指向的值（当前元素指向值）不小于<code>%eax</code>（下一元素指向值），则跳到4011ee（4010f4+0xfa）将<code>%rbx+8</code>指向的值（下一个元素）赋给<code>%rbx</code>（好处体现），4011f2将<code>%ebp</code>（索引）减1，4011f5判断减1后是否为0:<ul>
<li>若不为0则跳到4011df（4010f4+0xeb）循环；</li>
<li>若为0则继续执行并弹栈<strong>返回</strong></li>
</ul>
</li>
</ul>
<p>可以看出此处的循环等价于：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (i = <span class="number">5</span>; i != <span class="number">0</span>; i--) &#123;<span class="comment">// %ebp</span></span><br><span class="line">  num_next = *(num + <span class="number">1</span>);<span class="comment">// (%rbx + 8)-&gt;%rax</span></span><br><span class="line">  number_next = *num_next;<span class="comment">// (%rax)-&gt;%eax</span></span><br><span class="line">  <span class="keyword">if</span> (*num &lt; number_next)<span class="comment">// (%rbx) &lt; %eax</span></span><br><span class="line">    explode_bomb();</span><br><span class="line">  num = *(num + <span class="number">1</span>);<span class="comment">// (%rbx + 8)-&gt;%rbx</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> num_next;<span class="comment">// %rax</span></span><br></pre></td></tr></table></figure>
<p>可以看出，需要满足<code>*num &gt;= **(num+1)</code>即对于新数组存放的6个地址值，它们对应指向的数据应该按顺序递减。</p>
<hr>
<p>整理一下，我们需要输入6个整数，是1～6的排列，每个数再对7求补，得到新的序列。新的序列一一对应了一个链表的6个结点，即：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1:       332</span><br><span class="line">2:       168</span><br><span class="line">3:       924</span><br><span class="line">4:       691</span><br><span class="line">5:       477</span><br><span class="line">6:       443</span><br></pre></td></tr></table></figure>
<p>而这6个结点的数据域（上面右侧一列）需要递减排列：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">3:       924</span><br><span class="line">4:       691</span><br><span class="line">5:       477</span><br><span class="line">6:       443</span><br><span class="line">1:       332</span><br><span class="line">2:       168</span><br></pre></td></tr></table></figure>
<p>此时便得到了新的序列为<code>3</code>，<code>4</code>，<code>5</code>，<code>6</code>，<code>1</code>，<code>2</code>。</p>
<p>输入序列为新的序列关于7的补，即为<code>4</code>，<code>3</code>，<code>2</code>，<code>1</code>，<code>6</code>，<code>5</code>。</p>
<p>至此，得到<code>phase_6</code>的password为</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4 3 2 1 6 5</span><br></pre></td></tr></table></figure>
<h1 id="Secret-phase-binary-search-tree"><a href="#Secret-phase-binary-search-tree" class="headerlink" title="Secret phase: binary search tree"></a>Secret phase: <em>binary search tree</em></h1><p>虽然已经解决了6个phase，但在<code>bomb.c</code>的最后却有这样一句话：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Wow, they got it!  But isn&#x27;t something... missing?  Perhaps</span></span><br><span class="line"><span class="comment"> * something they overlooked?  Mua ha ha ha ha! */</span></span><br></pre></td></tr></table></figure>
<p>行百里者，半于九十。游戏尚未结束。</p>
<hr>
<p>在<code>objdump</code>反汇编生成的文件中可以看到，6个<code>phase</code>函数的后面存在<code>secret_phase</code>函数，此函数应该是拆除隐藏<code>phase</code>的线索。</p>
<p>但是当6个<code>phase</code>的password输入完成后，程序自动终止。如何进入此<code>secret_phase</code>呢？</p>
<p>可以在<code>objdump</code>反汇编生成的文件中查找<code>secret_phase</code>，看看在哪里调用了此函数，沿此线索可能找到入口。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">00000000004015c4 &lt;phase_defused&gt;:</span><br><span class="line">	...</span><br><span class="line">  401630:	e8 0d fc ff ff       	callq  401242 &lt;secret_phase&gt;</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure>
<p>不出所料，在<code>phase_defused</code>函数的401630处调用了<code>secret_phase</code>函数，而根据本文开头对<code>main</code>函数的分析可知在每个<code>phase</code>通过后都会运行<code>phase_defused</code>函数。</p>
<p>下面开始分析<code>phase_defused</code>函数，它很可能就是开启<code>secret_phase</code>大门的<strong>入口</strong>。</p>
<h2 id="Enter"><a href="#Enter" class="headerlink" title="Enter"></a>Enter</h2><p><code>phase_defused</code>对应的汇编语句如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">00000000004015c4 &lt;phase_defused&gt;:</span><br><span class="line">  4015c4:	48 83 ec 78          	sub    $0x78,%rsp</span><br><span class="line">  4015c8:	64 48 8b 04 25 28 00 	mov    %fs:0x28,%rax</span><br><span class="line">  4015cf:	00 00 </span><br><span class="line">  4015d1:	48 89 44 24 68       	mov    %rax,0x68(%rsp)</span><br><span class="line">  4015d6:	31 c0                	xor    %eax,%eax</span><br><span class="line">  4015d8:	83 3d 81 21 20 00 06 	cmpl   $0x6,0x202181(%rip)        # 603760 &lt;num_input_strings&gt;</span><br><span class="line">  4015df:	75 5e                	jne    40163f &lt;phase_defused+0x7b&gt;</span><br><span class="line">  4015e1:	4c 8d 44 24 10       	lea    0x10(%rsp),%r8</span><br><span class="line">  4015e6:	48 8d 4c 24 0c       	lea    0xc(%rsp),%rcx</span><br><span class="line">  4015eb:	48 8d 54 24 08       	lea    0x8(%rsp),%rdx</span><br><span class="line">  4015f0:	be 19 26 40 00       	mov    $0x402619,%esi</span><br><span class="line">  4015f5:	bf 70 38 60 00       	mov    $0x603870,%edi</span><br><span class="line">  4015fa:	e8 f1 f5 ff ff       	callq  400bf0 &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line">  4015ff:	83 f8 03             	cmp    $0x3,%eax</span><br><span class="line">  401602:	75 31                	jne    401635 &lt;phase_defused+0x71&gt;</span><br><span class="line">  401604:	be 22 26 40 00       	mov    $0x402622,%esi</span><br><span class="line">  401609:	48 8d 7c 24 10       	lea    0x10(%rsp),%rdi</span><br><span class="line">  40160e:	e8 25 fd ff ff       	callq  401338 &lt;strings_not_equal&gt;</span><br><span class="line">  401613:	85 c0                	test   %eax,%eax</span><br><span class="line">  401615:	75 1e                	jne    401635 &lt;phase_defused+0x71&gt;</span><br><span class="line">  401617:	bf f8 24 40 00       	mov    $0x4024f8,%edi</span><br><span class="line">  40161c:	e8 ef f4 ff ff       	callq  400b10 &lt;puts@plt&gt;</span><br><span class="line">  401621:	bf 20 25 40 00       	mov    $0x402520,%edi</span><br><span class="line">  401626:	e8 e5 f4 ff ff       	callq  400b10 &lt;puts@plt&gt;</span><br><span class="line">  40162b:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  401630:	e8 0d fc ff ff       	callq  401242 &lt;secret_phase&gt;</span><br><span class="line">  401635:	bf 58 25 40 00       	mov    $0x402558,%edi</span><br><span class="line">  40163a:	e8 d1 f4 ff ff       	callq  400b10 &lt;puts@plt&gt;</span><br><span class="line">  40163f:	48 8b 44 24 68       	mov    0x68(%rsp),%rax</span><br><span class="line">  401644:	64 48 33 04 25 28 00 	xor    %fs:0x28,%rax</span><br><span class="line">  40164b:	00 00 </span><br><span class="line">  40164d:	74 05                	je     401654 &lt;phase_defused+0x90&gt;</span><br><span class="line">  40164f:	e8 dc f4 ff ff       	callq  400b30 &lt;__stack_chk_fail@plt&gt;</span><br><span class="line">  401654:	48 83 c4 78          	add    $0x78,%rsp</span><br><span class="line">  401658:	c3                   	retq   </span><br><span class="line">  401659:	90                   	nop</span><br><span class="line">  40165a:	90                   	nop</span><br><span class="line">  40165b:	90                   	nop</span><br><span class="line">  40165c:	90                   	nop</span><br><span class="line">  40165d:	90                   	nop</span><br><span class="line">  40165e:	90                   	nop</span><br><span class="line">  40165f:	90                   	nop</span><br></pre></td></tr></table></figure>
<hr>
<p>分段分析：</p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> 4015c4:	48 83 ec 78          	sub    $0x78,%rsp</span><br><span class="line"> 4015c8:	64 48 8b 04 25 28 00 	mov    %fs:0x28,%rax</span><br><span class="line"> 4015cf:	00 00 </span><br><span class="line"> 4015d1:	48 89 44 24 68       	mov    %rax,0x68(%rsp)</span><br><span class="line"> 4015d6:	31 c0                	xor    %eax,%eax</span><br><span class="line"> 4015d8:	83 3d 81 21 20 00 06 	cmpl   $0x6,0x202181(%rip)        # 603760 &lt;num_input_strings&gt;</span><br><span class="line"> 4015df:	75 5e                	jne    40163f &lt;phase_defused+0x7b&gt;</span><br><span class="line"> ...</span><br><span class="line"> 40163f:	48 8b 44 24 68       	mov    0x68(%rsp),%rax</span><br><span class="line"> 401644:	64 48 33 04 25 28 00 	xor    %fs:0x28,%rax</span><br><span class="line"> 40164b:	00 00 </span><br><span class="line"> 40164d:	74 05                	je     401654 &lt;phase_defused+0x90&gt;</span><br><span class="line"> 40164f:	e8 dc f4 ff ff       	callq  400b30 &lt;__stack_chk_fail@plt&gt;</span><br><span class="line"> 401654:	48 83 c4 78          	add    $0x78,%rsp</span><br><span class="line"> 401658:	c3                   	retq </span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>4015c4～4015d1和40163f～401658的含义参见<a href="#stackCanacy"><code>phase_5</code>起始部分</a>。</p>
<p>4015d6将<code>%eax</code>赋为0，4015d8和4015df判断<code>%rip+0x202181</code>指向的值是否为6:</p>
<ul>
<li>若不为6则跳到40163f（4015c4+0x7b）继续执行并<strong>返回</strong>；</li>
<li>若为6则继续执行</li>
</ul>
<p>可以看出，只有当<code>%rip+0x202181</code>指向的值为6时才会继续执行。</p>
<p>结合4015d8右侧的注释可以发现，<code>%rip+0x202181</code>的地址为<code>0x603760</code>，再次<code>gdb</code>：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/d 0x603760</span><br></pre></td></tr></table></figure>
<p>得到输出如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x603760 &lt;num_input_strings&gt;:   0</span><br></pre></td></tr></table></figure>
<p>发现<code>0x603760</code>指向的值为0，而结合<code>&lt;num_input_strings&gt;</code>名称可以<strong>推测</strong>此地址指向的值是一个<strong>计数器</strong>，用于记录我们通过了几个<code>phase</code>。</p>
<p>下面进行验证，利用<code>gdb</code>打断点，查看每次通过<code>phase</code>后<code>0x603760</code>指向的值的变化（输入和输出一同列出，省略了文件路径）：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/d 0x603760</span><br><span class="line">0x603760 &lt;num_input_strings&gt;:   0</span><br><span class="line">(gdb) b explode_bomb</span><br><span class="line">Breakpoint 1 at 0x40143a</span><br><span class="line">(gdb) b phase_1</span><br><span class="line">Breakpoint 2 at 0x400ee0</span><br><span class="line">(gdb) b phase_2</span><br><span class="line">Breakpoint 3 at 0x400efc</span><br><span class="line">(gdb) b phase_3</span><br><span class="line">Breakpoint 4 at 0x400f43</span><br><span class="line">(gdb) b phase_4</span><br><span class="line">Breakpoint 5 at 0x40100c</span><br><span class="line">(gdb) b phase_5</span><br><span class="line">Breakpoint 6 at 0x401062</span><br><span class="line">(gdb) b phase_6</span><br><span class="line">Breakpoint 7 at 0x4010f4</span><br><span class="line">(gdb) r</span><br><span class="line">Starting program: /.../bomb </span><br><span class="line">Welcome to my fiendish little bomb. You have 6 phases with</span><br><span class="line">which to blow yourself up. Have a nice day!</span><br><span class="line">Border relations with Canada have never been better.</span><br><span class="line"></span><br><span class="line">Breakpoint 1, 0x0000000000400ee0 in phase_1 ()</span><br><span class="line">(gdb) x/d 0x603760</span><br><span class="line">0x603760 &lt;num_input_strings&gt;:   1</span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line">Phase 1 defused. How about the next one?</span><br><span class="line">1 2 4 8 16 32</span><br><span class="line"></span><br><span class="line">Breakpoint 2, 0x0000000000400efc in phase_2 ()</span><br><span class="line">(gdb) x/d 0x603760</span><br><span class="line">0x603760 &lt;num_input_strings&gt;:   2</span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line">That&#x27;s number 2.  Keep going!</span><br><span class="line">0 207</span><br><span class="line"></span><br><span class="line">Breakpoint 3, 0x0000000000400f43 in phase_3 ()</span><br><span class="line">(gdb) x/d 0x603760</span><br><span class="line">0x603760 &lt;num_input_strings&gt;:   3</span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line">Halfway there!</span><br><span class="line">0 0</span><br><span class="line"></span><br><span class="line">Breakpoint 4, 0x000000000040100c in phase_4 ()</span><br><span class="line">(gdb) x/d 0x603760</span><br><span class="line">0x603760 &lt;num_input_strings&gt;:   4</span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line">So you got that one.  Try this one.</span><br><span class="line">9/N567</span><br><span class="line"></span><br><span class="line">Breakpoint 5, 0x0000000000401062 in phase_5 ()</span><br><span class="line">(gdb) x/d 0x603760</span><br><span class="line">0x603760 &lt;num_input_strings&gt;:   5</span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line">Good work!  On to the next...</span><br><span class="line">4 3 2 1 6 5</span><br><span class="line"></span><br><span class="line">Breakpoint 6, 0x00000000004010f4 in phase_6 ()</span><br><span class="line">(gdb) x/d 0x603760</span><br><span class="line">0x603760 &lt;num_input_strings&gt;:   6</span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line">Congratulations! You&#x27;ve defused the bomb!</span><br><span class="line">[Inferior 1 (process 8462) exited normally]</span><br></pre></td></tr></table></figure>
<p>可以发现，每次成功通过一个<code>phase</code>后，<code>0x603760</code>指向的值都会加1。而此处判断当<code>0x603760</code>指向的值为6时才会进行，即只有成功通过6个<code>phase</code>后，<code>phase_defused</code>函数才会继续执行4015e1及后续部分</p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">4015e1:	4c 8d 44 24 10       	lea    0x10(%rsp),%r8</span><br><span class="line">4015e6:	48 8d 4c 24 0c       	lea    0xc(%rsp),%rcx</span><br><span class="line">4015eb:	48 8d 54 24 08       	lea    0x8(%rsp),%rdx</span><br><span class="line">4015f0:	be 19 26 40 00       	mov    $0x402619,%esi</span><br><span class="line">4015f5:	bf 70 38 60 00       	mov    $0x603870,%edi</span><br><span class="line">4015fa:	e8 f1 f5 ff ff       	callq  400bf0 &lt;__isoc99_sscanf@plt&gt;</span><br></pre></td></tr></table></figure>
<p><code>0x603760</code>指向的值为6时，继续执行4015e1将<code>%rsp+16</code>的地址给<code>%r8</code>，4015e6将<code>%rsp+12</code>的地址给<code>%rcx</code>，4015eb将<code>%rsp+8</code>的地址给<code>%rdx</code>，4015f0将地址<code>0x402619</code>给<code>%esi</code>，4015f5将地址<code>0x603870</code>给<code>%edi</code>，4015fa又调用了<code>sscanf</code>函数，<strong>推测</strong>地址<code>0x402619</code>指向的可能是一个格式化字符串，<code>gdb</code>：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/s 0x402619</span><br></pre></td></tr></table></figure>
<p>得到输出如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x402619:       &quot;%d %d %s&quot;</span><br></pre></td></tr></table></figure>
<p>不出所料，我们应该在某处输入两个整数（存放于<code>%rsp+8</code>和<code>%rsp+12</code>中），再输入一个字符串（存放于<code>%rsp+16</code>中）。</p>
<p>回忆6个<code>phase</code>，发现没有一个<code>phase</code>的密码符合这种格式，但是<code>phase_3</code>和<code>phase_4</code>的密码均为两个整数。<strong>推测</strong>可能在<code>phase_3</code>或<code>phase_4</code>输入两个整数后，再输入一个字符串，可能就会开启<code>secret_phase</code>。</p>
<p>注意此时还有一个地址<code>0x603870</code>被传给了<code>%edi</code>，<strong>推测</strong>可能指向一个字符串用于和输入的字符串进行比对。</p>
<p>直接<code>gdb</code>查看<code>0x603870</code>指向的值：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/s 0x603870</span><br></pre></td></tr></table></figure>
<p>得到输出如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x603870 &lt;input_strings+240&gt;:   &quot;&quot;</span><br></pre></td></tr></table></figure>
<p>发现是空字符串，说明推测错误。再次推测，<code>0x603870</code>指向的值不可能一直是空字符串，<strong>推测</strong>它可能会随着我们输入密码而发生变化。使用<code>gdb</code>，并在<code>phase_defused</code>入口处打一个断点（输入和输出一同列出，省略了文件路径）：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">(gdb) b phase_defused</span><br><span class="line">Breakpoint 8 at 0x4015c4</span><br><span class="line">(gdb) r</span><br><span class="line">Starting program: /.../bomb </span><br><span class="line">Welcome to my fiendish little bomb. You have 6 phases with</span><br><span class="line">which to blow yourself up. Have a nice day!</span><br><span class="line">Border relations with Canada have never been better.</span><br><span class="line"></span><br><span class="line">Breakpoint 1, 0x0000000000400ee0 in phase_1 ()</span><br><span class="line">(gdb) x/s 0x603870</span><br><span class="line">0x603870 &lt;input_strings+240&gt;:   &quot;&quot;</span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line"></span><br><span class="line">Breakpoint 8, 0x00000000004015c4 in phase_defused ()</span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line">Phase 1 defused. How about the next one?</span><br><span class="line">1 2 4 8 16 32</span><br><span class="line"></span><br><span class="line">Breakpoint 2, 0x0000000000400efc in phase_2 ()</span><br><span class="line">(gdb) x/s 0x603870</span><br><span class="line">0x603870 &lt;input_strings+240&gt;:   &quot;&quot;</span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line"></span><br><span class="line">Breakpoint 8, 0x00000000004015c4 in phase_defused ()</span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line">That&#x27;s number 2.  Keep going!</span><br><span class="line">0 207</span><br><span class="line"></span><br><span class="line">Breakpoint 3, 0x0000000000400f43 in phase_3 ()</span><br><span class="line">(gdb) x/s 0x603870</span><br><span class="line">0x603870 &lt;input_strings+240&gt;:   &quot;&quot;</span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line"></span><br><span class="line">Breakpoint 8, 0x00000000004015c4 in phase_defused ()</span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line">Halfway there!</span><br><span class="line">0 0</span><br><span class="line"></span><br><span class="line">Breakpoint 4, 0x000000000040100c in phase_4 ()</span><br><span class="line">(gdb) x/s 0x603870</span><br><span class="line">0x603870 &lt;input_strings+240&gt;:   &quot;0 0&quot;</span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line"></span><br><span class="line">Breakpoint 8, 0x00000000004015c4 in phase_defused ()</span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line">So you got that one.  Try this one.</span><br><span class="line">9/N567</span><br><span class="line"></span><br><span class="line">Breakpoint 5, 0x0000000000401062 in phase_5 ()</span><br><span class="line">(gdb) x/s 0x603870</span><br><span class="line">0x603870 &lt;input_strings+240&gt;:   &quot;0 0&quot;</span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line"></span><br><span class="line">Breakpoint 8, 0x00000000004015c4 in phase_defused ()</span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line">Good work!  On to the next...</span><br><span class="line">4 3 2 1 6 5</span><br><span class="line"></span><br><span class="line">Breakpoint 6, 0x00000000004010f4 in phase_6 ()</span><br><span class="line">(gdb) x/s 0x603870</span><br><span class="line">0x603870 &lt;input_strings+240&gt;:   &quot;0 0&quot;</span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line"></span><br><span class="line">Breakpoint 8, 0x00000000004015c4 in phase_defused ()</span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line">Congratulations! You&#x27;ve defused the bomb!</span><br><span class="line">[Inferior 1 (process 13412) exited normally]</span><br></pre></td></tr></table></figure>
<p>可以发现，在通过<code>phase_4</code>后，<code>0x603870</code>指向的值发生了变化——变成了我们输入的<code>&quot;0 0&quot;</code>（不应认为此时<code>0x603870</code>指向的值就是<code>&quot;0 0&quot;</code>，而是会因我们输入的<code>phase_4</code>密码的不同而不同，此处可以自行验证当输入不同的的<code>phase_4</code>密码时<code>0x603870</code>指向的值，同时也可以理解<code>phase_4</code>密码存在多种可能性的原因）</p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">4015ff:	83 f8 03             	cmp    $0x3,%eax</span><br><span class="line">401602:	75 31                	jne    401635 &lt;phase_defused+0x71&gt;</span><br><span class="line">...</span><br><span class="line">401630:	e8 0d fc ff ff       	callq  401242 &lt;secret_phase&gt;</span><br><span class="line">401635:	bf 58 25 40 00       	mov    $0x402558,%edi</span><br></pre></td></tr></table></figure>
<p>继续执行4015ff和401602判断<code>%eax</code>（<code>sscanf</code>函数的返回值）是否为3：</p>
<ul>
<li>若为3则继续执行；</li>
<li>若不为3则跳到401635（4015c4+0x71）继续执行输出提示信息</li>
</ul>
<p>结合后续语句可以看出，<code>secret_phase</code>在401630处被调用，若跳到401635则跳过了<code>secret_phase</code>的调用，且不会再跳回来。即要想进入<code>secret_phase</code>，则<code>sscanf</code>函数的返回值必须为3，也就是说<code>0x603870</code>指向的值（<strong>输入的<code>phase_4</code>的密码</strong>）<strong>除了两个整数，必须还要有一个字符串</strong></p>
<p>这个额外输入的字符串是什么？继续分析～</p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">401604:	be 22 26 40 00       	mov    $0x402622,%esi</span><br><span class="line">401609:	48 8d 7c 24 10       	lea    0x10(%rsp),%rdi</span><br><span class="line">40160e:	e8 25 fd ff ff       	callq  401338 &lt;strings_not_equal&gt;</span><br><span class="line">401613:	85 c0                	test   %eax,%eax</span><br><span class="line">401615:	75 1e                	jne    401635 &lt;phase_defused+0x71&gt;</span><br><span class="line">...</span><br><span class="line">401630:	e8 0d fc ff ff       	callq  401242 &lt;secret_phase&gt;</span><br><span class="line">401635:	bf 58 25 40 00       	mov    $0x402558,%edi</span><br></pre></td></tr></table></figure>
<p>401604将地址<code>0x402622</code>给<code>%esi</code>，401609把<code>%rsp+16</code>的地址（指向在两个整数后输入的字符串）给<code>%rdi</code>，40160e调用<code>strings_not_equal</code>函数判断两个字符串是否相等（相等返回0，不等返回1），401613和401615判断<code>%eax</code>（<code>strings_not_equal</code>函数的返回值）是否为0：</p>
<ul>
<li>若为0则继续执行；</li>
<li>若不为0则跳到401635（4015c4+0x71）继续执行输出提示信息</li>
</ul>
<p>和上述分析相同，地址<code>0x402622</code>指向的应该是一个字符串，且要想进入<code>secret_phase</code>，在两个整数后输入的字符串必须和此字符串相等。利用<code>gdb</code>查看地址<code>0x402622</code>：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/s 0x402622</span><br></pre></td></tr></table></figure>
<p> 得到输出如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x402622:       &quot;DrEvil&quot;</span><br></pre></td></tr></table></figure>
<p>即<code>bomb.c</code>文件开头注释部分提到的“犯罪者”的名字</p>
<p>至此，我们已经找到了开启<code>secret_phase</code>大门的入口——**在<code>phase_4</code>输入密码时额外输入字符串<code>&quot;DrEvil&quot;</code>**。</p>
<h2 id="Defuse"><a href="#Defuse" class="headerlink" title="Defuse"></a>Defuse</h2><p><code>secret_phase</code>对应的汇编语句如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">0000000000401242 &lt;secret_phase&gt;:</span><br><span class="line">  401242:	53                   	push   %rbx</span><br><span class="line">  401243:	e8 56 02 00 00       	callq  40149e &lt;read_line&gt;</span><br><span class="line">  401248:	ba 0a 00 00 00       	mov    $0xa,%edx</span><br><span class="line">  40124d:	be 00 00 00 00       	mov    $0x0,%esi</span><br><span class="line">  401252:	48 89 c7             	mov    %rax,%rdi</span><br><span class="line">  401255:	e8 76 f9 ff ff       	callq  400bd0 &lt;strtol@plt&gt;</span><br><span class="line">  40125a:	48 89 c3             	mov    %rax,%rbx</span><br><span class="line">  40125d:	8d 40 ff             	lea    -0x1(%rax),%eax</span><br><span class="line">  401260:	3d e8 03 00 00       	cmp    $0x3e8,%eax</span><br><span class="line">  401265:	76 05                	jbe    40126c &lt;secret_phase+0x2a&gt;</span><br><span class="line">  401267:	e8 ce 01 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  40126c:	89 de                	mov    %ebx,%esi</span><br><span class="line">  40126e:	bf f0 30 60 00       	mov    $0x6030f0,%edi</span><br><span class="line">  401273:	e8 8c ff ff ff       	callq  401204 &lt;fun7&gt;</span><br><span class="line">  401278:	83 f8 02             	cmp    $0x2,%eax</span><br><span class="line">  40127b:	74 05                	je     401282 &lt;secret_phase+0x40&gt;</span><br><span class="line">  40127d:	e8 b8 01 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  401282:	bf 38 24 40 00       	mov    $0x402438,%edi</span><br><span class="line">  401287:	e8 84 f8 ff ff       	callq  400b10 &lt;puts@plt&gt;</span><br><span class="line">  40128c:	e8 33 03 00 00       	callq  4015c4 &lt;phase_defused&gt;</span><br><span class="line">  401291:	5b                   	pop    %rbx</span><br><span class="line">  401292:	c3                   	retq   </span><br><span class="line">  401293:	90                   	nop</span><br><span class="line">  401294:	90                   	nop</span><br><span class="line">  401295:	90                   	nop</span><br><span class="line">  401296:	90                   	nop</span><br><span class="line">  401297:	90                   	nop</span><br><span class="line">  401298:	90                   	nop</span><br><span class="line">  401299:	90                   	nop</span><br><span class="line">  40129a:	90                   	nop</span><br><span class="line">  40129b:	90                   	nop</span><br><span class="line">  40129c:	90                   	nop</span><br><span class="line">  40129d:	90                   	nop</span><br><span class="line">  40129e:	90                   	nop</span><br><span class="line">  40129f:	90                   	nop</span><br></pre></td></tr></table></figure>
<hr>
<p>分段分析：</p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">401242:	53                   	push   %rbx</span><br><span class="line">401243:	e8 56 02 00 00       	callq  40149e &lt;read_line&gt;</span><br><span class="line">401248:	ba 0a 00 00 00       	mov    $0xa,%edx</span><br><span class="line">40124d:	be 00 00 00 00       	mov    $0x0,%esi</span><br><span class="line">401252:	48 89 c7             	mov    %rax,%rdi</span><br><span class="line">401255:	e8 76 f9 ff ff       	callq  400bd0 &lt;strtol@plt&gt;</span><br></pre></td></tr></table></figure>
<p>401243调用<code>read_line</code>函数读取一行字符串（返回值存放于<code>%rax</code>），401248将<code>%edx</code>赋为10，40124d将<code>%esi</code>赋为0，401252将<code>%rax</code>（<code>read_line</code>函数返回值）赋给<code>%rdi</code>，401255调用<code>strtol</code>函数（<a target="_blank" rel="noopener" href="http://www.cplusplus.com/reference/cstdlib/strtol/">什么是<code>strtol</code>函数？</a>）。</p>
<p><code>strtol</code>函数将字符串转化为<code>long</code>型整数：<code>%rdi</code>作为传入的第1个参数，作为用来解析的字符串（输入串）；<code>%esi</code>作为传入的第2个参数，作为需要解析部分的结束地址（<code>NULL</code>）；<code>%edx</code>作为整数的进制（<code>10</code>代表十进制）。函数的返回值存放于<code>%rax</code>中</p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">40125a:	48 89 c3             	mov    %rax,%rbx</span><br><span class="line">40125d:	8d 40 ff             	lea    -0x1(%rax),%eax</span><br><span class="line">401260:	3d e8 03 00 00       	cmp    $0x3e8,%eax</span><br><span class="line">401265:	76 05                	jbe    40126c &lt;secret_phase+0x2a&gt;</span><br><span class="line">401267:	e8 ce 01 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">40126c:	89 de                	mov    %ebx,%esi</span><br><span class="line">40126e:	bf f0 30 60 00       	mov    $0x6030f0,%edi</span><br><span class="line">401273:	e8 8c ff ff ff       	callq  401204 &lt;fun7&gt;</span><br></pre></td></tr></table></figure>
<p>40125a将<code>%rax</code>（<code>strtol</code>函数的返回值）赋给<code>%rbx</code>，40125d将<code>%rax-1</code>的地址给<code>%eax</code>，401260和401265判断<code>%eax</code>是否不超过1000：</p>
<ul>
<li><p>若超过1000则继续执行401267使炸弹爆炸（由此得知<strong>应使<code>strtol</code>函数的返回值不超过1001（无符号数）</strong>）；</p>
</li>
<li><p>若不超过1000则跳到40126c（401242+0x2a）将<code>%ebx</code>（<code>strtol</code>函数的返回值）赋给<code>%esi</code>，40126e将地址<code>0x6030f0</code>赋给<code>%edi</code>，401273<span id = "backToSec">调用函数<code>fun7</code></span>，<a href="#fun7">点此分析<code>fun7</code>函数</a></p>
<p><code>gdb</code>查看地址<code>0x6030f0</code>（<code>fun7</code>的第一个参数）（多次查看可知，只有前60个连续内存是相关的，后面均为无关数据）：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/60a 0x6030f0</span><br></pre></td></tr></table></figure>
<p>得到输出如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">0x6030f0 &lt;n1&gt;:  0x24    0x603110 &lt;n21&gt;</span><br><span class="line">0x603100 &lt;n1+16&gt;:       0x603130 &lt;n22&gt;  0x0</span><br><span class="line">0x603110 &lt;n21&gt;: 0x8     0x603190 &lt;n31&gt;</span><br><span class="line">0x603120 &lt;n21+16&gt;:      0x603150 &lt;n32&gt;  0x0</span><br><span class="line">0x603130 &lt;n22&gt;: 0x32    0x603170 &lt;n33&gt;</span><br><span class="line">0x603140 &lt;n22+16&gt;:      0x6031b0 &lt;n34&gt;  0x0</span><br><span class="line">0x603150 &lt;n32&gt;: 0x16    0x603270 &lt;n43&gt;</span><br><span class="line">0x603160 &lt;n32+16&gt;:      0x603230 &lt;n44&gt;  0x0</span><br><span class="line">0x603170 &lt;n33&gt;: 0x2d    0x6031d0 &lt;n45&gt;</span><br><span class="line">0x603180 &lt;n33+16&gt;:      0x603290 &lt;n46&gt;  0x0</span><br><span class="line">0x603190 &lt;n31&gt;: 0x6     0x6031f0 &lt;n41&gt;</span><br><span class="line">0x6031a0 &lt;n31+16&gt;:      0x603250 &lt;n42&gt;  0x0</span><br><span class="line">0x6031b0 &lt;n34&gt;: 0x6b    0x603210 &lt;n47&gt;</span><br><span class="line">0x6031c0 &lt;n34+16&gt;:      0x6032b0 &lt;n48&gt;  0x0</span><br><span class="line">0x6031d0 &lt;n45&gt;: 0x28    0x0</span><br><span class="line">0x6031e0 &lt;n45+16&gt;:      0x0     0x0</span><br><span class="line">0x6031f0 &lt;n41&gt;: 0x1     0x0</span><br><span class="line">0x603200 &lt;n41+16&gt;:      0x0     0x0</span><br><span class="line">0x603210 &lt;n47&gt;: 0x63    0x0</span><br><span class="line">0x603220 &lt;n47+16&gt;:      0x0     0x0</span><br><span class="line">0x603230 &lt;n44&gt;: 0x23    0x0</span><br><span class="line">0x603240 &lt;n44+16&gt;:      0x0     0x0</span><br><span class="line">0x603250 &lt;n42&gt;: 0x7     0x0</span><br><span class="line">0x603260 &lt;n42+16&gt;:      0x0     0x0</span><br><span class="line">0x603270 &lt;n43&gt;: 0x14    0x0</span><br><span class="line">0x603280 &lt;n43+16&gt;:      0x0     0x0</span><br><span class="line">0x603290 &lt;n46&gt;: 0x2f    0x0</span><br><span class="line">0x6032a0 &lt;n46+16&gt;:      0x0     0x0</span><br><span class="line">0x6032b0 &lt;n48&gt;: 0x3e9   0x0</span><br><span class="line">0x6032c0 &lt;n48+16&gt;:      0x0     0x0</span><br></pre></td></tr></table></figure>
<p>可以发现这是一棵二叉树，其中<code>&lt;nab&gt;</code>表示第<code>a</code>层从左向右数的第<code>b</code>个结点，且数值依次为结点数据、左子树地址、右子树地址。画出二叉树（十六进制）：</p>
<p><img src="https://super-bucket1.oss-cn-beijing.aliyuncs.com/hex.jpeg" alt="hex"></p>
<p>转换成十进制：</p>
<p><img src="https://super-bucket1.oss-cn-beijing.aliyuncs.com/dec.jpeg" alt="dec"></p>
<p>即传入<code>fun7</code>函数的第一个参数就是此二叉树根结点的地址。结合<code>fun7</code>函数改写的C语句：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">fun7</span><span class="params">(<span class="keyword">int</span>* p_node, <span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line">  	<span class="keyword">if</span> (p_node == <span class="number">0</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0xffffffff</span>;</span><br><span class="line">    num = *p_node;<span class="comment">// current node</span></span><br><span class="line">    <span class="keyword">if</span> (num &lt;= target) &#123;</span><br><span class="line">      result = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">if</span> (num == target)</span><br><span class="line">        <span class="keyword">return</span> result;<span class="comment">// 0</span></span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">      	p_node = *(p_node + <span class="number">2</span>);<span class="comment">// right child</span></span><br><span class="line">      	result = fun7(p_node, target);</span><br><span class="line">      	<span class="keyword">return</span> result * <span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      p_node = *(p_node + <span class="number">1</span>);<span class="comment">// left child</span></span><br><span class="line">      result = fun7(p_node, target);</span><br><span class="line">    <span class="keyword">return</span> result * <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以发现<code>fun7</code>函数的功能是：</p>
<ul>
<li>若当前结点为空，则返回<code>0xffffffff</code>；</li>
<li>若当前结点数据为<code>target</code>，则返回<code>0</code>；</li>
<li>若当前结点数据小于<code>target</code>，则继续搜索右子树，返回右子树搜索返回值的2倍+1；</li>
<li>若当前结点数据大于<code>target</code>，则继续搜索左子树，返回左子树搜索返回值的2倍</li>
</ul>
</li>
</ul>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">401278:	83 f8 02             	cmp    $0x2,%eax</span><br><span class="line">40127b:	74 05                	je     401282 &lt;secret_phase+0x40&gt;</span><br><span class="line">40127d:	e8 b8 01 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">401282:	bf 38 24 40 00       	mov    $0x402438,%edi</span><br><span class="line">401287:	e8 84 f8 ff ff       	callq  400b10 &lt;puts@plt&gt;</span><br><span class="line">40128c:	e8 33 03 00 00       	callq  4015c4 &lt;phase_defused&gt;</span><br><span class="line">401291:	5b                   	pop    %rbx</span><br><span class="line">401292:	c3                   	retq</span><br></pre></td></tr></table></figure>
<p>401278判断<code>%eax</code>（<code>fun7</code>函数的返回值）是否为2：</p>
<ul>
<li>若不为2则继续执行40127d使炸弹爆炸（由此得知**<code>fun7</code>函数的返回值须为2**）；</li>
<li>若为2则跳到401282（401242+0x40）将地址<code>0x402438</code>赋给<code>%edi</code>，401287调用<code>puts</code>函数，40128c调用<code>phase_defused</code>函数，401291和401292弹栈<strong>返回</strong></li>
</ul>
<p><code>gdb</code>查看地址<code>0x402438</code>指向的值：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/s 0x402438</span><br></pre></td></tr></table></figure>
<p>得到输出如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x402438:       &quot;Wow! You&#x27;ve defused the secret stage!&quot;</span><br></pre></td></tr></table></figure>
<p>可以看出之后调用函数即输出文本，至此拆弹结束。</p>
<hr>
<p>综合以上分析，<code>secret_phase</code>的密码就是<strong>使<code>fun7</code>函数的返回值为2的<code>target</code>值</strong>。</p>
<p>什么时候<code>fun7</code>函数的返回值为2？再次观察二叉树的值：</p>
<p><img src="https://super-bucket1.oss-cn-beijing.aliyuncs.com/dec.jpeg" alt="dec"></p>
<p>发现左子树各结点数值均小于根结点、右子树各结点数值均大于根结点——这是一棵<strong>二叉排序树（Binary Search Tree，BST）</strong>。</p>
<p>观察<code>fun7</code>函数：</p>
<blockquote>
<ul>
<li>若当前结点为空，则返回<code>0xffffffff</code>；</li>
<li>若当前结点数据为<code>target</code>，则返回<code>0</code>；</li>
<li>若当前结点数据小于<code>target</code>，则继续搜索右子树，返回右子树搜索返回值的2倍+1；</li>
<li>若当前结点数据大于<code>target</code>，则继续搜索左子树，返回左子树搜索返回值的2倍。</li>
</ul>
</blockquote>
<p>分析：</p>
<ul>
<li><p>顺推（从根结点开始）：</p>
<p>最终一定找到数值等于<code>target</code>的结点（即<code>target</code>一定在树中）；</p>
</li>
<li><p>逆推（从值为<code>target</code>的结点开始）：</p>
<ul>
<li>开始可以有任意次<code>0</code>，即可以先沿右路（顺推时的左子树）返回任意次（<code>2*0=0</code>）；</li>
<li>倒数第二次一定沿左路（顺推时的右子树）返回（<code>2*(2*0)+1=2*0+1=1</code>）；</li>
<li>最后一次一定沿右路（顺推时的左子树）返回到根结点（<code>2*(2*(2*0)+1)=2*(2*0+1)=2*1=2</code>）。</li>
</ul>
</li>
</ul>
<p>得出结论：</p>
<ul>
<li>若逆推开始沿右路返回0次，则为<code>22</code>；</li>
<li>若逆推开始沿右路返回1次，则为<code>20</code>。</li>
</ul>
<p>至此，得到<code>secret_phase</code>的password为</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">22</span><br></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">20</span><br></pre></td></tr></table></figure>
<h1 id="Functions"><a href="#Functions" class="headerlink" title="Functions"></a>Functions</h1><p>下面是拆弹过程中遇到的一些函数：</p>
<hr>
<h2 id="explode-bomb"><a href="#explode-bomb" class="headerlink" title="explode_bomb"></a>explode_bomb</h2><p><code>explode_bomb</code>函数对应的汇编语句如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">000000000040143a &lt;explode_bomb&gt;:</span><br><span class="line">  40143a:	48 83 ec 08          	sub    $0x8,%rsp</span><br><span class="line">  40143e:	bf a3 25 40 00       	mov    $0x4025a3,%edi</span><br><span class="line">  401443:	e8 c8 f6 ff ff       	callq  400b10 &lt;puts@plt&gt;</span><br><span class="line">  401448:	bf ac 25 40 00       	mov    $0x4025ac,%edi</span><br><span class="line">  40144d:	e8 be f6 ff ff       	callq  400b10 &lt;puts@plt&gt;</span><br><span class="line">  401452:	bf 08 00 00 00       	mov    $0x8,%edi</span><br><span class="line">  401457:	e8 c4 f7 ff ff       	callq  400c20 &lt;exit@plt&gt;</span><br></pre></td></tr></table></figure>
<p><code>gdb</code>查看<code>0x4025a3</code>和<code>0x4025ac</code>指向的值：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/s 0x4025a3</span><br><span class="line">(gdb) x/s 0x4025ac</span><br></pre></td></tr></table></figure>
<p>可以得到输出如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0x4025a3:       &quot;\nBOOM!!!&quot;</span><br><span class="line">0x4025ac:       &quot;The bomb has blown up.&quot;</span><br></pre></td></tr></table></figure>
<p>可以看出<code>explode_bomb</code>函数的功能就是<strong>引爆炸弹</strong>。</p>
<h2 id="strings-not-equal"><a href="#strings-not-equal" class="headerlink" title="strings_not_equal"></a>strings_not_equal</h2><p><span id = "equal"><code>strings_not_equal</code>函数</span>对应的汇编语句如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">0000000000401338 &lt;strings_not_equal&gt;:</span><br><span class="line">  401338:	41 54                	push   %r12</span><br><span class="line">  40133a:	55                   	push   %rbp</span><br><span class="line">  40133b:	53                   	push   %rbx</span><br><span class="line">  40133c:	48 89 fb             	mov    %rdi,%rbx</span><br><span class="line">  40133f:	48 89 f5             	mov    %rsi,%rbp</span><br><span class="line">  401342:	e8 d4 ff ff ff       	callq  40131b &lt;string_length&gt;</span><br><span class="line">  401347:	41 89 c4             	mov    %eax,%r12d</span><br><span class="line">  40134a:	48 89 ef             	mov    %rbp,%rdi</span><br><span class="line">  40134d:	e8 c9 ff ff ff       	callq  40131b &lt;string_length&gt;</span><br><span class="line">  401352:	ba 01 00 00 00       	mov    $0x1,%edx</span><br><span class="line">  401357:	41 39 c4             	cmp    %eax,%r12d</span><br><span class="line">  40135a:	75 3f                	jne    40139b &lt;strings_not_equal+0x63&gt;</span><br><span class="line">  40135c:	0f b6 03             	movzbl (%rbx),%eax</span><br><span class="line">  40135f:	84 c0                	test   %al,%al</span><br><span class="line">  401361:	74 25                	je     401388 &lt;strings_not_equal+0x50&gt;</span><br><span class="line">  401363:	3a 45 00             	cmp    0x0(%rbp),%al</span><br><span class="line">  401366:	74 0a                	je     401372 &lt;strings_not_equal+0x3a&gt;</span><br><span class="line">  401368:	eb 25                	jmp    40138f &lt;strings_not_equal+0x57&gt;</span><br><span class="line">  40136a:	3a 45 00             	cmp    0x0(%rbp),%al</span><br><span class="line">  40136d:	0f 1f 00             	nopl   (%rax)</span><br><span class="line">  401370:	75 24                	jne    401396 &lt;strings_not_equal+0x5e&gt;</span><br><span class="line">  401372:	48 83 c3 01          	add    $0x1,%rbx</span><br><span class="line">  401376:	48 83 c5 01          	add    $0x1,%rbp</span><br><span class="line">  40137a:	0f b6 03             	movzbl (%rbx),%eax</span><br><span class="line">  40137d:	84 c0                	test   %al,%al</span><br><span class="line">  40137f:	75 e9                	jne    40136a &lt;strings_not_equal+0x32&gt;</span><br><span class="line">  401381:	ba 00 00 00 00       	mov    $0x0,%edx</span><br><span class="line">  401386:	eb 13                	jmp    40139b &lt;strings_not_equal+0x63&gt;</span><br><span class="line">  401388:	ba 00 00 00 00       	mov    $0x0,%edx</span><br><span class="line">  40138d:	eb 0c                	jmp    40139b &lt;strings_not_equal+0x63&gt;</span><br><span class="line">  40138f:	ba 01 00 00 00       	mov    $0x1,%edx</span><br><span class="line">  401394:	eb 05                	jmp    40139b &lt;strings_not_equal+0x63&gt;</span><br><span class="line">  401396:	ba 01 00 00 00       	mov    $0x1,%edx</span><br><span class="line">  40139b:	89 d0                	mov    %edx,%eax</span><br><span class="line">  40139d:	5b                   	pop    %rbx</span><br><span class="line">  40139e:	5d                   	pop    %rbp</span><br><span class="line">  40139f:	41 5c                	pop    %r12</span><br><span class="line">  4013a1:	c3                   	retq</span><br></pre></td></tr></table></figure>
<p>分段分析：</p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">401338:	41 54                	push   %r12</span><br><span class="line">40133a:	55                   	push   %rbp</span><br><span class="line">40133b:	53                   	push   %rbx</span><br><span class="line">40133c:	48 89 fb             	mov    %rdi,%rbx</span><br><span class="line">40133f:	48 89 f5             	mov    %rsi,%rbp</span><br></pre></td></tr></table></figure>
<p>40133c和40133f将<code>%rdi</code>和<code>%rsi</code>寄存器的值分别给了<code>%rbx</code>和<code>%rbp</code>（注意<code>%rdi</code>存的是<code>input</code>字符串；<code>%rsi</code>存的是疑似密码的字符串）</p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">401342:	e8 d4 ff ff ff       	callq  40131b &lt;string_length&gt;</span><br></pre></td></tr></table></figure>
<p>401342调用<code>string_length</code>函数，推测可能返回某字符串的长度，<span id = "backToEqual"><a href="#length">点此分析<code>string_length</code>函数</a></span></p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">401347:	41 89 c4             	mov    %eax,%r12d</span><br></pre></td></tr></table></figure>
<p>401347将<code>%eax</code>的值（即<code>string_length</code>函数返回值，<code>input</code>字符串的长度）给<code>%r12d</code></p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">40134a:	48 89 ef             	mov    %rbp,%rdi</span><br></pre></td></tr></table></figure>
<p>40134a将<code>%rbp</code>的值（疑似密码的字符串）给了<code>%rdi</code></p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">40134d:	e8 c9 ff ff ff       	callq  40131b &lt;string_length&gt;</span><br></pre></td></tr></table></figure>
<p>40134d再次调用<code>string_length</code>函数，由于<code>%rdi</code>在上一步被重新赋值为疑似密码的字符串，此处求的就是密码串的长度，存储在<code>%eax</code>中</p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">401352:	ba 01 00 00 00       	mov    $0x1,%edx</span><br></pre></td></tr></table></figure>
<p>401352将<code>%edx</code>的值赋为1</p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">401357:	41 39 c4             	cmp    %eax,%r12d</span><br><span class="line">40135a:	75 3f                	jne    40139b &lt;strings_not_equal+0x63&gt;</span><br><span class="line">...</span><br><span class="line">40139b:	89 d0                	mov    %edx,%eax</span><br></pre></td></tr></table></figure>
<p>401357和40135a比较<code>%eax</code>和<code>%r12d</code>处的值，即密码串和输入串的长度：</p>
<ul>
<li>若二者不相等则跳到40139b（401338+0x63）将<code>%eax</code>的值赋为1（见401352）（可以看出**密码串和输入串的长度不相等时函数返回<code>1</code>**）；</li>
<li>若二者相等则继续执行</li>
</ul>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">40135c:	0f b6 03             	movzbl (%rbx),%eax</span><br></pre></td></tr></table></figure>
<p>40135c将<code>%rbx</code>指向的内容（<code>input</code>字符串第1个字符）传给<code>%eax</code>寄存器（零扩展，见CS:APP中文第三版123页）</p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">40135f:	84 c0                	test   %al,%al</span><br><span class="line">401361:	74 25                	je     401388 &lt;strings_not_equal+0x50&gt;</span><br><span class="line">...</span><br><span class="line">401388:	ba 00 00 00 00       	mov    $0x0,%edx</span><br><span class="line">40138d:	eb 0c                	jmp    40139b &lt;strings_not_equal+0x63&gt;</span><br><span class="line">...</span><br><span class="line">40139b:	89 d0                	mov    %edx,%eax</span><br></pre></td></tr></table></figure>
<p>40135f和401361判断<code>%al</code>寄存器的值（<code>input</code>字符串第1个字符）是否为<code>&#39;\0&#39;</code>：</p>
<ul>
<li>若为<code>&#39;\0&#39;</code>则跳到401388（401338+0x50）将<code>%edx</code>赋为0（继续执行40138d和40139b（401338+0x63）将<code>%edx</code>的0给<code>%eax</code>并<strong>返回</strong>）；</li>
<li>若不为<code>&#39;\0&#39;</code>则继续执行</li>
</ul>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">401363:	3a 45 00             	cmp    0x0(%rbp),%al</span><br><span class="line">401366:	74 0a                	je     401372 &lt;strings_not_equal+0x3a&gt;</span><br><span class="line">401368:	eb 25                	jmp    40138f &lt;strings_not_equal+0x57&gt;</span><br><span class="line">...</span><br><span class="line">401372:	48 83 c3 01          	add    $0x1,%rbx</span><br><span class="line">...</span><br><span class="line">40138f:	ba 01 00 00 00       	mov    $0x1,%edx</span><br><span class="line">401394:	eb 05                	jmp    40139b &lt;strings_not_equal+0x63&gt;</span><br><span class="line">...</span><br><span class="line">40139b:	89 d0                	mov    %edx,%eax</span><br></pre></td></tr></table></figure>
<p>401363、401366和401368比较<code>%rbp</code>指向的值（密码串第1个字符）和<code>%al</code>（输入串第1个字符）：</p>
<ul>
<li>若二者相等则跳到401372（401338+0x3a）；</li>
<li>若不等则继续执行跳到40138f（401338+0x57）将<code>%edx</code>赋为1（继续执行401394和40139b（401338+0x63）将<code>%edx</code>的1给<code>%eax</code>并<strong>返回</strong>）</li>
</ul>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">40136a:	3a 45 00             	cmp    0x0(%rbp),%al</span><br><span class="line">40136d:	0f 1f 00             	nopl   (%rax)</span><br><span class="line">401370:	75 24                	jne    401396 &lt;strings_not_equal+0x5e&gt;</span><br><span class="line">401372:	48 83 c3 01          	add    $0x1,%rbx</span><br><span class="line">401376:	48 83 c5 01          	add    $0x1,%rbp</span><br><span class="line">40137a:	0f b6 03             	movzbl (%rbx),%eax</span><br><span class="line">40137d:	84 c0                	test   %al,%al</span><br><span class="line">40137f:	75 e9                	jne    40136a &lt;strings_not_equal+0x32&gt;</span><br><span class="line">401381:	ba 00 00 00 00       	mov    $0x0,%edx</span><br><span class="line">401386:	eb 13                	jmp    40139b &lt;strings_not_equal+0x63&gt;</span><br><span class="line">...</span><br><span class="line">401396:	ba 01 00 00 00       	mov    $0x1,%edx</span><br><span class="line">40139b:	89 d0                	mov    %edx,%eax</span><br></pre></td></tr></table></figure>
<p>40136a和401370比较<code>%rbp</code>指向的值（密码串第1个字符）和<code>%al</code>（输入串第1个字符）：</p>
<ul>
<li>若二者不等则跳到401396（401338+0x5e）把1给<code>%edx</code>再给<code>%eax</code>（即<strong>返回1</strong>）；</li>
<li>若相等则继续执行401372将<code>%rbx</code>（输入串指针，见40133c）加1、401376将<code>%rbp</code>（密码串指针）加1。40137a将<code>%rbx</code>指向的内容（<code>input</code>字符串第2个字符）传给<code>%eax</code>寄存器，40137d和40137f判断<code>%al</code>的值是否为<code>&#39;\0&#39;</code>：<ul>
<li>若不为<code>&#39;\0&#39;</code>则跳到40136a（401338+0x32）循环；</li>
<li>若为<code>&#39;\0&#39;</code>则继续执行401381和401386将<code>%edx</code>赋为0并跳到40139b把<code>%edx</code>的0再给<code>%eax</code>并返回（即<strong>返回0</strong>）</li>
</ul>
</li>
</ul>
<p>可以看出此部分的循环等价于：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> (*p_passwd != locChar)<span class="comment">// %rbp != %al</span></span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>;<span class="comment">// %eax</span></span><br><span class="line">	p_input++;<span class="comment">// %rbx</span></span><br><span class="line">	p_passwd++;<span class="comment">// %rbp</span></span><br><span class="line">	locChar = *p_input;<span class="comment">// %rbx-&gt;%eax</span></span><br><span class="line">&#125; <span class="keyword">while</span> (locChar != <span class="string">&#x27;\0&#x27;</span>);<span class="comment">// %al</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;<span class="comment">// %eax</span></span><br></pre></td></tr></table></figure>
<p>可以看出此部分用于判断输入串和密码串是否相等，相等则返回0；不等则返回1。</p>
<hr>
<p>综合以上分析可以看出<code>strings_not_equal</code>函数的功能就是**比较<code>%rdi</code>和<code>%rsi</code>指向的字符串（即输入串和密码串），相等返回0、不等返回1，返回值存入<code>%eax</code>**。</p>
<p><a href="#p1">点此返回到<code>phase_1</code>调用此函数处</a>。</p>
<h2 id="string-length"><a href="#string-length" class="headerlink" title="string_length"></a>string_length</h2><p><span id = "length"><code>string_length</code>函数</span>对应的汇编语句如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">000000000040131b &lt;string_length&gt;:</span><br><span class="line">  40131b:	80 3f 00             	cmpb   $0x0,(%rdi)</span><br><span class="line">  40131e:	74 12                	je     401332 &lt;string_length+0x17&gt;</span><br><span class="line">  401320:	48 89 fa             	mov    %rdi,%rdx</span><br><span class="line">  401323:	48 83 c2 01          	add    $0x1,%rdx</span><br><span class="line">  401327:	89 d0                	mov    %edx,%eax</span><br><span class="line">  401329:	29 f8                	sub    %edi,%eax</span><br><span class="line">  40132b:	80 3a 00             	cmpb   $0x0,(%rdx)</span><br><span class="line">  40132e:	75 f3                	jne    401323 &lt;string_length+0x8&gt;</span><br><span class="line">  401330:	f3 c3                	repz retq </span><br><span class="line">  401332:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  401337:	c3                   	retq   </span><br></pre></td></tr></table></figure>
<p>分段分析：</p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">40131b:	80 3f 00             	cmpb   $0x0,(%rdi)</span><br><span class="line">40131e:	74 12                	je     401332 &lt;string_length+0x17&gt;</span><br><span class="line">...</span><br><span class="line">401332:	b8 00 00 00 00       	mov    $0x0,%eax</span><br></pre></td></tr></table></figure>
<p>40131b和40131e判断<code>%rdi</code>寄存器指向的值（记住<code>%rdi</code>指向的是<code>input</code>）是否为<code>&#39;\0&#39;</code>：</p>
<ul>
<li>若为<code>&#39;\0&#39;</code>则跳到401332（40131b+0x17）将<code>%eax</code>寄存器的值赋为<code>0</code>后返回（可以看出**输入串为空串时函数返回<code>0</code>**）</li>
<li>若不为<code>&#39;\0&#39;</code>则继续执行</li>
</ul>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">401320:	48 89 fa             	mov    %rdi,%rdx</span><br><span class="line">401323:	48 83 c2 01          	add    $0x1,%rdx</span><br><span class="line">401327:	89 d0                	mov    %edx,%eax</span><br><span class="line">401329:	29 f8                	sub    %edi,%eax</span><br><span class="line">40132b:	80 3a 00             	cmpb   $0x0,(%rdx)</span><br><span class="line">40132e:	75 f3                	jne    401323 &lt;string_length+0x8&gt;</span><br><span class="line">401330:	f3 c3                	repz retq </span><br></pre></td></tr></table></figure>
<p>401320先将<code>%rdi</code>寄存器的值给<code>%rdx</code>（记住<code>%rdi</code>指向的是<code>input</code>），401323再将<code>%rdx</code>的值加1，401327再把<code>%edx</code>的值给<code>%eax</code>，401329<code>%eax</code>再减去<code>%edi</code>的值，40132b和40132e判断此时<code>%rdx</code>指向的值是否为<code>&#39;\0&#39;</code>：</p>
<ul>
<li>若不为<code>&#39;\0&#39;</code>则跳到401323（40131b+0x8）循环；</li>
<li>若为<code>&#39;\0&#39;</code>则返回，此时<code>%eax</code>存储的便是<code>%rdi</code>中字符串的长度</li>
</ul>
<p>可以看出此部分的循环等价于：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">p = head;<span class="comment">// %edi-&gt;%rdx</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">	p++;<span class="comment">// %rdx</span></span><br><span class="line">	result = p;<span class="comment">// %rdx-&gt;eax</span></span><br><span class="line">	result -= head;<span class="comment">// %eax - %edi</span></span><br><span class="line">&#125; <span class="keyword">while</span> (*p != <span class="string">&#x27;\0&#x27;</span>);<span class="comment">// %rdx</span></span><br><span class="line"><span class="keyword">return</span> result;<span class="comment">// %eax</span></span><br></pre></td></tr></table></figure>
<p><code>p</code>指针从字符串头<code>head</code>开始向后移动，一直移动到末尾<code>&#39;\0&#39;</code>处，此时<code>p</code>与<code>head</code>之差即字符串的长度</p>
<hr>
<p>综合以上分析可以看出<code>string_length</code>函数的功能就是**返回<code>%rdi</code>处字符串的长度，并存入<code>%eax</code>**。</p>
<p><a href="#backToEqual">点此返回到未分析完的<code>strings_not_equal</code>函数</a>。</p>
<h2 id="read-six-numbers"><a href="#read-six-numbers" class="headerlink" title="read_six_numbers"></a>read_six_numbers</h2><p><span id = "6numbers"><code>read_six_numbers</code>函数</span>对应的汇编语句如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">000000000040145c &lt;read_six_numbers&gt;:</span><br><span class="line">  40145c:	48 83 ec 18          	sub    $0x18,%rsp</span><br><span class="line">  401460:	48 89 f2             	mov    %rsi,%rdx</span><br><span class="line">  401463:	48 8d 4e 04          	lea    0x4(%rsi),%rcx</span><br><span class="line">  401467:	48 8d 46 14          	lea    0x14(%rsi),%rax</span><br><span class="line">  40146b:	48 89 44 24 08       	mov    %rax,0x8(%rsp)</span><br><span class="line">  401470:	48 8d 46 10          	lea    0x10(%rsi),%rax</span><br><span class="line">  401474:	48 89 04 24          	mov    %rax,(%rsp)</span><br><span class="line">  401478:	4c 8d 4e 0c          	lea    0xc(%rsi),%r9</span><br><span class="line">  40147c:	4c 8d 46 08          	lea    0x8(%rsi),%r8</span><br><span class="line">  401480:	be c3 25 40 00       	mov    $0x4025c3,%esi</span><br><span class="line">  401485:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  40148a:	e8 61 f7 ff ff       	callq  400bf0 &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line">  40148f:	83 f8 05             	cmp    $0x5,%eax</span><br><span class="line">  401492:	7f 05                	jg     401499 &lt;read_six_numbers+0x3d&gt;</span><br><span class="line">  401494:	e8 a1 ff ff ff       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  401499:	48 83 c4 18          	add    $0x18,%rsp</span><br><span class="line">  40149d:	c3                   	retq </span><br></pre></td></tr></table></figure>
<p>分段分析：</p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">40145c:	48 83 ec 18          	sub    $0x18,%rsp</span><br><span class="line">401460:	48 89 f2             	mov    %rsi,%rdx</span><br><span class="line">401463:	48 8d 4e 04          	lea    0x4(%rsi),%rcx</span><br><span class="line">401467:	48 8d 46 14          	lea    0x14(%rsi),%rax</span><br><span class="line">40146b:	48 89 44 24 08       	mov    %rax,0x8(%rsp)</span><br><span class="line">401470:	48 8d 46 10          	lea    0x10(%rsi),%rax</span><br><span class="line">401474:	48 89 04 24          	mov    %rax,(%rsp)</span><br><span class="line">401478:	4c 8d 4e 0c          	lea    0xc(%rsi),%r9</span><br><span class="line">40147c:	4c 8d 46 08          	lea    0x8(%rsi),%r8</span><br></pre></td></tr></table></figure>
<p>40145c在<code>%rsp</code>中分配24字节空间压栈，401460把<code>%rsi</code>的地址给<code>%rdx</code>，401463把<code>%rsi+4</code>的地址给<code>%rcx</code>，401467把<code>%rsi+20</code>的地址给<code>%rax</code>，40146b把<code>%rax</code>的地址给<code>%rsp+8</code>，401470把<code>%rsi+16</code>的地址给<code>%rax</code>，401474把<code>%rax</code>的地址给<code>%rsp+0</code>，401478把<code>%rsi+12</code>的地址给<code>%r9</code>，40147c把<code>%rsi+8</code>的地址给<code>%r8</code>。</p>
<p>这一连串的赋值可以写成：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">%rdx &#x3D; %rsi</span><br><span class="line">%rcx &#x3D; %rsi + 4</span><br><span class="line">0(%rsp) &#x3D; %rsi + 16</span><br><span class="line">8(%rsp) &#x3D; %rsi + 20</span><br><span class="line">%r9 &#x3D; %rsi + 12</span><br><span class="line">%r8 &#x3D; %rsi + 8</span><br></pre></td></tr></table></figure>
<p>按顺序排好：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">%rdx &#x3D; %rsi</span><br><span class="line">%rcx &#x3D; %rsi + 4</span><br><span class="line">%r8 &#x3D; %rsi + 8</span><br><span class="line">%r9 &#x3D; %rsi + 12</span><br><span class="line">0x0(%rsp) &#x3D; %rsi + 16</span><br><span class="line">0x8(%rsp) &#x3D; %rsi + 20</span><br></pre></td></tr></table></figure>
<p>由前面的分析可知，<code>%rsi</code>寄存器存放的是<code>%rsp</code>的内容，可知此6个地址对应了<code>%rsp</code>栈中6个<code>int</code>的地址</p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">401480:	be c3 25 40 00       	mov    $0x4025c3,%esi</span><br><span class="line">401485:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">40148a:	e8 61 f7 ff ff       	callq  400bf0 &lt;__isoc99_sscanf@plt&gt;</span><br></pre></td></tr></table></figure>
<p>401480将地址<code>0x4025c3</code>传入<code>%esi</code>寄存器，直接<code>gdb</code>查看此处内容：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/s 0x4025c3</span><br></pre></td></tr></table></figure>
<p>得到输出如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x4025c3:       &quot;%d %d %d %d %d %d&quot;</span><br></pre></td></tr></table></figure>
<p>可以看出这就是C格式化字符串，之后的401485将<code>%eax</code>赋为0，40148a调用<code>sscanf</code>函数（<a target="_blank" rel="noopener" href="https://www.ibm.com/support/knowledgecenter/en/ssw_ibm_i_72/rtref/sscanf.htm">什么是<code>sscanf</code>函数？</a>），<strong>推测</strong>此处读取了6个整数并对应存放在上述6个地址中。另外从此格式化字符串可以<strong>推测</strong>，输入6个整数时中间须以1个空格隔开</p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">40148f:	83 f8 05             	cmp    $0x5,%eax</span><br><span class="line">401492:	7f 05                	jg     401499 &lt;read_six_numbers+0x3d&gt;</span><br><span class="line">401494:	e8 a1 ff ff ff       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">401499:	48 83 c4 18          	add    $0x18,%rsp</span><br><span class="line">40149d:	c3                   	retq   </span><br></pre></td></tr></table></figure>
<p>40148f和401492判断<code>%eax</code>的值是否大于5：</p>
<ul>
<li>若大于5则跳到401499（40145c+0x3d）弹出栈并返回；</li>
<li>若不大于5则继续执行401494使炸弹爆炸</li>
</ul>
<hr>
<p>综合以上分析可以看出<code>read_six_numbers</code>函数的功能就是<strong>判断是否输入了5个以上整数，若输入整数未超过5个则引爆炸弹</strong>。</p>
<p><a href="#p2">点此返回到<code>phase_2</code>调用此函数处</a>。</p>
<h2 id="func4"><a href="#func4" class="headerlink" title="func4"></a>func4</h2><p><span id = "func4"><code>func4</code>函数</span>对应的汇编语句如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">0000000000400fce &lt;func4&gt;:</span><br><span class="line">  400fce:	48 83 ec 08          	sub    $0x8,%rsp</span><br><span class="line">  400fd2:	89 d0                	mov    %edx,%eax</span><br><span class="line">  400fd4:	29 f0                	sub    %esi,%eax</span><br><span class="line">  400fd6:	89 c1                	mov    %eax,%ecx</span><br><span class="line">  400fd8:	c1 e9 1f             	shr    $0x1f,%ecx</span><br><span class="line">  400fdb:	01 c8                	add    %ecx,%eax</span><br><span class="line">  400fdd:	d1 f8                	sar    %eax</span><br><span class="line">  400fdf:	8d 0c 30             	lea    (%rax,%rsi,1),%ecx</span><br><span class="line">  400fe2:	39 f9                	cmp    %edi,%ecx</span><br><span class="line">  400fe4:	7e 0c                	jle    400ff2 &lt;func4+0x24&gt;</span><br><span class="line">  400fe6:	8d 51 ff             	lea    -0x1(%rcx),%edx</span><br><span class="line">  400fe9:	e8 e0 ff ff ff       	callq  400fce &lt;func4&gt;</span><br><span class="line">  400fee:	01 c0                	add    %eax,%eax</span><br><span class="line">  400ff0:	eb 15                	jmp    401007 &lt;func4+0x39&gt;</span><br><span class="line">  400ff2:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  400ff7:	39 f9                	cmp    %edi,%ecx</span><br><span class="line">  400ff9:	7d 0c                	jge    401007 &lt;func4+0x39&gt;</span><br><span class="line">  400ffb:	8d 71 01             	lea    0x1(%rcx),%esi</span><br><span class="line">  400ffe:	e8 cb ff ff ff       	callq  400fce &lt;func4&gt;</span><br><span class="line">  401003:	8d 44 00 01          	lea    0x1(%rax,%rax,1),%eax</span><br><span class="line">  401007:	48 83 c4 08          	add    $0x8,%rsp</span><br><span class="line">  40100b:	c3                   	retq   </span><br></pre></td></tr></table></figure>
<p>分段分析：</p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">400fce:	48 83 ec 08          	sub    $0x8,%rsp</span><br><span class="line">400fd2:	89 d0                	mov    %edx,%eax</span><br><span class="line">400fd4:	29 f0                	sub    %esi,%eax</span><br><span class="line">400fd6:	89 c1                	mov    %eax,%ecx</span><br><span class="line">400fd8:	c1 e9 1f             	shr    $0x1f,%ecx</span><br><span class="line">400fdb:	01 c8                	add    %ecx,%eax</span><br><span class="line">400fdd:	d1 f8                	sar    %eax</span><br></pre></td></tr></table></figure>
<p>400fce分配8字节空间压栈，400fd2将<code>%edx</code>的值（14）赋给<code>%eax</code>，400fd4将<code>%eax</code>减去<code>%esi</code>（0），400fd6将<code>%eax</code>的值（差值）赋给<code>%ecx</code>，400fd8再将<code>%ecx</code>（差值）逻辑右移31位，400fdb再将<code>%eax</code>的值（差值）加上<code>%ecx</code>（右移后的值），400fdd将二者之和算术右移1位，结果存入<code>%eax</code></p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">400fdf:	8d 0c 30             	lea    (%rax,%rsi,1),%ecx</span><br><span class="line">400fe2:	39 f9                	cmp    %edi,%ecx</span><br><span class="line">400fe4:	7e 0c                	jle    400ff2 &lt;func4+0x24&gt;</span><br><span class="line">400fe6:	8d 51 ff             	lea    -0x1(%rcx),%edx</span><br><span class="line">400fe9:	e8 e0 ff ff ff       	callq  400fce &lt;func4&gt;</span><br><span class="line">400fee:	01 c0                	add    %eax,%eax</span><br><span class="line">400ff0:	eb 15                	jmp    401007 &lt;func4+0x39&gt;</span><br><span class="line">400ff2:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">400ff7:	39 f9                	cmp    %edi,%ecx</span><br><span class="line">400ff9:	7d 0c                	jge    401007 &lt;func4+0x39&gt;</span><br><span class="line">400ffb:	8d 71 01             	lea    0x1(%rcx),%esi</span><br><span class="line">400ffe:	e8 cb ff ff ff       	callq  400fce &lt;func4&gt;</span><br><span class="line">401003:	8d 44 00 01          	lea    0x1(%rax,%rax,1),%eax</span><br><span class="line">401007:	48 83 c4 08          	add    $0x8,%rsp</span><br><span class="line">40100b:	c3                   	retq   </span><br></pre></td></tr></table></figure>
<p>400fdf将<code>%rax</code>的值（右移1位后的值）和<code>%rsi</code>的值（0）加到<code>%ecx</code>中，400fe2和400fe4将<code>%ecx</code>（二者之和）和<code>%edi</code>（输入的第一个整数）对比：</p>
<ul>
<li>若二者之和不超过输入的第1个整数，则跳到400ff2（400fce+0x24）将<code>%eax</code>（先前存放右移1位后的值）赋为0，400ff7和400ff9比较<code>%edi</code>（输入的第1个整数）和<code>%ecx</code>（二者之和）：<ul>
<li>若二者之和不小于输入的第1个整数（即二者之和等于输入的第1个整数），则跳到401007（400fce+0x39）弹出栈并返回（<strong>此时返回值<code>%eax</code>为0</strong>）</li>
<li>若二者之和小于输入的第1个整数，则继续执行400ffb将<code>%rcx</code>（二者之和）加1赋给<code>%esi</code>（先前存放的是0），400ffe递归调用<code>func4</code>函数，401003将递归调用的返回值<code>%rax</code>乘2再加1，401007<strong>返回</strong></li>
</ul>
</li>
<li>若二者之和超过了输入的第1个整数，则继续执行400fe6将<code>%rcx</code>（二者之和）减1赋给<code>%edx</code>（先前存放的是14），400fe9递归调用<code>func4</code>函数，400fee将递归调用的返回值<code>%eax</code>乘2，400ff0跳到401007（400fce+0x39）弹出栈并<strong>返回</strong></li>
</ul>
<p>结合两部分的分析，可以看出此部分的递归调用等价于：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">func4</span><span class="params">(<span class="keyword">int</span> passwd, <span class="keyword">int</span> min, <span class="keyword">int</span> max)</span> </span>&#123;<span class="comment">// %edi, %esi, %edx-&gt;%eax</span></span><br><span class="line">	<span class="keyword">int</span> len = max - min;<span class="comment">// %ecx</span></span><br><span class="line">  <span class="keyword">unsigned</span> sign = len &gt;&gt; <span class="number">31</span>;<span class="comment">// %ecx</span></span><br><span class="line">  <span class="keyword">int</span> half_len = (len + sign) &gt;&gt; <span class="number">1</span>;<span class="comment">// %eax</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">int</span> mid = half_len + min;<span class="comment">// %ecx</span></span><br><span class="line">  <span class="keyword">if</span> (mid &lt;= passwd) &#123;</span><br><span class="line">    half_len = <span class="number">0</span>;<span class="comment">// %eax</span></span><br><span class="line">    <span class="keyword">if</span> (mid &gt;= passwd)<span class="comment">// mid == passwd</span></span><br><span class="line">      <span class="keyword">return</span> half_len;</span><br><span class="line">    <span class="keyword">else</span> &#123;<span class="comment">// mid &lt; passwd</span></span><br><span class="line">      min = mid + <span class="number">1</span>;</span><br><span class="line">      half_len = func4(passwd, min, max) * <span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">return</span> half_len;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;<span class="comment">// mid &gt; passwd</span></span><br><span class="line">    max = mid - <span class="number">1</span>;</span><br><span class="line">    half_len = func4(passwd, min, max) * <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">return</span> half_len;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p>奇怪的判断与二分法使我们暂不能看出此函数的功能，需要继续分析原<code>phase</code>函数。</p>
<p><a href="#p4">点此返回到<code>phase_4</code>调用此函数处</a>。</p>
<h2 id="fun7"><a href="#fun7" class="headerlink" title="fun7"></a>fun7</h2><p><span id = "fun7"><code>fun7</code>函数</span>对应的汇编语句如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">0000000000401204 &lt;fun7&gt;:</span><br><span class="line">  401204:	48 83 ec 08          	sub    $0x8,%rsp</span><br><span class="line">  401208:	48 85 ff             	test   %rdi,%rdi</span><br><span class="line">  40120b:	74 2b                	je     401238 &lt;fun7+0x34&gt;</span><br><span class="line">  40120d:	8b 17                	mov    (%rdi),%edx</span><br><span class="line">  40120f:	39 f2                	cmp    %esi,%edx</span><br><span class="line">  401211:	7e 0d                	jle    401220 &lt;fun7+0x1c&gt;</span><br><span class="line">  401213:	48 8b 7f 08          	mov    0x8(%rdi),%rdi</span><br><span class="line">  401217:	e8 e8 ff ff ff       	callq  401204 &lt;fun7&gt;</span><br><span class="line">  40121c:	01 c0                	add    %eax,%eax</span><br><span class="line">  40121e:	eb 1d                	jmp    40123d &lt;fun7+0x39&gt;</span><br><span class="line">  401220:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  401225:	39 f2                	cmp    %esi,%edx</span><br><span class="line">  401227:	74 14                	je     40123d &lt;fun7+0x39&gt;</span><br><span class="line">  401229:	48 8b 7f 10          	mov    0x10(%rdi),%rdi</span><br><span class="line">  40122d:	e8 d2 ff ff ff       	callq  401204 &lt;fun7&gt;</span><br><span class="line">  401232:	8d 44 00 01          	lea    0x1(%rax,%rax,1),%eax</span><br><span class="line">  401236:	eb 05                	jmp    40123d &lt;fun7+0x39&gt;</span><br><span class="line">  401238:	b8 ff ff ff ff       	mov    $0xffffffff,%eax</span><br><span class="line">  40123d:	48 83 c4 08          	add    $0x8,%rsp</span><br><span class="line">  401241:	c3                   	retq   </span><br></pre></td></tr></table></figure>
<p>401208和40120b判断<code>%rdi</code>（地址<code>0x6030F0</code>）是否为0：</p>
<ul>
<li>若为0则跳到401238（401204+0x34）将值<code>0xffffffff</code>赋给<code>%eax</code>并<strong>返回</strong></li>
<li>若不为0则继续执行40120d将<code>%rdi</code>指向的值（地址<code>0x6030F0</code>指向的值）赋给<code>%edx</code>，40120f和401211比较<code>%edx</code>（地址<code>0x6030F0</code>指向的值）是否不超过<code>%esi</code>（<code>strtol</code>函数的返回值）：<ul>
<li>若<code>%edx</code>不超过<code>%esi</code>，则跳到401220（401204+0x1c）将<code>%eax</code>赋为0，401225和401227比较<code>%edx</code>和<code>%esi</code>是否相等：<ul>
<li>若相等则跳到40123d（401204+0x39）弹栈<strong>返回</strong>；</li>
<li>若不等则继续执行401229将<code>%rdi+16</code>指向的值赋给<code>%rdi</code>，40122d递归调用<code>fun7</code>函数，401232将<code>%rax</code>的值乘2加1赋给<code>%eax</code>，401236跳到40123d（401204+0x39）弹栈<strong>返回</strong></li>
</ul>
</li>
<li>若<code>%edx</code>超过<code>%esi</code>，则继续执行401213将<code>%rdi+8</code>指向的值赋给<code>%rdi</code>，401217递归调用<code>fun7</code>函数，40121c将返回值乘2，40121e跳到40123d（401204+0x39）弹栈<strong>返回</strong></li>
</ul>
</li>
</ul>
<p>可以看出此部分的递归调用等价于：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fun7</span><span class="params">(<span class="keyword">int</span>* p_node, <span class="keyword">int</span> target)</span> </span>&#123;<span class="comment">// %rdi %esi</span></span><br><span class="line">	<span class="keyword">if</span> (p_node == <span class="number">0</span>)<span class="comment">// %rdi</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0xffffffff</span>;<span class="comment">// %eax</span></span><br><span class="line">  num = *p_node;<span class="comment">// (%rdi)-&gt;%edx</span></span><br><span class="line">  <span class="keyword">if</span> (num &lt;= target) &#123;<span class="comment">// %edx &lt;= %esi</span></span><br><span class="line">    result = <span class="number">0</span>;<span class="comment">// %eax</span></span><br><span class="line">    <span class="keyword">if</span> (num == target)</span><br><span class="line">      <span class="keyword">return</span> result;<span class="comment">// %eax=0</span></span><br><span class="line">    <span class="keyword">else</span> &#123;<span class="comment">// %edx == %esi</span></span><br><span class="line">    	p_node = *(p_node + <span class="number">2</span>);<span class="comment">// %rdi</span></span><br><span class="line">    	result = fun7(p_node, target);<span class="comment">// %eax</span></span><br><span class="line">    	<span class="keyword">return</span> result * <span class="number">2</span> + <span class="number">1</span>;<span class="comment">// %eax</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;<span class="comment">// %edx &gt; %esi</span></span><br><span class="line">    p_node = *(p_node + <span class="number">1</span>);<span class="comment">// %rdi</span></span><br><span class="line">    result = fun7(p_node, target);<span class="comment">// %eax</span></span><br><span class="line">    <span class="keyword">return</span> result * <span class="number">2</span>;<span class="comment">// %eax</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p>奇怪的条件判断与递归调用使我们暂不能看出此函数的功能，需要继续分析原<code>phase</code>函数。</p>
<p><a href="#backToSec">点此返回到<code>secret_phase</code>调用此函数处</a>。</p>
<h1 id="拆弹结束"><a href="#拆弹结束" class="headerlink" title="拆弹结束"></a>拆弹结束</h1><p>将以上得到的各个<code>phase</code>的password存入<code>passed.txt</code>中：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Border relations with Canada have never been better.</span><br><span class="line">1 2 4 8 16 32</span><br><span class="line">0 207</span><br><span class="line">0 0 DrEvil</span><br><span class="line">9/N567</span><br><span class="line">4 3 2 1 6 5</span><br><span class="line">22</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>注意：</p>
<ol>
<li><code>phase_3</code>、<code>phase_4</code>、<code>phase_5</code>和<code>secret_phase</code>的password均有多种情况，请只选择一种输入；</li>
<li>若想进入并拆除<code>secret_phase</code>，请在第4行后添加空格和<code>DrEvil</code>，并在第6行后添加一行，输入<code>secret_phase</code>的password；</li>
<li><strong>文件最后一定要另起一空行，以代表输入结束。</strong></li>
</ol>
<p>若password全部正确，则会看到输出为：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Welcome to my fiendish little bomb. You have 6 phases with</span><br><span class="line">which to blow yourself up. Have a nice day!</span><br><span class="line">Phase 1 defused. How about the next one?</span><br><span class="line">That&#x27;s number 2.  Keep going!</span><br><span class="line">Halfway there!</span><br><span class="line">So you got that one.  Try this one.</span><br><span class="line">Good work!  On to the next...</span><br><span class="line">Curses, you&#x27;ve found the secret phase!</span><br><span class="line">But finding it and solving it are quite different...</span><br><span class="line">Wow! You&#x27;ve defused the secret stage!</span><br><span class="line">Congratulations! You&#x27;ve defused the bomb!</span><br></pre></td></tr></table></figure>
<p><em>特别鸣谢：本实验部分思路受<a target="_blank" rel="noopener" href="https://hakula.xyz/csapp/bomblab.html">Hakula</a>启发，在此表示感谢。</em></p>
<p><img src="https://super-bucket1.oss-cn-beijing.aliyuncs.com/1988.jpeg" alt="1988"></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>Thanks for your reading.</div>
  <button onclick="document.querySelector('.post-reward').classList.toggle('active');">
    Donate
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpay.png" alt="SUPER WeChat Pay">
        <span>WeChat Pay</span>
      </div>
      <div>
        <img src="/images/alipay.png" alt="SUPER Alipay">
        <span>Alipay</span>
      </div>

  </div>
</div>

          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>Post author:  </strong>SUPER
  </li>
  <li class="post-copyright-link">
      <strong>Post link: </strong>
      <a href="https://www.superpung.xyz/Bomb-Lab/" title="Bomb Lab: Defusing a Binary Bomb">https://www.superpung.xyz/Bomb-Lab/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.
  </li>
</ul>
</div>

          <div class="followme">
  <span>Welcome to my other publishing channels</span>

  <div class="social-list">

      <div class="social-item">
        <a target="_blank" class="social-link" href="https://twitter.com/super_pung">
          <span class="icon">
            <i class="fab fa-twitter"></i>
          </span>

          <span class="label">Twitter</span>
        </a>
      </div>

      <div class="social-item">
        <a target="_blank" class="social-link" href="https://t.me/super_lee">
          <span class="icon">
            <i class="fab fa-telegram"></i>
          </span>

          <span class="label">Telegram</span>
        </a>
      </div>

      <div class="social-item">
        <a target="_blank" class="social-link" href="/images/wechat_channel.png">
          <span class="icon">
            <i class="fab fa-weixin"></i>
          </span>

          <span class="label">WeChat</span>
        </a>
      </div>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/Computer-Systems/" rel="tag"><i class="fa fa-tag"></i> Computer Systems</a>
              <a href="/tags/Lab-Assignments/" rel="tag"><i class="fa fa-tag"></i> Lab Assignments</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/Data-Structures-Experiment-12/" rel="prev" title="Data Structures Experiment #12">
                  <i class="fa fa-chevron-left"></i> Data Structures Experiment #12
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/Data-Structures-Experiment-13/" rel="next" title="Data Structures Experiment #13">
                  Data Structures Experiment #13 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; Jan 14, 2020 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fas fa-bolt"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">SUPER</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="Symbols count total">460k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">6:59</span>
  </span>
</div>

<span id="jinrishici-sentence">正在加载今日诗词....</span>
<script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  






  




  


<script>
NexT.utils.loadComments('#valine-comments', () => {
  NexT.utils.getScript('https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js', () => {
    new Valine(Object.assign({"enable":true,"appId":"dTCUKVKvTVtMNlJS8ouhSrSy-gzGzoHsz","appKey":"Xu5gOcha47h22aiE985nuBSN","serverURLs":"https://dtcukvkv.lc-cn-n1-shared.com","placeholder":"Please leave a message here","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"lang":null,"visitor":false,"comment_count":true,"recordIP":false,"enableQQ":false,"requiredFields":[]}, {
      el: '#valine-comments',
      path: "/Bomb-Lab/",
      serverURLs: "https://dtcukvkv.lc-cn-n1-shared.com"
    }));
  }, window.Valine);
});
</script>

</body>
</html>

<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/clicklove.js"></script>
